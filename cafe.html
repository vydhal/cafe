<!-- V1.2
/**********************************************************************
*                                                                     *
*                Card√°pio Digital Whatsapp Google Sheets              *
*                                                                     *
*    Desenvolvido com ‚ù§Ô∏è por Dante Testa                              *
*    www.dantetesta.com.br | WhatsApp: (19) 99802-9156                *
*                                                                     *
*    üö´ AVISO IMPORTANTE üö´                                           *
*    Este c√≥digo √© propriedade intelectual de Dante Testa.            *
*    N√£o utilize de forma pirata. Valorize o trabalho do              *
*    desenvolvedor adquirindo uma licen√ßa leg√≠tima.                   *
*                                                                     *
*    üí∏ APOIE O DESENVOLVEDOR                                         *
*    Ao comprar o original voc√™ apoia um profissional que             *
*    tamb√©m tem fam√≠lia e luta todo dia para pagar as contas.         *
*    N√£o pegue atalhos - um dia a vida manda a conta das              *
*    pequenas coisas erradas que fazemos.                             *
*                                                                     *
*    üí∞ Se este script te ajudou a ficar rico e quiser me             *
*    enviar um presente financeiro: PIX dante.testa@gmail.com         *
*                                                                     *
*    üõ†Ô∏è SUPORTE T√âCNICO [n√£o gratuito]                                *
*    Dispon√≠vel via WhatsApp. Entre em contato para consultar         *
*    valores e planos de suporte personalizados.                      *
*                                                                     *
*    "C√≥digo √© poesia. Respeite o poeta."                             *
*                                                                     *
**********************************************************************
*/
-->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Meta tags para prevenir cache -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- Meta tags para SEO que ser√£o preenchidas dinamicamente -->
    <meta name="description" content="" id="meta-description">
    <meta name="keywords" content="" id="meta-keywords">
    <meta name="author" content="Dante Testa">
    
    <!-- Meta tags para compartilhamento em redes sociais (Open Graph) -->
    <meta property="og:title" content="" id="og-title">
    <meta property="og:description" content="" id="og-description">
    <meta property="og:image" content="" id="og-image">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:url" content="" id="og-url">
    <meta property="og:type" content="website">
    
    <!-- Meta tags para Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="" id="twitter-title">
    <meta name="twitter:description" content="" id="twitter-description">
    <meta name="twitter:image" content="" id="twitter-image">
    
    <!-- Favicon (ser√° preenchido dinamicamente) -->
    <link rel="icon" href="" type="image/png">
    
    <title></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome para √≠cones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Vari√°veis CSS din√¢micas para cores da planilha */
        :root {
            --cor-primaria: #8B4513;
            --cor-secundaria: #D2691E;
            --cor-fundo: #f8fafc;
            --cor-texto: #333333;
            --cor-links: #8B4513;
            --cor-texto-rodape: #ffffff;
        }

        /* Anima√ß√µes personalizadas */
        .menu-transition {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Anima√ß√µes para mensagens de feedback */
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(20px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }
        
        @keyframes fadeOut {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }
        
        .animate-fade-in-out {
            animation: fadeInOut 2.5s ease-in-out;
        }
        
        .animate-fade-out {
            animation: fadeOut 0.5s ease-in-out forwards;
        }
        
        /* Anima√ß√£o para o contador do carrinho */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .animate-pulse {
            animation: pulse 0.5s ease-in-out;
        }
        
        .logo-hover {
            transition: transform 0.2s ease-in-out;
        }
        
        .logo-hover:hover {
            transform: scale(1.05);
        }
        
        /* Estilos para os radio buttons personalizados */
        .radio-circle {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #d1d5db;
            position: relative;
            transition: all 0.2s ease;
        }
        
        .radio-circle.selected {
            border-color: var(--cor-primaria, #ff6b6b);
        }
        
        .radio-circle.selected:after {
            content: '';
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--cor-primaria, #ff6b6b);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .opcao-entrega.selected {
            border-color: var(--cor-primaria, #ff6b6b);
            background-color: rgba(var(--cor-primaria-rgb, 255, 107, 107), 0.05);
        }
        
        /* Smooth scroll */
        html {
            scroll-behavior: smooth;
        }
        
        /* Loading animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        
        /* Anima√ß√µes para transi√ß√£o entre steps */
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes slideOutRight {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(30px); }
        }
        
        @keyframes slideOutLeft {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(-30px); }
        }
        
        .step {
            transition: all 0.3s ease;
            position: relative;
        }
        
        .step.hidden {
            display: none;
        }
        
        .step.slide-in-right {
            animation: slideInRight 0.3s forwards;
        }
        
        .step.slide-in-left {
            animation: slideInLeft 0.3s forwards;
        }
        
        .step.slide-out-right {
            animation: slideOutRight 0.3s forwards;
        }
        
        .step.slide-out-left {
            animation: slideOutLeft 0.3s forwards;
        }
        
        /* Gradientes din√¢micos */
        .gradient-bg {
            background: var(--cor-fundo);
        }
        
        /* Cards com hover effect - Design atualizado */
        .card-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            will-change: transform;
            transform: translateZ(0);
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        /* Espa√ßamento para cards em dispositivos m√≥veis */
        .menu-item-mobile-spacing {
            margin-top: 10px !important;
            margin-bottom: 10px !important;
        }
        
        @media (max-width: 767px) {
            .menu-item {
                margin-top: 10px;
                margin-bottom: 10px;
            }
        }
        
        /* Estilos para o novo design de cards */
        .menu-item-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .menu-item-row {
            display: flex;
            flex-direction: row;
            align-items: stretch;
            height: 100%;
        }
        
        .menu-item-content {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            flex-grow: 1;
            min-width: 0; /* Para evitar overflow de texto */
        }
        
        .menu-item-title-price {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .menu-item-image-wrapper {
            position: relative;
            overflow: hidden;
            border-radius: 0.75rem;
        }
        
        .menu-item-pill {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.975rem; /* Aumentado em 30% de 0.75rem */
            font-weight: 600;
        }
        
        /* Anima√ß√£o do pre√ßo */
        .price-highlight {
            transition: all 0.2s ease;
        }
        
        .price-highlight:hover {
            transform: scale(1.02);
        }
        
        /* Media queries espec√≠ficas para dispositivos m√≥veis */
        @media only screen and (max-width: 767px) {
            /* Aumentar fonte do par√°grafo de descri√ß√£o em 20% */
            .text-gray-600.leading-snug.text-sm,
            p.text-gray-600.leading-snug,
            .menu-item-content p {
                font-size: 1.05rem !important; /* 20% maior que text-sm para mobile */
                margin-bottom: 15px !important; /* Garantir que a margem inferior seja aplicada */
                padding-bottom: 5px !important; /* Adicionar padding para garantir espa√ßamento */
            }
            
            /* Ajustar espa√ßamento das tags/classifica√ß√µes */
            .flex.flex-wrap.gap-1,
            div.flex.flex-wrap,
            .menu-item-content .flex {
                margin-top: 10px !important;
                margin-bottom: 10px !important;
                padding-top: 2px !important;
                padding-bottom: 2px !important;
            }
            
            /* Garantir que o bot√£o Adicionar tenha tamanho adequado */
            .adicionar-ao-carrinho,
            button.adicionar-ao-carrinho {
                font-size: 1rem !important;
                padding: 10px 16px !important;
            }
            
            /* Garantir que as observa√ß√µes tenham tamanho adequado */
            p.text-sm.text-gray-500.italic,
            .menu-item-content .text-gray-500 {
                font-size: 0.95rem !important;
                margin-top: 10px !important;
            }
            
            /* Hack espec√≠fico para Safari no iOS */
            @supports (-webkit-touch-callout: none) {
                .menu-item-content p {
                    margin-bottom: 15px !important;
                    font-size: 1.05rem !important;
                }
                
                .menu-item-content .flex {
                    margin-top: 10px !important;
                    margin-bottom: 10px !important;
                }
            }
        }

        /* Scroll horizontal estilo iFood com cores din√¢micas */
        .category-scroll {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .category-scroll::-webkit-scrollbar {
            display: none;
        }
        
        .category-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .category-item.active {
            background-color: var(--cor-primaria) !important;
            color: white !important;
            /* Removido: sombra e efeitos de escala/transla√ß√£o */
        }
        
        .category-item.centered-item {
            position: relative;
            /* Removida a posi√ß√£o relativa que era usada para a bolinha */
        }

        /* Removido o pseudo-elemento ::after que criava a bolinha */

        /* Classes din√¢micas que usam as vari√°veis CSS */
        .bg-primary-dynamic {
            background-color: var(--cor-primaria) !important;
        }

        .text-primary-dynamic {
            color: var(--cor-primaria) !important;
        }

        .border-primary-dynamic {
            border-color: var(--cor-primaria) !important;
        }

        .bg-secondary-dynamic {
            background-color: var(--cor-secundaria) !important;
        }

        .text-secondary-dynamic {
            color: var(--cor-secundaria) !important;
        }

        .hover-primary-dynamic:hover {
            background-color: var(--cor-primaria) !important;
            color: white !important;
        }
        
        /* Classes din√¢micas para texto e links */
        .text-color-dynamic {
            color: var(--cor-texto) !important;
        }
        
        .link-color-dynamic {
            color: var(--cor-links) !important;
        }
        
        .link-color-dynamic:hover {
            color: var(--cor-links) !important;
            opacity: 0.8;
        }
        
        /* Classe espec√≠fica para texto do rodap√© */
        .text-rodape-dynamic {
            color: var(--cor-texto-rodape) !important;
        }

        /* Estilos para o sistema de busca */
        .search-overlay {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }

        .search-container {
            transform: translateY(-20px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .search-container.active {
            transform: translateY(0);
            opacity: 1;
        }

        .search-results {
            max-height: 400px;
            overflow-y: auto;
            scrollbar-width: thin;
        }

        .search-results::-webkit-scrollbar {
            width: 6px;
        }

        .search-results::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .search-results::-webkit-scrollbar-thumb {
            background: var(--cor-primaria);
            border-radius: 3px;
        }

        .search-item {
            transition: all 0.2s ease;
        }

        .search-item:hover {
            background-color: #f8f9fa;
            transform: translateX(5px);
        }

        .highlight {
            background-color: yellow;
            font-weight: bold;
        }

        /* Anima√ß√£o do √≠cone de busca */
        .search-icon {
            transition: all 0.3s ease;
        }

        .search-icon:hover {
            transform: scale(1.1);
            color: var(--cor-primaria);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen" onload="window.scrollTo(0, 0);">
    <!-- Script para garantir que a p√°gina carregue no topo quando recarregada -->
    <script>
        // Verificar se h√° par√¢metro scrollTop na URL
        if (window.location.href.includes('scrollTop=0')) {
            // For√ßar rolagem para o topo
            window.scrollTo(0, 0);
            
            // Remover o par√¢metro da URL para n√£o acumular par√¢metros
            const urlSemParam = window.location.href.replace(/[?&]scrollTop=0(&|$)/, '$1');
            const urlLimpa = urlSemParam.endsWith('?') || urlSemParam.endsWith('&') 
                ? urlSemParam.slice(0, -1) 
                : urlSemParam;
                
            // Atualizar a URL sem recarregar a p√°gina
            if (urlLimpa !== window.location.href) {
                history.replaceState(null, '', urlLimpa);
            }
        }
    </script>
    <!-- Loading Screen -->
    <div id="loading" class="fixed inset-0 bg-white flex items-center justify-center z-50">
        <div class="text-center">
            <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-primary-dynamic mx-auto mb-4"></div>
            <p class="text-gray-600 text-lg">Carregando card√°pio...</p>
        </div>
    </div>

    <!-- Overlay de Busca -->
    <div id="search-overlay" class="search-overlay fixed inset-0 z-50 hidden">
        <div class="flex items-start justify-center min-h-screen pt-16 px-4">
            <div id="search-container" class="search-container bg-white rounded-2xl shadow-2xl w-full max-w-2xl">
                <!-- Header da Busca -->
                <div class="flex items-center justify-between p-6 border-b border-gray-200">
                    <h3 class="text-xl font-bold text-gray-800">üîç Buscar no Card√°pio</h3>
                    <button id="close-search" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                        <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Campo de Busca -->
                <div class="p-6 border-b border-gray-200">
                    <div class="relative">
                        <input type="text" id="search-input" 
                               placeholder="Digite o nome do produto, categoria ou descri√ß√£o..."
                               class="w-full px-4 py-3 pl-12 border-2 border-gray-300 rounded-xl focus:border-primary-dynamic focus:outline-none text-lg">
                        <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                    <p class="text-sm text-gray-500 mt-2">Digite pelo menos 2 caracteres para buscar</p>
                </div>

                <!-- Resultados da Busca -->
                <div id="search-results" class="search-results p-6">
                    <div id="search-empty" class="text-center py-8">
                        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <p class="text-gray-500">Digite algo para buscar produtos do card√°pio</p>
                    </div>
                    
                    <div id="search-items" class="space-y-3 hidden">
                        <!-- Resultados ser√£o inseridos aqui -->
                    </div>

                    <div id="no-results" class="text-center py-8 hidden">
                        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.137 0-4.146-.832-5.657-2.343"></path>
                        </svg>
                        <p class="text-gray-500">Nenhum produto encontrado</p>
                        <p class="text-sm text-gray-400 mt-1">Tente usar termos diferentes</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cabe√ßalho Unificado - Header + Menu de Categorias como um √∫nico elemento fixo -->
    <div id="unified-header" class="sticky top-0 z-40">
        <!-- Header Principal -->
        <header id="header" class="bg-white/90 backdrop-blur-md shadow-sm border-b border-gray-100">
            <div class="container mx-auto px-4 py-2">
                <!-- Mobile: Logo centralizado com busca -->
                <div class="md:hidden flex items-center justify-between">
                    <div class="w-8"></div> <!-- Espa√ßador -->
                    
                    <div class="flex justify-center flex-1">
                        <img id="logo-mobile" src="" alt="Logo" 
                             class="w-3/4 sm:w-2/3 h-auto max-h-16 sm:max-h-20 object-contain logo-hover hidden rounded-lg">
                        <div id="logo-text-mobile" class="w-12 h-12 bg-primary-dynamic rounded-full flex items-center justify-center text-white font-bold text-lg">
                            
                        </div>
                    </div>
                    
                    <!-- √çcone de Busca Mobile -->
                    <button id="search-btn-mobile" class="search-icon p-2 hover:bg-gray-100 rounded-full transition-colors">
                        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- Desktop: Layout centralizado com busca -->
                <div class="hidden md:flex items-center justify-between relative">
                    <!-- √çcone de Busca Desktop (esquerda) -->
                    <button id="search-btn-desktop" class="search-icon p-3 hover:bg-gray-100 rounded-full transition-colors absolute left-0">
                        <svg class="w-7 h-7 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </button>
                    
                    <!-- Logo e nome centralizados -->
                    <div class="flex items-center space-x-4 mx-auto">
                        <img id="logo" src="" alt="Logo" 
                             class="h-20 w-20 md:h-24 md:w-24 object-cover logo-hover hidden">
                        <div class="flex flex-col">
                            <h1 id="nome-empresa" class="text-2xl md:text-3xl font-bold text-primary-dynamic leading-tight">
                                Carregando...
                            </h1>
                            <p id="slogan" class="text-sm md:text-base text-gray-600 hidden">
                                Carregando...
                            </p>
                        </div>
                    </div>
                    
                    <!-- Espa√ßo vazio √† direita para balancear o layout -->
                    <div class="w-[52px]"></div>
                </div>
            </div>
        </header>

        <!-- Menu de Categorias (parte do cabe√ßalho unificado) -->
        <div id="mobile-category-menu" class="bg-white/95 backdrop-blur-sm border-b border-gray-100 py-3 shadow-md">
            <div id="category-scroll" class="category-scroll flex overflow-x-auto px-4 space-x-3 min-h-[52px] items-center md:justify-center justify-start">
                <!-- Categorias ser√£o inseridas dinamicamente aqui -->
                <!-- Placeholder para garantir que o menu tenha conte√∫do mesmo antes do carregamento -->
                <div class="flex-shrink-0 px-4 py-2  text-transparent rounded-full text-sm font-semibold whitespace-nowrap min-w-[80px] animate-pulse">Carregando...</div>
                <div class="flex-shrink-0 px-4 py-2  text-transparent rounded-full text-sm font-semibold whitespace-nowrap min-w-[80px] animate-pulse">Carregando...</div>
                <div class="flex-shrink-0 px-4 py-2  text-transparent rounded-full text-sm font-semibold whitespace-nowrap min-w-[80px] animate-pulse">Carregando...</div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 pt-28 pb-8">

        <!-- Card√°pio -->
        <div id="cardapio" class="space-y-12">
            <!-- Categorias ser√£o inseridas aqui dinamicamente -->
        </div>

        <!-- Se√ß√£o de Avalia√ß√£o -->
        <div id="avaliacao-section" class="mt-16 text-center" style="display: none;">
            <div class="bg-white rounded-3xl p-8 shadow-xl max-w-2xl mx-auto fade-in">
                <div class="mb-6">
                    <div class="text-6xl mb-4">‚≠ê</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">Gostou do nosso atendimento?</h3>
                    <p class="text-gray-600 text-lg">Sua opini√£o √© muito importante para n√≥s!</p>
                </div>
                
                <a id="btn-avaliar" href="#" target="_blank" style="display: none;"
                   class="inline-flex items-center px-8 py-4 bg-primary-dynamic text-white rounded-2xl hover:shadow-lg transform hover:scale-105 transition-all duration-300 text-lg font-semibold">
                    <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                    </svg>
                    Avaliar no Google
                </a>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer id="footer-dynamic" class="text-white mt-20">
        <div class="container mx-auto px-4 py-12">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div id="footer-contato" class="text-center md:text-left">
                    <h4 class="font-bold text-xl mb-4 flex items-center justify-center md:justify-start text-rodape-dynamic">
                        <span class="text-2xl mr-2">üìç</span> Contato
                    </h4>
                    <div class="space-y-3 text-sm md:text-base opacity-90">
                        <p id="endereco">Carregando...</p>
                        <p id="telefone">Carregando...</p>
                        <p id="email">Carregando...</p>
                    </div>
                </div>
                
                <div id="footer-horario" class="text-center md:text-left">
                    <h4 class="font-bold text-xl mb-4 flex items-center justify-center md:justify-start text-rodape-dynamic">
                        <span class="text-2xl mr-2">üïí</span> Hor√°rio
                    </h4>
                    <div class="space-y-2 text-sm md:text-base opacity-90">
                        <p id="horario-semana">Carregando...</p>
                        <p id="horario-sabado">Carregando...</p>
                        <p id="horario-domingo">Carregando...</p>
                    </div>
                </div>
                
                <div id="footer-redes" class="text-center md:text-left">
                    <h4 class="font-bold text-xl mb-4 flex items-center justify-center md:justify-start text-rodape-dynamic">
                        <span class="text-2xl mr-2">üåê</span> Redes Sociais
                    </h4>
                    <div class="flex justify-center md:justify-start space-x-4">
                        <!-- Instagram -->
                        <a id="link-instagram" href="#" class="p-3 bg-white/20 rounded-full hover:bg-white/30 transition-all transform hover:scale-110" style="display: none;">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.40z"/>
                            </svg>
                        </a>
                        
                        <!-- Facebook -->
                        <a id="link-facebook" href="#" class="p-3 bg-white/20 rounded-full hover:bg-white/30 transition-all transform hover:scale-110" style="display: none;">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                            </svg>
                        </a>
                        
                        <!-- WhatsApp -->
                        <a id="link-whatsapp" href="#" class="p-3 bg-white/20 rounded-full hover:bg-white/30 transition-all transform hover:scale-110" style="display: none;">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-white/20 mt-8 pt-8 text-center">
                <p class="opacity-75 text-rodape-dynamic">&copy; 2024 <span id="footer-nome-empresa" class="text-rodape-dynamic">Cafeteria</span>. Todos os direitos reservados.</p>
            </div>
        </div>
        
        <!-- Bloco de Cr√©ditos com design discreto -->
        <div class="bg-gray-50 border-t border-gray-200 py-3">
            <div class="container mx-auto px-4">
                <div class="flex flex-wrap items-center justify-center text-xs text-gray-400">
                    
                    <!-- Nome do desenvolvedor com link para o site -->
                    <a href="https://www.simplisoft.com.br" target="_blank" rel="noopener noreferrer" class="text-gray-500 hover:text-gray-600 transition-colors">
                        <span>Desenvolvido por <strong>Simplisoft</strong></span>
                    </a>
                    
                    <!-- Separador -->
                    <span class="mx-2">‚Ä¢</span>
                    
                    <!-- WhatsApp apenas como √≠cone -->
                    <a href="https://wa.me/5583991185518" target="_blank" rel="noopener noreferrer"
                       class="text-gray-500 hover:text-gray-600 transition-colors" aria-label="Entre em contato pelo WhatsApp">
                        <svg class="w-4 h-4 inline" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M17.415 14.382c-.298-.149-1.759-.867-2.03-.967-.272-.099-.47-.148-.67.15-.198.296-.767.966-.94 1.164-.174.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.019-.458.13-.606.134-.133.297-.347.446-.52.148-.174.198-.298.297-.497.1-.198.05-.371-.025-.52-.075-.149-.668-1.612-.916-2.207-.242-.579-.487-.5-.668-.51-.172-.01-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.095 3.2 5.076 4.487.71.306 1.263.489 1.694.625.712.227 1.36.195 1.872.118.57-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.422 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bot√£o flutuante do carrinho - vis√≠vel por padr√£o e com estilo fixo -->
    <div id="carrinho-flutuante" class="fixed bottom-6 right-6 z-50" role="region" aria-live="polite" style="display: block; opacity: 1; position: fixed !important;">
        <button 
            type="button" 
            id="botao-carrinho" 
            class="flex items-center justify-center p-4 rounded-full bg-primary-dynamic text-white shadow-lg hover:bg-primary-dynamic/90 transition-colors relative focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-dynamic"
            aria-label="Abrir carrinho de compras"
            aria-haspopup="dialog"
            aria-controls="modal-checkout"
            style="display: flex;"
            onclick="abrirModal();"
        >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
            <span 
                id="carrinho-contador" 
                class="absolute -top-2 -right-2 bg-secondary-dynamic text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center"
                aria-live="assertive"
                aria-atomic="true"
            >0</span>
        </button>
    </div>
    
    <!-- Modal de Checkout - Sem paddings externos para ocupar 100% da tela -->
    <div id="modal-checkout" class="fixed inset-0 z-50 overflow-y-auto hidden" role="dialog" aria-labelledby="modal-titulo" aria-hidden="true">
        <div class="flex items-start sm:items-center justify-center min-h-screen pt-4 sm:pt-0 text-center sm:block">
            <!-- Overlay de fundo -->
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>

            <!-- Centralizador -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <!-- Conte√∫do do modal - com cantos retos e ocupando 100% da largura em dispositivos m√≥veis -->
            <div class="inline-block align-bottom bg-white text-left overflow-hidden shadow-xl transform transition-all w-full sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <!-- Cabe√ßalho do modal -->
                <div class="bg-primary-dynamic/10 px-4 py-3 sm:px-6 flex justify-between items-center">
                    <h3 class="text-lg leading-6 font-medium text-primary-dynamic" id="modal-titulo">Finalizar Pedido</h3>
                    <button 
                        type="button" 
                        class="fechar-modal bg-white rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-dynamic"
                        aria-label="Fechar modal"
                        onclick="fecharModal();"
                    >
                        <span class="sr-only">Fechar</span>
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                
                <!-- Indicadores de progresso -->
                <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200">
                    <!-- Step 1 -->
                    <div class="flex flex-col items-center">
                        <div id="step-indicator-1" class="w-8 h-8 rounded-full bg-primary-dynamic text-white flex items-center justify-center font-medium text-sm">
                            1
                        </div>
                        <span class="text-xs mt-1 text-gray-600">Carrinho</span>
                    </div>
                    
                    <!-- Linha de conex√£o -->
                    <div class="h-1 flex-1 bg-gray-200 mx-2">
                        <div id="progress-line-1" class="h-full bg-primary-dynamic" style="width: 0%"></div>
                    </div>
                    
                    <!-- Step 2 -->
                    <div class="flex flex-col items-center">
                        <div id="step-indicator-2" class="w-8 h-8 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center font-medium text-sm">
                            2
                        </div>
                        <span class="text-xs mt-1 text-gray-600">Entrega</span>
                    </div>
                    
                    <!-- Linha de conex√£o -->
                    <div class="h-1 flex-1 bg-gray-200 mx-2">
                        <div id="progress-line-2" class="h-full bg-primary-dynamic" style="width: 0%"></div>
                    </div>
                    
                    <!-- Step 3 -->
                    <div class="flex flex-col items-center">
                        <div id="step-indicator-3" class="w-8 h-8 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center font-medium text-sm">
                            3
                        </div>
                        <span class="text-xs mt-1 text-gray-600">Dados</span>
                    </div>
                </div>
            
            <!-- Conte√∫do do modal com scroll -->
            <div class="overflow-y-auto flex-1 p-4">
                <!-- Controles movidos para o topo -->
                <div class="flex flex-wrap gap-3 justify-between mb-4 border-b pb-[25px] md:pb-3" style="padding-bottom: 25px !important;">
                    <!-- Bot√£o para limpar carrinho (vis√≠vel em todos os steps) -->
                    <button 
                        type="button" 
                        id="botao-limpar" 
                        class="px-4 py-2 text-sm font-medium text-white bg-[#f87171] border border-transparent rounded-md shadow-sm hover:bg-[#ef4444] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#f87171] flex items-center gap-2"
                        onclick="limparCarrinho()"
                        aria-label="Limpar todos os itens do carrinho"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                    </button>
                    
                    <div class="flex gap-3">
                        <!-- Bot√£o para voltar (vis√≠vel nos steps 2 e 3) -->
                        <button 
                            type="button" 
                            id="botao-voltar" 
                            class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-dynamic hidden flex items-center gap-2"
                            onclick="voltarStep()"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                            </svg>
                            Voltar
                        </button>
                        
                        <!-- Bot√£o para continuar (vis√≠vel nos steps 1 e 2) -->
                        <button 
                            type="button" 
                            id="botao-continuar" 
                            class="px-4 py-2 text-sm font-medium text-white bg-primary-dynamic border border-transparent rounded-md shadow-sm hover:bg-primary-dynamic/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-dynamic flex items-center gap-2"
                            onclick="avancarStep()"
                        >
                            Continuar
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                            </svg>
                        </button>
                        
                        <!-- Bot√£o para enviar pedido (vis√≠vel apenas no step 3) -->
                        <button 
                            type="button" 
                            id="botao-enviar" 
                            class="px-4 py-2 text-sm font-medium text-white bg-[#25D366] border border-transparent rounded-md shadow-sm hover:bg-[#22c55e] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#25D366] hidden flex items-center gap-2"
                            onclick="finalizarPedido()"
                        >
                            Enviar Pedido
                            <!-- √çcone do WhatsApp -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- Step 1: Lista de itens no carrinho -->
                <div id="step-1" class="step">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-bold text-lg">(<span id="total-itens-carrinho">0</span>) Itens no Carrinho</h4>
                    </div>
                    <div id="carrinho-itens" class="space-y-4 mb-4 max-h-[50vh] overflow-y-auto pr-1">
                        <!-- Os itens do carrinho ser√£o inseridos aqui dinamicamente -->
                        <div class="text-center text-gray-500 py-8" id="carrinho-vazio">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-3 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                            </svg>
                            <p class="text-lg">Seu carrinho est√° vazio</p>
                            <p class="mt-2">Adicione itens do card√°pio para continuar</p>
                        </div>
                    </div>
                    
                    <!-- Exibi√ß√£o do valor total do carrinho -->
                    <div id="resumo-carrinho" class="mt-4 mb-3 bg-gray-50 p-4 rounded-lg border border-gray-200 hidden">
                        <div class="flex justify-between items-center">
                            <span class="font-medium text-gray-700">Valor Total:</span>
                            <span id="valor-total-carrinho" class="font-bold text-primary-dynamic text-lg">R$ 0,00</span>
                        </div>
                    </div>
                    <script>
                        // Renderizar itens do carrinho quando o modal for aberto
                        document.getElementById('botao-carrinho').addEventListener('click', function() {
                            renderizarItensCarrinho();
                        });
                    </script>
                </div>
                
                <!-- Step 2: Onde receber o pedido -->
                <div id="step-2" class="step hidden">
                    <h4 class="font-bold text-lg mb-4">Como voc√™ deseja receber seu pedido?</h4>
                    
                    <!-- Mensagem de taxa de entrega (inicialmente oculta) -->
                    <div id="mensagem-taxa-entrega" class="hidden mb-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 rounded-md">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 mr-2">
                                <i class="fas fa-info-circle text-yellow-600"></i>
                            </div>
                            <div>
                                <p class="font-medium text-color-dynamic" id="texto-taxa-delivery">Consulte Taxa de Entrega para sua Regi√£o com o vendedor no Whatsapp</p>
                            </div>
                        </div>
                    </div>
                    
                    <div id="opcoes-entrega" class="space-y-3">
                        <!-- As op√ß√µes de entrega ser√£o inseridas dinamicamente aqui -->
                    </div>
                    </div>
                </div>
                
                <!-- Step 3: Informa√ß√µes do cliente baseadas na escolha anterior -->
                <div id="step-3" class="step hidden p-4">
                    <h4 class="font-bold text-lg mb-4">Complete suas informa√ß√µes</h4>
                    <form id="form-cliente" class="space-y-4">
                        <!-- Campos din√¢micos baseados na op√ß√£o selecionada -->
                        <div id="campos-local" class="campos-opcao hidden">
                            <!-- Campo Mesa/Comanda - exibido apenas se configurado como Sim na planilha -->
                            <div class="form-group mb-4" id="container-mesa-comanda" style="display: none;">
                                <label for="mesa-comanda" class="block text-sm font-medium text-gray-700 mb-1">Mesa/Comanda</label>
                                <input 
                                    type="tel" 
                                    id="mesa-comanda" 
                                    name="mesa-comanda" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-dynamic focus:border-primary-dynamic"
                                    placeholder="N√∫mero da mesa ou comanda"
                                    inputmode="numeric"
                                    pattern="[0-9]*"
                                >
                            </div>
                        </div>
                        
                        <div id="campos-delivery" class="campos-opcao hidden">
                            <!-- Campo Endere√ßo para entrega -->
                            <div class="form-group mb-4">
                                <label for="endereco-entrega" class="block text-sm font-medium text-gray-700 mb-1">Endere√ßo para entrega</label>
                                <textarea 
                                    id="endereco-entrega" 
                                    name="endereco-entrega" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-dynamic focus:border-primary-dynamic"
                                    placeholder="Rua, n√∫mero, bairro, complemento, etc."
                                    rows="3"
                                    required
                                ></textarea>
                            </div>
                        </div>
                        
                        <!-- Campos comuns para todas as op√ß√µes -->
                        <!-- Campo Nome -->
                        <div class="form-group mb-4">
                            <label for="nome-cliente" class="block text-sm font-medium text-gray-700 mb-1">Nome</label>
                            <input 
                                type="text" 
                                id="nome-cliente" 
                                name="nome-cliente" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-dynamic focus:border-primary-dynamic"
                                placeholder="Seu nome completo"
                                required
                            >
                        </div>
                        
                        <!-- Layout flex√≠vel para Forma de Pagamento e Troco (60/40) -->
                        <div class="flex flex-wrap -mx-2">
                            <!-- Campo Forma de Pagamento (60%) -->
                            <div class="w-full md:w-3/5 px-2">
                                <div class="form-group mb-4" id="container-forma-pagamento">
                                    <label for="forma-pagamento" class="block text-sm font-medium text-gray-700 mb-1">Forma de Pagamento</label>
                                    <select 
                                        id="forma-pagamento" 
                                        name="forma-pagamento" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-dynamic focus:border-primary-dynamic"
                                        required
                                        onchange="verificarFormaPagamento()"
                                    >
                                        <option value="" disabled selected>Selecione a forma de pagamento</option>
                                        <!-- Op√ß√µes ser√£o preenchidas dinamicamente -->
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Campo de Troco (40% - vis√≠vel apenas quando forma de pagamento for Dinheiro) -->
                            <div class="w-full md:w-2/5 px-2">
                                <div class="form-group mb-4 hidden" id="container-troco">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Precisa de troco?</label>
                                    <div class="flex items-center space-x-4">
                                        <div class="flex items-center">
                                            <input type="radio" id="troco-sim" name="precisa-troco" value="sim" class="h-4 w-4 text-primary-dynamic focus:ring-primary-dynamic border-gray-300" onchange="mostrarCampoTroco(true)">
                                            <label for="troco-sim" class="ml-2 block text-sm text-gray-700">Sim</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="radio" id="troco-nao" name="precisa-troco" value="nao" class="h-4 w-4 text-primary-dynamic focus:ring-primary-dynamic border-gray-300" onchange="mostrarCampoTroco(false)" checked>
                                            <label for="troco-nao" class="ml-2 block text-sm text-gray-700">N√£o</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Campo de Valor do Troco (aparece na linha de baixo quando "Sim" √© selecionado) -->
                        <div id="campo-valor-troco" class="hidden mb-4">
                            <label for="valor-troco" class="block text-sm font-medium text-gray-700 mb-1">Troco para quanto?</label>
                            <input 
                                type="text" 
                                id="valor-troco" 
                                name="valor-troco" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-dynamic focus:border-primary-dynamic"
                                placeholder="R$ 0,00"
                                inputmode="numeric"
                                oninput="formatarMoeda(this)"
                            >
                        </div>
                        
                        <!-- Campo Observa√ß√£o geral -->
                        <div class="form-group">
                            <label for="observacao-geral" class="block text-sm font-medium text-gray-700 mb-1">Observa√ß√£o geral</label>
                            <textarea 
                                id="observacao-geral" 
                                name="observacao-geral" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-dynamic focus:border-primary-dynamic"
                                placeholder="Alguma observa√ß√£o adicional sobre seu pedido?"
                                rows="3"
                            ></textarea>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Fim do conte√∫do do modal -->
        </div>
    </div>

    <!-- JavaScript ser√° adicionado na pr√≥xima etapa -->
    <script>
        // URLs das planilhas
        const URLS = {
    categorias: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQQDBqBnye2mgcDJyd-iTVzjoVbyTK_dx7xaXd5g1PhX-cGUDhgbG5a7zvt6GumL9uFv5-sgnEnki48/pub?gid=1335899850&single=true&output=csv',
    itens: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQQDBqBnye2mgcDJyd-iTVzjoVbyTK_dx7xaXd5g1PhX-cGUDhgbG5a7zvt6GumL9uFv5-sgnEnki48/pub?gid=0&single=true&output=csv',
    config: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQQDBqBnye2mgcDJyd-iTVzjoVbyTK_dx7xaXd5g1PhX-cGUDhgbG5a7zvt6GumL9uFv5-sgnEnki48/pub?gid=1822785207&single=true&output=csv'
};

let dadosGlobais = {
    categorias: [],
    itens: [],
    config: {}
};

// Vari√°veis para o sistema de busca
let todosItens = [];
let searchTimeout;

        // Fun√ß√£o utilit√°ria para normalizar URLs de imagens, incluindo links de compartilhamento do Google Drive
        // Fun√ß√£o removida conforme solicitado


// Fun√ß√£o para converter CSV em array de objetos
function csvToArray(csv) {
    const lines = csv.trim().split('\n');
    if (lines.length < 2) return [];
    
    const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());
    
    return lines.slice(1).map(line => {
        const values = [];
        let current = '';
        let inQuotes = false;
        
        for (let i = 0; i < line.length; i++) {
            const char = line[i];
            if (char === '"') {
                inQuotes = !inQuotes;
            } else if (char === ',' && !inQuotes) {
                values.push(current.trim());
                current = '';
            } else {
                current += char;
            }
        }
        values.push(current.trim());
        
        const obj = {};
        headers.forEach((header, index) => {
            obj[header] = values[index] ? values[index].replace(/"/g, '') : '';
        });
        return obj;
    }).filter(obj => Object.values(obj).some(val => val !== ''));
}

// Fun√ß√£o para aplicar cores din√¢micas da planilha
function aplicarCoresDinamicas(config) {
    const root = document.documentElement;
    
    if (config['Cor Prim√°ria']) {
        root.style.setProperty('--cor-primaria', config['Cor Prim√°ria']);
    }
    
    if (config['Cor Secund√°ria']) {
        root.style.setProperty('--cor-secundaria', config['Cor Secund√°ria']);
    }
    
    if (config['Cor de Fundo']) {
        root.style.setProperty('--cor-fundo', config['Cor de Fundo']);
        document.body.style.backgroundColor = config['Cor de Fundo'];
    }
    
    // Aplicar cor do texto
    if (config['Cor do Texto']) {
        // Definir vari√°vel CSS
        root.style.setProperty('--cor-texto', config['Cor do Texto']);
        
        // Aplicar a cor diretamente aos elementos de texto principais
        document.querySelectorAll('.descricao-item, .nome-item, p:not(.text-primary-dynamic):not(.text-secondary-dynamic):not(.text-white):not(.link-color-dynamic):not(.text-rodape-dynamic)').forEach(el => {
            el.classList.add('text-color-dynamic');
        });
        
        // Aplicar ao texto do cabe√ßalho que n√£o tem cores espec√≠ficas
        document.querySelectorAll('#slogan').forEach(el => {
            el.classList.add('text-color-dynamic');
        });
    }
    
    // Aplicar cor do texto do rodap√©
    if (config['Cor do Texto Rodap√©']) {
        // Definir vari√°vel CSS
        root.style.setProperty('--cor-texto-rodape', config['Cor do Texto Rodap√©']);
        
        // Aplicar a cor aos elementos de texto do rodap√©
        document.querySelectorAll('#footer-dynamic p, #footer-dynamic .text-sm, #footer-dynamic .text-xs').forEach(el => {
            el.classList.remove('text-color-dynamic'); // Remover classe de cor de texto geral se existir
            el.classList.add('text-rodape-dynamic');
        });
    }
    
    // Aplicar cor dos links
    if (config['Cor dos Links']) {
        // Definir vari√°vel CSS
        root.style.setProperty('--cor-links', config['Cor dos Links']);
        
        // Aplicar a cor diretamente aos links que n√£o t√™m outras classes de cor
        // e que n√£o est√£o no rodap√© de cr√©ditos
        document.querySelectorAll('a:not(.bg-primary-dynamic):not(.text-white):not(.text-primary-dynamic):not(.text-secondary-dynamic):not(.text-gray-500)').forEach(el => {
            // Verificar se o link n√£o est√° no rodap√© de cr√©ditos
            if (!el.closest('.bg-gray-50')) {
                el.classList.add('link-color-dynamic');
            }
        });
    }

    const footer = document.getElementById('footer-dynamic');
    if (config['Cor Prim√°ria'] && config['Cor Secund√°ria']) {
        footer.style.background = `linear-gradient(135deg, ${config['Cor Prim√°ria']} 0%, ${config['Cor Secund√°ria']} 100%)`;
    }

    console.log('Cores aplicadas dinamicamente:', {
        primaria: config['Cor Prim√°ria'],
        secundaria: config['Cor Secund√°ria'],
        fundo: config['Cor de Fundo'],
        texto: config['Cor do Texto'],
        textoRodape: config['Cor do Texto Rodap√©'],
        links: config['Cor dos Links']
    });
}

// Fun√ß√£o para carregar dados das planilhas
async function carregarDados() {
    try {
        console.log('Carregando dados das planilhas...');
        
        const [categoriasRes, itensRes, configRes] = await Promise.all([
            fetch(URLS.categorias),
            fetch(URLS.itens),
            fetch(URLS.config)
        ]);

        const [categoriasCsv, itensCsv, configCsv] = await Promise.all([
            categoriasRes.text(),
            itensRes.text(),
            configRes.text()
        ]);

        dadosGlobais.categorias = csvToArray(categoriasCsv);
        dadosGlobais.itens = csvToArray(itensCsv);
        
        // Debug: Verificar a estrutura dos dados da categoria
        if (dadosGlobais.categorias && dadosGlobais.categorias.length > 0) {
            console.log('Estrutura da primeira categoria:', dadosGlobais.categorias[0]);
            console.log('Todas as chaves dispon√≠veis:', Object.keys(dadosGlobais.categorias[0]));
        }
        
        const configArray = csvToArray(configCsv);
        dadosGlobais.config = {};
        configArray.forEach(item => {
            if (item.Campo && item.Valor) {
                dadosGlobais.config[item.Campo] = item.Valor;
            }
        });

        // Preparar dados para busca
        prepararDadosBusca();

        aplicarCoresDinamicas(dadosGlobais.config);
        aplicarConfiguracoes();
        renderizarCardapio();
        
    } catch (error) {
        console.error('Erro ao carregar dados:', error);
        document.getElementById('loading').innerHTML = 
            '<div class="text-center"><p class="text-red-600 text-xl">Erro ao carregar card√°pio. Verifique sua conex√£o.</p></div>';
    }
}

// Fun√ß√£o para preparar dados para busca
function prepararDadosBusca() {
    todosItens = dadosGlobais.itens.filter(item => item.Dispon√≠vel === 'Sim').map(item => {
        // Encontrar categoria do item
        const categoria = dadosGlobais.categorias.find(cat => cat.Nome_Categoria === item.Categoria);
        
        return {
            ...item,
            categoriaTitulo: categoria ? categoria.T√≠tulo_Exibi√ß√£o : item.Categoria,
            searchText: `${item.Item} ${item.Descri√ß√£o} ${item.Categoria} ${categoria ? categoria.T√≠tulo_Exibi√ß√£o : ''} ${item.Classifica√ß√£o_Adicional || ''}`.toLowerCase()
        };
    });
    console.log('Dados preparados para busca:', todosItens.length, 'itens');
}

// Fun√ß√£o de busca
function realizarBusca(termo) {
    if (!termo || termo.length < 2) {
        mostrarEstadoVazio();
        return;
    }

    const termoLower = termo.toLowerCase();
    const resultados = todosItens.filter(item => 
        item.searchText.includes(termoLower)
    );

    if (resultados.length === 0) {
        mostrarSemResultados();
    } else {
        mostrarResultados(resultados, termo);
    }
}

// Fun√ß√£o para destacar texto
function destacarTexto(texto, termo) {
    if (!termo || termo.length < 2) return texto;
    
    const regex = new RegExp(`(${termo})`, 'gi');
    return texto.replace(regex, '<span class="highlight">$1</span>');
}

// Fun√ß√£o para mostrar resultados
function mostrarResultados(resultados, termo) {
    const searchEmpty = document.getElementById('search-empty');
    const searchItems = document.getElementById('search-items');
    const noResults = document.getElementById('no-results');

    searchEmpty.classList.add('hidden');
    noResults.classList.add('hidden');
    searchItems.classList.remove('hidden');

    searchItems.innerHTML = resultados.map(item => `
        <div class="search-item p-4 border border-gray-200 rounded-xl cursor-pointer" onclick="irParaItem('${item.Categoria}', '${item.Item}')">
            <div class="flex items-start space-x-4">
                ${item.Foto_URL ? `
                    <img src="${item.Foto_URL}" alt="${item.Item}" class="w-16 h-16 object-cover rounded-lg flex-shrink-0">
                ` : `
                    <div class="w-16 h-16 bg-gray-200 rounded-lg flex-shrink-0 flex items-center justify-center">
                        <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                    </div>
                `}
                <div class="flex-1 min-w-0">
                    <h4 class="font-semibold text-gray-900 mb-1">${destacarTexto(item.Item, termo)}</h4>
                    <p class="text-sm text-gray-600 mb-2">${destacarTexto(item.Descri√ß√£o || '', termo)}</p>
                    <!-- Layout melhorado para mobile: categoria e pre√ßo em linhas separadas -->
                    <div class="flex flex-col space-y-2">
                        <div class="w-full overflow-hidden">
                            <span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full inline-block truncate max-w-full">${item.categoriaTitulo}</span>
                        </div>
                        <div class="w-full flex justify-between items-center">
                            <span class="font-bold text-primary-dynamic text-right w-full">${item.Pre√ßo || 'Consulte'}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `).join('');
}

// Fun√ß√£o para mostrar estado vazio
function mostrarEstadoVazio() {
    const searchEmpty = document.getElementById('search-empty');
    const searchItems = document.getElementById('search-items');
    const noResults = document.getElementById('no-results');

    searchEmpty.classList.remove('hidden');
    searchItems.classList.add('hidden');
    noResults.classList.add('hidden');
}

// Fun√ß√£o para mostrar sem resultados
function mostrarSemResultados() {
    const searchEmpty = document.getElementById('search-empty');
    const searchItems = document.getElementById('search-items');
    const noResults = document.getElementById('no-results');

    searchEmpty.classList.add('hidden');
    searchItems.classList.add('hidden');
    noResults.classList.remove('hidden');
}

// Fun√ß√£o para ir para item espec√≠fico
function irParaItem(categoria, nomeItem) {
    // Fechar busca
    fecharBusca();
    
    // Filtrar por categoria
    filtrarPorCategoria(categoria);
    
    // Scroll para o item espec√≠fico
    setTimeout(() => {
        const elementos = document.querySelectorAll('.menu-item h3');
        for (let elemento of elementos) {
            if (elemento.textContent.trim() === nomeItem) {
                elemento.closest('.menu-item').scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
                
                // Destacar temporariamente o item
                const card = elemento.closest('.menu-item');
                card.style.boxShadow = '0 0 0 3px var(--cor-primaria)';
                card.style.transition = 'box-shadow 0.3s ease';
                
                setTimeout(() => {
                    card.style.boxShadow = '';
                }, 2000);
                break;
            }
        }
    }, 300);
}

// Fun√ß√µes para controlar a busca
function abrirBusca() {
    const overlay = document.getElementById('search-overlay');
    const container = document.getElementById('search-container');
    const input = document.getElementById('search-input');
    
    overlay.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
    
    setTimeout(() => {
        container.classList.add('active');
        input.focus();
    }, 50);
}

function fecharBusca() {
    const overlay = document.getElementById('search-overlay');
    const container = document.getElementById('search-container');
    const input = document.getElementById('search-input');
    
    container.classList.remove('active');
    document.body.style.overflow = '';
    
    setTimeout(() => {
        overlay.classList.add('hidden');
        input.value = '';
        mostrarEstadoVazio();
    }, 300);
}

// Aplicar configura√ß√µes do site
function aplicarConfiguracoes() {
    const config = dadosGlobais.config;
    
    // T√≠tulo e identifica√ß√£o b√°sica
    document.title = config['T√≠tulo da P√°gina'] || 'Card√°pio Online';
    document.getElementById('nome-empresa').textContent = config['Nome da Empresa'] || 'Cafeteria';
    
    // Nome da empresa no rodap√©
    const nomeEmpresaElement = document.getElementById('footer-nome-empresa');
    const nomeEmpresa = config['Nome da Empresa'] || 'Cafeteria';
    nomeEmpresaElement.textContent = nomeEmpresa;
    nomeEmpresaElement.classList.add('text-rodape-dynamic');
    nomeEmpresaElement.classList.remove('text-color-dynamic');
    
    // Texto da taxa de delivery
    const textoTaxaDelivery = document.getElementById('texto-taxa-delivery');
    if (textoTaxaDelivery) {
        textoTaxaDelivery.textContent = config['Step-2-taxa-delivery'] || 'Consulte Taxa de Entrega para sua Regi√£o';
    }
    
    // Preencher as iniciais do nome da empresa no logo de texto mobile
    const logoTextMobile = document.getElementById('logo-text-mobile');
    if (logoTextMobile) {
        // Extrair as iniciais do nome da empresa (at√© 2 caracteres)
        const palavras = nomeEmpresa.split(' ');
        let iniciais = '';
        
        // Pegar a primeira letra de cada palavra, at√© 2 letras
        for (let i = 0; i < Math.min(2, palavras.length); i++) {
            if (palavras[i].length > 0) {
                iniciais += palavras[i][0].toUpperCase();
            }
        }
        
        // Se s√≥ tiver uma palavra, usar as duas primeiras letras
        if (iniciais.length === 1 && nomeEmpresa.length > 1) {
            iniciais += nomeEmpresa[1].toUpperCase();
        }
        
        logoTextMobile.textContent = iniciais;
    }
    
    // Configura√ß√µes de SEO - usando os IDs para garantir que as meta tags sejam preenchidas corretamente
    // Descri√ß√£o
    if (config['Descri√ß√£o SEO']) {
        document.getElementById('meta-description').setAttribute('content', config['Descri√ß√£o SEO']);
        document.getElementById('og-description').setAttribute('content', config['Descri√ß√£o SEO']);
        document.getElementById('twitter-description').setAttribute('content', config['Descri√ß√£o SEO']);
    } else {
        const descricaoPadrao = `Card√°pio online de ${config['Nome da Empresa'] || 'Cafeteria'}`;
        document.getElementById('meta-description').setAttribute('content', descricaoPadrao);
        document.getElementById('og-description').setAttribute('content', descricaoPadrao);
        document.getElementById('twitter-description').setAttribute('content', descricaoPadrao);
    }
    
    // Palavras-chave
    if (config['Palavras-chave']) {
        document.getElementById('meta-keywords').setAttribute('content', config['Palavras-chave']);
    } else {
        document.getElementById('meta-keywords').setAttribute('content', 'card√°pio, comida, restaurante');
    }
    
    // Idioma
    if (config['Idioma']) {
        document.documentElement.lang = config['Idioma'];
    }
    
    // T√≠tulo para compartilhamento
    const tituloPagina = config['T√≠tulo da P√°gina'] || 'Card√°pio Online';
    document.getElementById('og-title').setAttribute('content', tituloPagina);
    document.getElementById('twitter-title').setAttribute('content', tituloPagina);
    
    // URL e imagem para compartilhamento
    const urlAtual = window.location.href;
    document.getElementById('og-url').setAttribute('content', urlAtual);
    
    // Imagem para compartilhamento j√° definida diretamente no HTML
    // A URL da imagem √©: https://jaguariunaonline.com.br/pipoca-gourmet-jaguariuna/img/amo-pipoca-gourmet.jpg
    
    // Configurar favicon
    if (config['Favicon URL']) {
        document.querySelector('link[rel="icon"]').setAttribute('href', processarURLImagem(config['Favicon URL']));
    }
    
    // Imagem para compartilhamento social definida diretamente no HTML
    // N√£o √© mais necess√°rio configurar via JavaScript
    
    const sloganElement = document.getElementById('slogan');
    if (config['Slogan']) {
        sloganElement.textContent = config['Slogan'];
        sloganElement.classList.remove('hidden');
    }
    
    // Logo para desktop
    if (config['Logo URL']) {
        const logo = document.getElementById('logo');
        logo.src = processarURLImagem(config['Logo URL']); // Processar URL para suportar Dropbox
        logo.classList.remove('hidden');
    }
    
    // Carregar op√ß√µes de entrega da planilha
    carregarOpcoesEntrega(config);
    

    // Logo para mobile
    if (config['Logo Mobile URL']) {
        const logoMobile = document.getElementById('logo-mobile');
        logoMobile.src = processarURLImagem(config['Logo Mobile URL']); // Processar URL para suportar Dropbox
        logoMobile.classList.remove('hidden');
        logoMobile.classList.remove('rounded-full');
        logoMobile.classList.add('w-3/4', 'h-auto', 'max-h-16', 'object-contain', 'rounded-lg');
        document.getElementById('logo-text-mobile').style.display = 'none';
    } else if (config['Logo URL']) {
        const logoMobile = document.getElementById('logo-mobile');
        logoMobile.src = processarURLImagem(config['Logo URL']); // Processar URL para suportar Dropbox
        logoMobile.classList.remove('hidden');
        logoMobile.classList.add('w-3/4', 'h-auto', 'max-h-16', 'object-contain', 'rounded-lg');
        document.getElementById('logo-text-mobile').style.display = 'none';
    }

    // Informa√ß√µes de contato - ocultar se√ß√£o inteira se n√£o houver dados
    const temContato = config['Endere√ßo Completo'] || config['Telefone'] || config['Email'];
    
    if (temContato) {
        document.getElementById('footer-contato').style.display = 'block';
        
        // Mostrar ou ocultar cada campo individualmente
        if (config['Endere√ßo Completo']) {
            document.getElementById('endereco').textContent = config['Endere√ßo Completo'];
            document.getElementById('endereco').style.display = 'block';
            document.getElementById('endereco').classList.add('text-rodape-dynamic');
            document.getElementById('endereco').classList.remove('text-color-dynamic');
        } else {
            document.getElementById('endereco').style.display = 'none';
        }
        
        if (config['Telefone']) {
            document.getElementById('telefone').textContent = config['Telefone'];
            document.getElementById('telefone').style.display = 'block';
            document.getElementById('telefone').classList.add('text-rodape-dynamic');
            document.getElementById('telefone').classList.remove('text-color-dynamic');
        } else {
            document.getElementById('telefone').style.display = 'none';
        }
        
        if (config['Email']) {
            document.getElementById('email').textContent = config['Email'];
            document.getElementById('email').style.display = 'block';
            document.getElementById('email').classList.add('text-rodape-dynamic');
            document.getElementById('email').classList.remove('text-color-dynamic');
        } else {
            document.getElementById('email').style.display = 'none';
        }
    } else {
        // Ocultar toda a se√ß√£o de contato
        document.getElementById('footer-contato').style.display = 'none';
    }
    
    // Hor√°rios - ocultar se√ß√£o inteira se n√£o houver dados
    const temHorarios = config['Segunda a Sexta'] || config['S√°bado'] || config['Domingo'];
    
    if (temHorarios) {
        document.getElementById('footer-horario').style.display = 'block';
        
        // Mostrar ou ocultar cada campo individualmente
        if (config['Segunda a Sexta']) {
            document.getElementById('horario-semana').textContent = `Seg-Sex: ${config['Segunda a Sexta']}`;
            document.getElementById('horario-semana').style.display = 'block';
            document.getElementById('horario-semana').classList.add('text-rodape-dynamic');
            document.getElementById('horario-semana').classList.remove('text-color-dynamic');
        } else {
            document.getElementById('horario-semana').style.display = 'none';
        }
        
        if (config['S√°bado']) {
            document.getElementById('horario-sabado').textContent = `S√°bado: ${config['S√°bado']}`;
            document.getElementById('horario-sabado').style.display = 'block';
            document.getElementById('horario-sabado').classList.add('text-rodape-dynamic');
            document.getElementById('horario-sabado').classList.remove('text-color-dynamic');
        } else {
            document.getElementById('horario-sabado').style.display = 'none';
        }
        
        if (config['Domingo']) {
            document.getElementById('horario-domingo').textContent = `Domingo: ${config['Domingo']}`;
            document.getElementById('horario-domingo').style.display = 'block';
            document.getElementById('horario-domingo').classList.add('text-rodape-dynamic');
            document.getElementById('horario-domingo').classList.remove('text-color-dynamic');
        } else {
            document.getElementById('horario-domingo').style.display = 'none';
        }
    } else {
        // Ocultar toda a se√ß√£o de hor√°rios
        document.getElementById('footer-horario').style.display = 'none';
    }

    // Links sociais din√¢micos baseados na planilha - ocultar se√ß√£o inteira se n√£o houver dados
    const linkInstagram = document.getElementById('link-instagram');
    const linkFacebook = document.getElementById('link-facebook');
    const linkWhatsapp = document.getElementById('link-whatsapp');
    
    const temRedesSociais = config['Instagram URL'] || config['Facebook URL'] || config['WhatsApp'];
    
    if (temRedesSociais) {
        document.getElementById('footer-redes').style.display = 'block';
        
        // Mostrar ou ocultar cada rede social individualmente
        if (config['Instagram URL']) {
            linkInstagram.href = config['Instagram URL'];
            linkInstagram.style.display = 'block';
        } else {
            linkInstagram.style.display = 'none';
        }

        if (config['Facebook URL']) {
            linkFacebook.href = config['Facebook URL'];
            linkFacebook.style.display = 'block';
        } else {
            linkFacebook.style.display = 'none';
        }

        if (config['WhatsApp']) {
            const whatsapp = config['WhatsApp'].replace(/\D/g, '');
            linkWhatsapp.href = `https://wa.me/${whatsapp}`;
            linkWhatsapp.style.display = 'block';
        } else {
            linkWhatsapp.style.display = 'none';
        }
    } else {
        // Ocultar toda a se√ß√£o de redes sociais
        document.getElementById('footer-redes').style.display = 'none';
    }

    // Configura√ß√£o do Google Meu Neg√≥cio - ocultar se√ß√£o inteira se n√£o houver URL
    if (config['Google Meu Neg√≥cio URL']) {
        document.getElementById('avaliacao-section').style.display = 'block';
        document.getElementById('btn-avaliar').href = config['Google Meu Neg√≥cio URL'];
        document.getElementById('btn-avaliar').style.display = 'inline-flex';
    } else {
        document.getElementById('avaliacao-section').style.display = 'none';
    }

    if (config['Moeda']) {
        window.moedaSite = config['Moeda'];
    }

    console.log('Configura√ß√µes aplicadas:', config);
}

// Fun√ß√£o para processar URLs de imagens (Dropbox e outras fontes)
function processarURLImagem(url) {
    if (!url) return '';
    
    // Converter URLs do Dropbox para formato raw
    if (url.includes('dropbox.com') && !url.includes('raw=1')) {
        // Se j√° tem par√¢metros na URL, adiciona &raw=1, sen√£o adiciona ?raw=1
        return url.includes('?') ? `${url}&raw=1` : `${url}?raw=1`;
    }
    
    return url; // Retorna a URL original para outras fontes
}

// Fun√ß√£o para aplicar cores aos elementos criados dinamicamente
function aplicarCoresDinamicasAosElementos(elemento) {
    // Aplicar cor de texto aos elementos de texto
    const elementosTexto = elemento.querySelectorAll('.descricao-item, .nome-item, p:not(.text-primary-dynamic):not(.text-secondary-dynamic):not(.text-white):not(.link-color-dynamic):not(.text-rodape-dynamic)');
    elementosTexto.forEach(el => {
        el.classList.add('text-color-dynamic');
    });
    
    // Aplicar cor de texto do rodap√© aos elementos do rodap√©
    if (elemento.closest('#footer-dynamic')) {
        const elementosTextoRodape = elemento.querySelectorAll('p, .text-sm, .text-xs');
        elementosTextoRodape.forEach(el => {
            el.classList.remove('text-color-dynamic'); // Remover classe de cor de texto geral se existir
            el.classList.add('text-rodape-dynamic');
        });
    }
    
    // Aplicar cor de links aos links (exceto os do rodap√© de cr√©ditos)
    const elementosLinks = elemento.querySelectorAll('a:not(.bg-primary-dynamic):not(.text-white):not(.text-primary-dynamic):not(.text-secondary-dynamic):not(.text-gray-500)');
    elementosLinks.forEach(el => {
        // Verificar se o link n√£o est√° no rodap√© de cr√©ditos
        if (!el.closest('.bg-gray-50')) {
            el.classList.add('link-color-dynamic');
        }
    });
}

// Fun√ß√£o para atualizar o pre√ßo do produto com base nas varia√ß√µes selecionadas
function atualizarPrecoComVariacoes(checkbox, itemId) {
    try {
        // Buscar o container de varia√ß√µes
        const container = checkbox.closest('.variacoes-container');
        if (!container) {
            console.error('Container de varia√ß√µes n√£o encontrado');
            return;
        }
        
        // Encontrar o card do produto - necess√°rio para encontrar e atualizar o elemento de pre√ßo
        const cardItem = container.closest('.menu-item');
        if (!cardItem) {
            console.error('Card do produto n√£o encontrado');
            return;
        }
        
        // Encontrar o elemento de pre√ßo no card
        const priceHighlight = cardItem.querySelector('.price-highlight');
        if (!priceHighlight) {
            console.error('Elemento .price-highlight n√£o encontrado no card');
            return;
        }
        
        // Encontrar o span dentro do price-highlight onde o pre√ßo √© exibido
        let precoElement = priceHighlight.querySelector('span');
        if (!precoElement) {
            console.error('Elemento span dentro de .price-highlight n√£o encontrado');
            // Criar o elemento span se n√£o existir
            precoElement = document.createElement('span');
            precoElement.className = 'font-bold';
            priceHighlight.appendChild(precoElement);
            return;
        }
        
        // Obter o pre√ßo base do produto
        // Primeiro tentamos obter do data-attribute, que deve conter apenas o valor num√©rico
        let precoBaseStr = container.getAttribute('data-item-preco');
        
        // Se n√£o encontramos no data-attribute, tentamos extrair do texto vis√≠vel
        if (!precoBaseStr || precoBaseStr === '0' || precoBaseStr === '') {
            // Pegamos o texto do pre√ßo exibido e extra√≠mos o valor num√©rico
            const precoVisivel = precoElement.textContent.trim();
            console.log('Extraindo pre√ßo do texto vis√≠vel:', precoVisivel);
            
            // Extrair apenas n√∫meros, ponto e v√≠rgula (removendo R$, etc)
            precoBaseStr = precoVisivel.replace(/[^0-9.,]/g, '');
            
            // Atualizar o data-attribute com o valor extra√≠do para uso futuro
            container.setAttribute('data-item-preco', precoBaseStr.replace(',', '.'));
        }
        
        // Garantir que o pre√ßo base esteja em formato num√©rico correto para c√°lculos
        precoBaseStr = precoBaseStr.replace(',', '.');
        
        // Converter para n√∫mero
        const precoBase = parseFloat(precoBaseStr);
        if (isNaN(precoBase)) {
            console.error('Pre√ßo base inv√°lido ap√≥s convers√£o:', precoBaseStr);
            return;
        }
        
        console.log('Pre√ßo base identificado e convertido:', precoBase);
        
        // Buscar todas as varia√ß√µes selecionadas
        const checkboxesSelecionados = container.querySelectorAll('input[type="checkbox"]:checked');
        
        // Calcular o pre√ßo total com as varia√ß√µes
        let precoTotal = precoBase;
        let variacoesTexto = [];
        
        // Processar cada varia√ß√£o selecionada
        checkboxesSelecionados.forEach(cb => {
            // Obter o pre√ßo adicional da varia√ß√£o
            const precoAdicionalStr = cb.getAttribute('data-preco-adicional');
            
            // Debug: Mostrar cada varia√ß√£o e seu pre√ßo adicional
            console.log(`Varia√ß√£o selecionada: ${cb.value}, Pre√ßo adicional (string): ${precoAdicionalStr}`);
            
            // Converter para n√∫mero garantindo que temos um valor v√°lido
            let precoAdicional = 0;
            if (precoAdicionalStr && precoAdicionalStr !== '') {
                precoAdicional = parseFloat(precoAdicionalStr.toString().replace(',', '.'));
            }
            
            // Debug: Mostrar o pre√ßo adicional convertido
            console.log(`Pre√ßo adicional convertido: ${precoAdicional}`);
            
            if (!isNaN(precoAdicional) && precoAdicional > 0) {
                // Somar ao pre√ßo total
                precoTotal += precoAdicional;
                variacoesTexto.push(`${cb.value} (+R$${precoAdicional.toFixed(2).replace('.', ',')})`);
            } else {
                variacoesTexto.push(cb.value);
            }
        });
        
        // Debug: Mostrar o pre√ßo total calculado
        console.log('Pre√ßo total calculado:', precoTotal, 'Varia√ß√µes:', variacoesTexto.join(', '));
        
        // Formatar o pre√ßo total para exibi√ß√£o (com duas casas decimais e v√≠rgula)
        const precoFormatado = `R$${precoTotal.toFixed(2).replace('.', ',')}`;        
        
        // Atualizar o texto do pre√ßo com destaque visual
        precoElement.textContent = precoFormatado;
        
        // Adicionar anima√ß√£o para destacar a mudan√ßa de pre√ßo
        precoElement.classList.add('price-updated');
        setTimeout(() => {
            precoElement.classList.remove('price-updated');
        }, 1000);
        
        // Verificar se h√° varia√ß√µes selecionadas com valor adicional
        let temVariacoesComValor = false;
        checkboxesSelecionados.forEach(cb => {
            const precoAdicionalStr = cb.getAttribute('data-preco-adicional');
            if (precoAdicionalStr && parseFloat(precoAdicionalStr.replace(',', '.')) > 0) {
                temVariacoesComValor = true;
            }
        });
        
        // Atualizar o estilo para destacar que o pre√ßo √© total (base + varia√ß√µes)
        if (checkboxesSelecionados.length > 0) {
            // Verificar se h√° varia√ß√µes com valor adicional para aplicar o estilo verde
            if (temVariacoesComValor) {
                // Pre√ßo com varia√ß√µes que t√™m valor adicional
                priceHighlight.classList.add('bg-green-100', 'border-green-300');
                priceHighlight.classList.remove('bg-primary-dynamic/10', 'border-primary-dynamic/20');
                precoElement.classList.add('text-green-700', 'font-bold');
                
                // Indicador visual de que o pre√ßo tem adi√ß√µes (seta verde apontando para esquerda)
                if (!priceHighlight.querySelector('.variacao-badge')) {
                    const badgeElement = document.createElement('span');
                    badgeElement.className = 'variacao-badge text-green-500 inline-block';
                    badgeElement.style.marginLeft = '3px';
                    badgeElement.style.verticalAlign = 'middle';
                    badgeElement.style.transform = 'translateY(-1px)';
                    badgeElement.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H6M12 5l-7 7 7 7"/></svg>';
                    badgeElement.title = 'Pre√ßo com adi√ß√µes selecionadas';
                    precoElement.appendChild(badgeElement);
                }
            } else {
                // Varia√ß√µes selecionadas mas sem valor adicional - estilo normal
                priceHighlight.classList.remove('bg-green-100', 'border-green-300');
                priceHighlight.classList.add('bg-primary-dynamic/10', 'border-primary-dynamic/20');
                precoElement.classList.remove('text-green-700');
                
                // Remover badge de varia√ß√£o se existir
                const badge = priceHighlight.querySelector('.variacao-badge');
                if (badge) {
                    badge.remove();
                }
            }
        } else {
            // Pre√ßo base sem varia√ß√µes
            priceHighlight.classList.remove('bg-green-100', 'border-green-300');
            priceHighlight.classList.add('bg-primary-dynamic/10', 'border-primary-dynamic/20');
            precoElement.classList.remove('text-green-700');
            
            // Remover badge de varia√ß√£o se existir
            const badge = priceHighlight.querySelector('.variacao-badge');
            if (badge) {
                badge.remove();
            }
        }
        
        // Efeito sutil de destaque para a mudan√ßa
        precoElement.classList.add('highlight-price-change');
        
        // Adicionar o estilo da anima√ß√£o se n√£o existir
        if (!document.getElementById('price-highlight-animation')) {
            const styleElement = document.createElement('style');
            styleElement.id = 'price-highlight-animation';
            styleElement.textContent = `
                @keyframes highlightPriceChange {
                    0% { transform: scale(1); }
                    50% { transform: scale(1.1); }
                    100% { transform: scale(1); }
                }
                .highlight-price-change {
                    animation: highlightPriceChange 0.5s ease;
                }
                @keyframes priceUpdated {
                    0% { color: var(--primary-color); }
                    30% { color: #22c55e; font-weight: bold; }
                    100% { color: var(--primary-color); }
                }
                .price-updated {
                    animation: priceUpdated 1s ease;
                    font-weight: bold;
                }
            `;
            document.head.appendChild(styleElement);
        }
        
        // Remover a classe de destaque ap√≥s a anima√ß√£o
        setTimeout(() => {
            precoElement.classList.remove('highlight-price-change');
        }, 500);
        
        // Registrar sucesso da opera√ß√£o
        console.log(`Pre√ßo atualizado com sucesso para ${precoFormatado} (Base: ${precoBase.toFixed(2)})`);
        
        // Adicionar tooltip detalhado com informa√ß√µes sobre o pre√ßo
        if (variacoesTexto.length > 0) {
            // Criar tooltip detalhado mostrando o pre√ßo base e cada varia√ß√£o adicionada
            const tooltipContent = `Pre√ßo base: R$${precoBase.toFixed(2).replace('.', ',')}
Varia√ß√µes: ${variacoesTexto.join(', ')}`;
            priceHighlight.setAttribute('data-tooltip', tooltipContent);
            priceHighlight.title = tooltipContent.replace('\n', ' - ');
        } else {
            // Sem varia√ß√µes, remover tooltip
            priceHighlight.removeAttribute('data-tooltip');
            priceHighlight.title = '';
        }
        
        // Atualizar estilo visual dos bot√µes de varia√ß√£o
        const variacaoBtns = container.querySelectorAll('.variacao-btn');
        variacaoBtns.forEach(btn => {
            const input = btn.parentElement.querySelector('input');
            if (input && input.checked) {
                btn.classList.remove('bg-white', 'text-gray-700');
                btn.classList.add('bg-primary-dynamic', 'text-white', 'border-primary-dynamic');
            } else {
                btn.classList.remove('bg-primary-dynamic', 'text-white', 'border-primary-dynamic');
                btn.classList.add('bg-white', 'text-gray-700');
            }
        });
        
    } catch(e) {
        console.error('Erro ao atualizar pre√ßo:', e);
    }
}

// Fun√ß√£o para adicionar ao carrinho com varia√ß√£o

// Fun√ß√£o para adicionar ao carrinho com varia√ß√£o
function adicionarAoCarrinhoComVariacao(itemId, itemTitulo, button) {
    try {
        // Encontrar o container do produto
        const produtoContainer = button.closest('.menu-item');
        if (!produtoContainer) {
            console.error('Container do produto n√£o encontrado');
            return;
        }
        
        // Usar os par√¢metros recebidos ou buscar informa√ß√µes do produto se necess√°rio
        const titulo = itemTitulo || (produtoContainer.querySelector('.menu-item-title') ? produtoContainer.querySelector('.menu-item-title').textContent.trim() : 'Produto');
        // J√° recebemos o itemId como par√¢metro, mas garantimos que ele exista
        itemId = itemId || produtoContainer.getAttribute('data-item-id') || produtoContainer.id || `item-${Date.now()}`;
        
        // Encontrar o container de varia√ß√µes
        const variacoesContainer = produtoContainer.querySelector('.variacoes-container');
        if (!variacoesContainer) {
            // Se n√£o houver varia√ß√µes, adicionar normalmente com os par√¢metros corretos
            adicionarAoCarrinhoSimples(itemId, titulo, button, 0);
            return;
        }
        
        // Verificar se √© uma sele√ß√£o obrigat√≥ria
        const isRequired = variacoesContainer.getAttribute('data-required') === 'true';
        
        // Buscar checkboxes selecionados
        const checkboxesSelecionados = variacoesContainer.querySelectorAll('input[type="checkbox"]:checked');
        
        // Se for obrigat√≥rio e nenhuma op√ß√£o estiver selecionada, destacar as varia√ß√µes com borda vermelha
        if (isRequired && checkboxesSelecionados.length === 0) {
            // Destacar o container de varia√ß√µes com borda vermelha
            variacoesContainer.classList.add('border-red-500', 'border-2', 'rounded', 'p-2', 'animate__animated', 'animate__headShake');
            
            // Piscar o container das varia√ß√µes para chamar aten√ß√£o
            setTimeout(() => {
                variacoesContainer.classList.remove('animate__headShake');
            }, 1000);
            
            // Remover o destaque ap√≥s 3 segundos
            setTimeout(() => {
                variacoesContainer.classList.remove('border-red-500', 'border-2', 'animate__animated');
                variacoesContainer.classList.add('border', 'border-gray-200'); // Voltar para uma borda sutil normal
            }, 3000);
            
            return;
        }
        
        // Inicializar vari√°veis
        let tituloFinal = titulo;
        let precoAdicionalTotal = 0;
        
        // Se temos varia√ß√µes selecionadas
        if (checkboxesSelecionados.length > 0) {
            // Coletar todas as varia√ß√µes selecionadas e seus pre√ßos adicionais
            const variacoes = [];
            
            checkboxesSelecionados.forEach(cb => {
                // Obter valor e pre√ßo adicional de cada varia√ß√£o
                const valorVariacao = cb.value;
                const precoAdicional = parseFloat(cb.getAttribute('data-preco-adicional') || '0');
                
                // Formatar o pre√ßo adicional para exibi√ß√£o
                const precoAdicionalFormatado = precoAdicional.toFixed(2).replace('.', ',');
                
                // Adicionar ao array com formato "Nome +R$XX,XX"
                if (!isNaN(precoAdicional) && precoAdicional > 0) {
                    variacoes.push(`${valorVariacao} +R$${precoAdicionalFormatado}`);
                } else {
                    variacoes.push(valorVariacao);
                }
                
                // Adicionar o pre√ßo adicional ao total
                if (!isNaN(precoAdicional)) {
                    precoAdicionalTotal += precoAdicional;
                }
            });
            
            // Concatenar o t√≠tulo com as varia√ß√µes selecionadas incluindo os pre√ßos
            tituloFinal = `${titulo} (${variacoes.join(', ')})`;
            console.log(`Varia√ß√µes selecionadas com pre√ßos: ${variacoes.join(', ')} para o produto: ${titulo}`);
            console.log(`Pre√ßo adicional total: R$ ${precoAdicionalTotal.toFixed(2)}`);
        } else {
            // Nenhuma varia√ß√£o selecionada, mantenha o t√≠tulo original
            console.log(`Nenhuma varia√ß√£o selecionada para o produto: ${titulo}`);
        }
        
        // Chamar a fun√ß√£o para adicionar ao carrinho
        adicionarAoCarrinhoSimples(itemId, tituloFinal, button, precoAdicionalTotal);
        
    } catch (error) {
        console.error('Erro ao adicionar item com varia√ß√£o ao carrinho:', error);
        alert('Ocorreu um erro ao adicionar o item ao carrinho. Por favor, tente novamente.');
    }
}

// Renderizar card√°pio
function renderizarCardapio() {
    console.log('Iniciando renderiza√ß√£o do card√°pio...');
    
    const cardapioContainer = document.getElementById('cardapio');
    const categoryScrollMobile = document.getElementById('category-scroll');
    
    // Limpar containers
    cardapioContainer.innerHTML = '';
    categoryScrollMobile.innerHTML = ''; // Remove os placeholders de carregamento
    
    const categoriasAtivas = dadosGlobais.categorias
        .filter(cat => cat.Ativa === 'Sim')
        .sort((a, b) => parseInt(a.Ordem_Exibi√ß√£o || 0) - parseInt(b.Ordem_Exibi√ß√£o || 0));

    if (categoriasAtivas.length === 0) {
        cardapioContainer.innerHTML = '<div class="text-center text-gray-600 text-xl">Nenhuma categoria encontrada</div>';
        document.getElementById('loading').style.display = 'none';
        return;
    }

    // Criar bot√£o "Todos" para mobile (transformado em link √¢ncora)
    const btnTodosMobile = document.createElement('a');
    btnTodosMobile.className = 'category-item active flex-shrink-0 px-4 py-2 bg-primary-dynamic text-white rounded-full text-sm font-semibold whitespace-nowrap min-w-[80px] text-center';
    btnTodosMobile.textContent = '‚ú® Todos';
    btnTodosMobile.dataset.categoria = '';
    btnTodosMobile.setAttribute('data-target', 'categoria-todos');
    btnTodosMobile.href = '#categoria-todos';
    btnTodosMobile.style.textDecoration = 'none';
    categoryScrollMobile.appendChild(btnTodosMobile);

    // Criar filtros para todas as plataformas
    categoriasAtivas.forEach(categoria => {
        // Filtro scroll horizontal (transformado em link √¢ncora)
        const btnMobile = document.createElement('a');
        btnMobile.className = 'category-item flex-shrink-0 px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-semibold whitespace-nowrap hover-primary-dynamic transition-all min-w-[80px] text-center';
        btnMobile.textContent = categoria.T√≠tulo_Exibi√ß√£o || categoria.Nome_Categoria;
        btnMobile.dataset.categoria = categoria.Nome_Categoria;
        const targetId = `categoria-${categoria.Nome_Categoria.toLowerCase().replace(/\s+/g, '-')}`;
        btnMobile.setAttribute('data-target', targetId);
        btnMobile.href = `#${targetId}`;
        btnMobile.style.textDecoration = 'none';
        categoryScrollMobile.appendChild(btnMobile);
    });

    // Adicionar a se√ß√£o "Todos" com ID para √¢ncora
    const todosSection = document.createElement('section');
    todosSection.id = 'categoria-todos';
    todosSection.className = 'categoria-secao fade-in';
    todosSection.innerHTML = `
        <div class="mb-8 pt-[30px]">
            <div class="text-center mb-8">
                <h2 class="text-3xl md:text-4xl font-bold text-primary-dynamic mb-4">‚ú® Todos os Produtos</h2>
                <p class="text-gray-600 text-lg md:text-xl max-w-3xl mx-auto leading-relaxed">
                    Veja todos os nossos produtos dispon√≠veis
                </p>
            </div>
        </div>
    `;
    cardapioContainer.appendChild(todosSection);

    // Aplicar cores din√¢micas ao elemento "Todos os Produtos"
    aplicarCoresDinamicasAosElementos(todosSection);
    
    // Renderizar se√ß√µes de categoria
    categoriasAtivas.forEach(categoria => {
        const itensCategoria = dadosGlobais.itens.filter(item => {
            // Verifica se o item est√° dispon√≠vel
            const disponivel = item.Dispon√≠vel ? item.Dispon√≠vel.trim() : '';
            if (disponivel !== 'Sim') return false;
            
            // Processa categoria do filtro atual
            const categoriaFiltro = categoria.Nome_Categoria ? categoria.Nome_Categoria.trim() : '';
            
            // Processa categorias do item (pode conter m√∫ltiplas categorias separadas por v√≠rgula)
            const categoriaItem = item.Categoria ? item.Categoria.trim() : '';
            
            // Se o item n√£o tem categoria, n√£o mostrar em nenhuma categoria
            if (!categoriaItem) return false;
            
            // Divide as categorias do item em um array, removendo espa√ßos extras
            const categoriasDoItem = categoriaItem.split(',').map(cat => cat.trim());
            
            // Verifica se a categoria atual est√° entre as categorias do item
            return categoriasDoItem.includes(categoriaFiltro);
        });

        if (itensCategoria.length === 0) return;

        // Verificar e logar informa√ß√µes sobre a categoria e sua imagem para depura√ß√£o
        console.log('Renderizando categoria:', categoria.Nome_Categoria);
        console.log('Campos dispon√≠veis na categoria:', Object.keys(categoria));
        
        // Com base na planilha compartilhada, vamos tentar todos os poss√≠veis campos para URL da imagem
        // O campo correto √© 'E' na planilha que pode ser mapeado para diferentes nomes
        const imagemURLOriginal = categoria.E || categoria.Foto_URL || categoria.Foto_Categoria || categoria.Imagem || '';
        // Processar URL para suportar Dropbox e outras fontes externas
        const imagemURL = processarURLImagem(imagemURLOriginal);
        
        // Criar ID da se√ß√£o para a √¢ncora de navega√ß√£o
        const targetId = `categoria-${categoria.Nome_Categoria.toLowerCase().replace(/\s+/g, '-')}`;
        
        const secaoHtml = `
            <section id="${targetId}" class="categoria-secao fade-in" data-categoria="${categoria.Nome_Categoria}">
                <div class="mb-8 pt-[30px]">
                    ${imagemURL ? `
                        <img src="${imagemURL}" alt="${categoria.T√≠tulo_Exibi√ß√£o}" 
                             class="w-full h-40 md:h-56 object-cover rounded-3xl mb-6 shadow-lg">
                    ` : ''}
                    <div class="text-center mb-8">
                        <h2 class="text-3xl md:text-4xl font-bold text-primary-dynamic mb-4">
                            ${categoria.T√≠tulo_Exibi√ß√£o || categoria.Nome_Categoria}
                        </h2>
                        <p class="text-gray-600 text-lg md:text-xl max-w-3xl mx-auto leading-relaxed">
                            ${categoria.Descri√ß√£o_Se√ß√£o || ''}
                        </p>
                    </div>
                </div>
                
                <!-- Grid ajustado: 1 coluna no mobile, 2 colunas no desktop -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    ${itensCategoria.map(item => `
                        <div class="menu-item bg-white rounded-2xl shadow-lg overflow-hidden card-hover menu-item-mobile-spacing">
                            <div class="menu-item-container h-full">
                                <!-- Layout adaptativo: vertical no mobile, horizontal em telas maiores -->
                                <div class="flex flex-col md:flex-row">
                                    <div class="menu-item-image-wrapper w-full md:w-2/5 ${!item.Foto_URL ? 'hidden' : ''}">
                                        <img 
                                            src="${processarURLImagem(item.Foto_URL) || 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2NjY2NjYyIgc3Ryb2tlLXdpZHRoPSIxIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxyZWN0IHg9IjMiIHk9IjMiIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCIgcng9IjIiIHJ5PSIyIj48L3JlY3Q+PGNpcmNsZSBjeD0iOC41IiBjeT0iOC41IiByPSIxLjUiPjwvY2lyY2xlPjxwb2x5bGluZSBwb2ludHM9IjIxIDE1IDE2IDEwIDUgMjEiPjwvcG9seWxpbmU+PC9zdmc+'}" 
                                            alt="${item.Item}" 
                                            class="w-full h-48 md:h-full object-cover aspect-square transition-all duration-300 hover:scale-105"
                                            onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2NjY2NjYyIgc3Ryb2tlLXdpZHRoPSIxIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxyZWN0IHg9IjMiIHk9IjMiIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCIgcng9IjIiIHJ5PSIyIj48L3JlY3Q+PGNpcmNsZSBjeD0iOC41IiBjeT0iOC41IiByPSIxLjUiPjwvY2lyY2xlPjxwb2x5bGluZSBwb2ludHM9IjIxIDE1IDE2IDEwIDUgMjEiPjwvcG9seWxpbmU+PC9zdmc+'; this.classList.add('placeholder-img');" 
                                            loading="lazy"
                                        >
                                    </div>
                                    
                                    <div class="menu-item-content p-4 w-full md:${item.Foto_URL ? 'w-3/5' : 'w-full'}">
                                        <div>
                                            <div class="menu-item-title-price mb-3">
                                                <h3 class="font-bold text-lg text-gray-800 leading-tight truncate">
                                                    ${item.Item || 'Item sem nome'}
                                                </h3>
                                                <div class="menu-item-pill price-highlight bg-primary-dynamic/10 text-primary-dynamic border border-primary-dynamic/20">
                                                    <span class="font-bold">${item.Pre√ßo || 'Consulte'}</span>
                                                </div>
                                            </div>
                                            
                                            <p class="text-gray-600 leading-snug text-sm md:text-sm mb-[15px] line-clamp-3" style="margin-bottom: 15px;">
                                                ${item.Descri√ß√£o || ''}
                                            </p>
                                        </div>
                                        
                                        <div>
                                            ${item.Classifica√ß√£o_Adicional && item.Classifica√ß√£o_Adicional.trim() !== '' ? 
                                                (item.Classifica√ß√£o_Adicional.trim().startsWith('#Var:') || item.Classifica√ß√£o_Adicional.trim().startsWith('Var:') ? `
                                                    <div class="variacoes-container mb-3 mt-2" 
                                                        data-item-id="${item.ID || `id-${item.Item?.replace(/\s+/g, '-').toLowerCase()}`}" 
                                                        data-required="${item.Classifica√ß√£o_Adicional.trim().startsWith('#Var:')}" 
                                                        data-item-preco="${item.Pre√ßo ? item.Pre√ßo.replace(/[^0-9,]/g, '').replace(',', '.') : '0'}" 
                                                        style="margin-top: 10px; margin-bottom: 15px;">
                                                        <p class="text-sm font-medium mb-2 ${item.Classifica√ß√£o_Adicional.trim().startsWith('#Var:') ? 'text-red-600 flex items-center' : 'text-gray-700'}">
                                                            ${item.Classifica√ß√£o_Adicional.trim().startsWith('#Var:') ? `
                                                                <span class="mr-1">
                                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                                                    </svg>
                                                                </span>
                                                                <strong>Selecione pelo menos 1 op√ß√£o:</strong>
                                                            ` : 'Selecione as op√ß√µes (opcional):'}
                                                        </p>
                                                        <div class="flex flex-wrap gap-2">
                                                            ${(item.Classifica√ß√£o_Adicional.trim().startsWith('#Var:') ? 
                                                                item.Classifica√ß√£o_Adicional.substring(5) : 
                                                                item.Classifica√ß√£o_Adicional.substring(4))
                                                                .split('/')
                                                                .map((variacao, index) => {
                                                                    const variacaoTrim = variacao.trim();
                                                                     // Extrair pre√ßo adicional se existir (formato: "+R$X,XX" ou "+R$ X,XX")
                                                                     const precoMatch = variacaoTrim.match(/\+R\$\s*([0-9]+[,.]?[0-9]*)/);
                                                                    let precoAdicional = 0;
                                                                    let nomeSemPreco = variacaoTrim;
                                                                    
                                                                    if (precoMatch) {
                                                                        // Converter para n√∫mero (substituindo v√≠rgula por ponto)
                                                                        precoAdicional = parseFloat(precoMatch[1].replace(',', '.'));
                                                                        // Remover a parte do pre√ßo do nome da varia√ß√£o
                                                                        nomeSemPreco = variacaoTrim.replace(/\+R\$\s*([0-9]+[,.]?[0-9]*)/, '').trim();
                                                                    }
                                                                    
                                                                    return `
                                                                        <label class="variacao-radio-label inline-flex items-center">
                                                                            <input type="checkbox" 
                                                                                name="variacao-${item.ID || `id-${item.Item?.replace(/\s+/g, '-').toLowerCase()}`}" 
                                                                                value="${nomeSemPreco}" 
                                                                                class="variacao-checkbox sr-only"
                                                                                data-preco-adicional="${precoAdicional}"
                                                                                onclick="atualizarPrecoComVariacoes(this, '${item.ID || `id-${item.Item?.replace(/\s+/g, '-').toLowerCase()}`}')"
                                                                            >
                                                                            <span class="variacao-btn py-1 px-3 rounded-full border border-gray-300 text-sm cursor-pointer transition-all bg-white text-gray-700 hover:bg-gray-100">
                                                                                ${variacaoTrim}
                                                                            </span>
                                                                        </label>
                                                                    `;
                                                                }).join('')}
                                                        </div>
                                                    </div>
                                                ` : `
                                                    <div class="flex flex-wrap gap-1 mb-2 mt-2" style="margin-top: 10px; margin-bottom: 10px;">
                                                        ${item.Classifica√ß√£o_Adicional.split('/').map(tag => `
                                                            <span class="menu-item-pill bg-secondary-dynamic/10 text-secondary-dynamic border border-secondary-dynamic/20">
                                                                ${tag.trim()}
                                                            </span>
                                                        `).join('')}
                                                    </div>
                                                `) : ''}
                                            
                                            ${item.Observa√ß√µes ? `
                                                <p class="text-sm text-gray-500 italic border-t" style="padding-top: 10px !important;">
                                                    üí° ${item.Observa√ß√µes}
                                                </p>
                                            ` : ''}
                                            
                                            <!-- Controles de quantidade e bot√£o "Adicionar ao Carrinho" com atributos de acessibilidade -->
                                            <div class="mt-2 md:mt-1 py-1 md:py-1 flex items-center justify-between">
                                                <div class="flex items-center space-x-1" role="group" aria-label="Controle de quantidade para ${item.Item}">
                                                    <button 
                                                        type="button"
                                                        class="quantidade-decremento flex items-center justify-center w-8 h-8 rounded-md bg-primary-dynamic text-white hover:bg-opacity-90 transition-all duration-200 focus:outline-none" 
                                                        data-item-id="${item.ID || `id-${item.Item?.replace(/\s+/g, '-').toLowerCase()}`}"
                                                        aria-label="Diminuir quantidade"
                                                        onclick="decrementarQuantidadeCard(this); event.stopPropagation();"
                                                    >
                                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4">
                                                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14" />
                                                        </svg>
                                                    </button>
                                                    <input 
                                                        type="number" 
                                                        min="1" 
                                                        value="1" 
                                                        class="quantidade-input w-8 h-8 text-center border-0 bg-transparent focus:outline-none focus:ring-0 font-medium text-gray-700" 
                                                        data-item-id="${item.ID || `id-${item.Item?.replace(/\s+/g, '-').toLowerCase()}`}"
                                                        aria-label="Quantidade de ${item.Item}"
                                                    >
                                                    <button 
                                                        type="button"
                                                        class="quantidade-incremento flex items-center justify-center w-8 h-8 rounded-md bg-primary-dynamic text-white hover:bg-opacity-90 transition-all duration-200 focus:outline-none"
                                                        data-item-id="${item.ID || `id-${item.Item?.replace(/\s+/g, '-').toLowerCase()}`}"
                                                        aria-label="Aumentar quantidade"
                                                        onclick="incrementarQuantidadeCard(this); event.stopPropagation();"
                                                    >
                                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4">
                                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                                                        </svg>
                                                    </button>
                                                </div>
                                                
                                                <button 
                                                    type="button" 
                                                    class="adicionar-ao-carrinho bg-primary-dynamic text-white py-2 px-4 rounded-lg text-base font-medium hover:bg-primary-dynamic/90 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-dynamic"
                                                    data-item-id="${item.ID || `id-${item.Item?.replace(/\s+/g, '-').toLowerCase()}`}"
                                                    data-item-titulo="${item.Item || 'Item sem nome'}"
                                                    aria-label="Adicionar ${item.Item} ao carrinho de compras"
                                                    onclick="adicionarAoCarrinhoComVariacao('${item.ID || `id-${item.Item?.replace(/\s+/g, '-').toLowerCase()}`}', '${item.Item || 'Item sem nome'}', this)"
                                                >
                                                    Adicionar
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </section>
        `;
        
        cardapioContainer.innerHTML += secaoHtml;
    });

    document.getElementById('loading').style.display = 'none';
    console.log('Renderiza√ß√£o conclu√≠da');
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Adicionar evento de click nos logos para reload
    const logoMobile = document.getElementById('logo-mobile');
    const logoDesktop = document.getElementById('logo');
    const logoTextMobile = document.getElementById('logo-text-mobile');

    // Fun√ß√£o para tratar a sele√ß√£o de varia√ß√µes
    document.addEventListener('click', function(event) {
        const target = event.target;
        
        // Verificar se clicou em um bot√£o de varia√ß√£o ou no texto dentro dele
        if (target.closest('.variacao-btn')) {
            event.preventDefault(); // Impedir comportamento padr√£o
            event.stopPropagation(); // Parar propaga√ß√£o do evento
            
            const label = target.closest('.variacao-radio-label');
            if (!label) return;
            
            const input = label.querySelector('input[type="checkbox"]');
            if (!input) return;
            
            // For√ßar a altern√¢ncia manual do estado de sele√ß√£o
            input.checked = !input.checked;
            console.log(`Bot√£o de varia√ß√£o clicado: ${input.value}, estado: ${input.checked ? 'marcado' : 'desmarcado'}`);
            
            // Atualizar estilo do bot√£o atual
            const btn = label.querySelector('.variacao-btn');
            if (input.checked) {
                btn.classList.add('bg-primary-dynamic', 'text-white');
                btn.classList.remove('bg-white', 'text-gray-700', 'hover:bg-gray-100');
            } else {
                btn.classList.remove('bg-primary-dynamic', 'text-white');
                btn.classList.add('bg-white', 'text-gray-700', 'hover:bg-gray-100');
            }
            
            // Chamar a fun√ß√£o para atualizar o pre√ßo
            const itemId = input.name.replace('variacao-', '');
            atualizarPrecoComVariacoes(input, itemId);
        }
    });

    // Inicializar os eventos de varia√ß√£o para todos os checkboxes
    document.querySelectorAll('.variacoes-container input[type="checkbox"]').forEach(checkbox => {
        // Verificar se o checkbox j√° est√° marcado e atualizar o estilo do bot√£o
        if (checkbox.checked) {
            const label = checkbox.closest('.variacao-radio-label');
            if (label) {
                const btn = label.querySelector('.variacao-btn');
                if (btn) {
                    btn.classList.add('bg-primary-dynamic', 'text-white');
                    btn.classList.remove('bg-white', 'text-gray-700');
                }
            }
            
            // Atualizar o pre√ßo inicial se houver varia√ß√µes j√° selecionadas
            const itemId = checkbox.name.replace('variacao-', '');
            atualizarPrecoComVariacoes(checkbox, itemId);
        }
    });

    // Fun√ß√£o para recarregar e manter no topo
    function recarregarEManterNoTopo(e) {
        e.preventDefault(); // Previne o comportamento padr√£o
        
        // Adiciona um par√¢metro √† URL para for√ßar o navegador a ir para o topo
        const separador = window.location.href.includes('?') ? '&' : '?';
        const novaUrl = window.location.href.split('#')[0] + separador + 'scrollTop=0';
        
        // Redireciona para a nova URL, for√ßando um reload
        window.location.href = novaUrl;
    }

    // Adicionar event listeners aos logos para recarregar e manter no topo
    if (logoMobile) {
        logoMobile.addEventListener('click', recarregarEManterNoTopo);
        logoMobile.style.cursor = 'pointer';
    }

    if (logoDesktop) {
        logoDesktop.addEventListener('click', recarregarEManterNoTopo);
        logoDesktop.style.cursor = 'pointer';
    }

    if (logoTextMobile) {
        logoTextMobile.addEventListener('click', recarregarEManterNoTopo);
        logoTextMobile.style.cursor = 'pointer';
    }

    
    
    
    
    
    
    
    
    
    
    // Bot√µes de busca
    document.getElementById('search-btn-mobile').addEventListener('click', abrirBusca);
    document.getElementById('search-btn-desktop').addEventListener('click', abrirBusca);
    
    // Fechar busca
    document.getElementById('close-search').addEventListener('click', fecharBusca);
    document.getElementById('search-overlay').addEventListener('click', function(e) {
        if (e.target === this) {
            fecharBusca();
        }
    });

    // Campo de busca
    document.getElementById('search-input').addEventListener('input', function(e) {
        const termo = e.target.value.trim();
        
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            realizarBusca(termo);
        }, 300);
    });

    // Tecla ESC para fechar busca
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            fecharBusca();
        }
    });

    // Filtros desktop
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('filtro-btn')) {
            document.querySelectorAll('.filtro-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-primary-dynamic', 'text-white');
                btn.classList.add('bg-gray-100', 'text-gray-700');
            });
            
            e.target.classList.add('active', 'bg-primary-dynamic', 'text-white');
            e.target.classList.remove('bg-gray-100', 'text-gray-700');
            
            filtrarPorCategoria(e.target.dataset.categoria);
        }
    });

    // Filtros scroll horizontal mobile
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('category-item')) {
            document.querySelectorAll('.category-item').forEach(btn => {
                btn.classList.remove('active', 'bg-primary-dynamic', 'text-white');
                btn.classList.add('bg-gray-100', 'text-gray-700');
            });
            
            e.target.classList.add('active', 'bg-primary-dynamic', 'text-white');
            e.target.classList.remove('bg-gray-100', 'text-gray-700');
            
            // Scroll suave para centralizar o item ativo
            const categoryScroll = document.getElementById('category-scroll');
            const itemLeft = e.target.offsetLeft;
            const itemWidth = e.target.offsetWidth;
            const containerWidth = categoryScroll.offsetWidth;
            
            const targetScroll = itemLeft - (containerWidth / 2) + (itemWidth / 2);
            
            categoryScroll.scrollTo({
                left: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
            
            filtrarPorCategoria(e.target.dataset.categoria);
        }
    });

    carregarDados();
});

function filtrarPorCategoria(categoria) {
    // Em vez de ocultar se√ß√µes, navegamos para a √¢ncora correspondente
    if (!categoria) {
        // Se n√£o tem categoria, volta ao topo
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
        return;
    }
    
    // Encontrar a se√ß√£o correspondente √† categoria
    const targetId = `categoria-${categoria.toLowerCase().replace(/\s+/g, '-')}`;
    const targetSection = document.getElementById(targetId);
    
    if (targetSection) {
        // Calcular offset do cabe√ßalho unificado
        const headerOffset = document.getElementById('unified-header').offsetHeight;
        
        // Navegar para a se√ß√£o com offset
        window.scrollTo({
            top: targetSection.offsetTop - headerOffset - 20,
            behavior: 'smooth'
        });
        
        // Atualizar URL sem recarregar a p√°gina
        history.pushState(null, null, `#${targetId}`);
    }
}

    </script>
    
    <!-- Script para centralizar o item do menu durante o scroll (estilo iFood com navega√ß√£o por √¢ncoras) -->
    <script>
        // Fun√ß√£o para centralizar o item do menu mobile ao fazer scroll (comportamento iFood)
        function setupScrollCentralization() {
            const categoryMenu = document.getElementById('category-scroll');
            const categoryItems = document.querySelectorAll('.category-item');
            
            // Verificar se existe o menu de categorias
            if (!categoryMenu || categoryItems.length === 0) return;
            
            // Coletar IDs das se√ß√µes de categoria e configurar navega√ß√£o por √¢ncoras
            let sections = [];
            categoryItems.forEach(item => {
                const targetId = item.getAttribute('data-target');
                if (targetId) {
                    const section = document.getElementById(targetId);
                    if (section) {
                        // Configurar √¢ncora de navega√ß√£o
                        item.href = `#${targetId}`;
                        
                        // Adicionar ao array de se√ß√µes para rastreamento
                        sections.push({
                            id: targetId,
                            menuItem: item,
                            section: section,
                            top: 0, // Ser√° calculado depois
                            bottom: 0 // Ser√° calculado depois
                        });
                    }
                }
            });
            
            // Fun√ß√£o otimizada para atualizar as posi√ß√µes das se√ß√µes durante o scroll
            function atualizarPosicoesSecoes() {
                // Atualizar as posi√ß√µes absolutas de cada se√ß√£o no documento
                sections.forEach(secInfo => {
                    if (!secInfo.section) return;
                    
                    const rect = secInfo.section.getBoundingClientRect();
                    
                    // Converter posi√ß√µes relativas √† viewport para posi√ß√µes absolutas no documento
                    secInfo.top = window.scrollY + rect.top;
                    secInfo.bottom = window.scrollY + rect.bottom;
                    secInfo.height = rect.height;
                    
                    // Guardar tamb√©m as posi√ß√µes relativas para c√°lculos mais precisos
                    secInfo.topRelative = rect.top;
                    secInfo.bottomRelative = rect.bottom;
                });
                
                // Ordenar se√ß√µes do topo para o fim da p√°gina para navega√ß√£o consistente
                sections.sort((a, b) => a.top - b.top);
            }
            
            // Fun√ß√£o para centralizar item do menu com anima√ß√£o suave
            function centralizarItemMenu(menuItem, comportamento = 'smooth') {
                if (!categoryMenu || !menuItem) return;
                
                const menuRect = categoryMenu.getBoundingClientRect();
                const itemRect = menuItem.getBoundingClientRect();
                
                // Calcular o deslocamento para centralizar o item
                const menuCenterX = menuRect.width / 2;
                
                // Posi√ß√£o do item em rela√ß√£o ao menu de categorias (n√£o ao viewport)
                // Usar offsetLeft para posicionamento correto em rela√ß√£o ao container
                let targetScrollLeft = menuItem.offsetLeft - menuCenterX + (itemRect.width / 2);
                
                // Garantir que n√£o ultrapasse os limites
                targetScrollLeft = Math.max(0, Math.min(targetScrollLeft, categoryMenu.scrollWidth - menuRect.width));
                
                // Aplicar scroll com comportamento especificado (suave ou instant)
                categoryMenu.scrollTo({
                    left: targetScrollLeft,
                    behavior: comportamento
                });
                
                // Adicionar classe visual para destacar o item centralizado
                menuItem.classList.add('centered-item');
                
                // Console para debug
                console.log(`Centralizando: ${menuItem.textContent} - scrollLeft: ${targetScrollLeft}`);
            }
            
            // Fun√ß√£o melhorada para encontrar a se√ß√£o ativa com base no scroll atual (comportamento estilo iFood)
            function encontrarSecaoAtiva() {
                // Obter posi√ß√£o de scroll e dimens√µes da viewport
                const scrollPosition = window.scrollY;
                const viewportHeight = window.innerHeight;
                
                // Calcular tamanho do header fixo para compensar na detec√ß√£o
                const headerTotalHeight = document.getElementById('header').offsetHeight + 
                                        document.getElementById('mobile-category-menu').offsetHeight;
                
                // O ponto de detec√ß√£o √© no centro da viewport, ajustado pelo header
                // Isso garante que a categoria seja ativada quando estiver no centro da tela
                const viewportCenter = scrollPosition + (viewportHeight / 2);
                const detectionPoint = viewportCenter;
                
                // Se estiver no topo da p√°gina, selecionar a se√ß√£o "Todos"
                if (scrollPosition < 50) {
                    return sections[0];
                }
                
                // Verificar cada se√ß√£o para ver qual est√° no ponto de detec√ß√£o
                for (const secInfo of sections) {
                    if (detectionPoint >= secInfo.top && detectionPoint <= secInfo.bottom) {
                        return secInfo;
                    }
                }
                
                // Se nenhuma se√ß√£o for encontrada, encontrar a mais pr√≥xima do ponto de detec√ß√£o
                let closest = sections[0];
                let closestDistance = Infinity;
                
                sections.forEach(secInfo => {
                    // Se a se√ß√£o est√° abaixo do ponto de detec√ß√£o, calcular dist√¢ncia at√© o topo da se√ß√£o
                    if (secInfo.top > detectionPoint) {
                        const distance = secInfo.top - detectionPoint;
                        if (distance < closestDistance) {
                            closestDistance = distance;
                            closest = secInfo;
                        }
                    }
                    // Se a se√ß√£o est√° acima do ponto de detec√ß√£o, calcular dist√¢ncia at√© o final da se√ß√£o
                    else if (secInfo.bottom < detectionPoint) {
                        const distance = detectionPoint - secInfo.bottom;
                        if (distance < closestDistance) {
                            closestDistance = distance;
                            closest = secInfo;
                        }
                    }
                });
                
                return closest;
            }
            
            // Fun√ß√£o principal aprimorada para controlar o scroll e atualizar o menu (comportamento iFood)
            function handleScroll() {
                // Atualizar as posi√ß√µes das se√ß√µes a cada scroll
                atualizarPosicoesSecoes();
                
                // Encontrar a se√ß√£o ativa baseada na posi√ß√£o do scroll
                const secaoAtiva = encontrarSecaoAtiva();
                
                if (secaoAtiva && secaoAtiva.menuItem) {
                    // Variante anterior ativa para comparar mudan√ßas
                    const previousActive = document.querySelector('.category-item.active');
                    const isNewActive = previousActive !== secaoAtiva.menuItem;
                    
                    // Remover classe de centraliza√ß√£o de todos os itens
                    categoryItems.forEach(item => item.classList.remove('centered-item'));
                    
                    // Atualizar classe ativa apenas se mudou
                    if (isNewActive) {
                        // Remover classe ativa de todos os itens
                        categoryItems.forEach(item => item.classList.remove('active'));
                        
                        // Adicionar classe ativa ao item atual
                        secaoAtiva.menuItem.classList.add('active');
                        
                        // Centralizar o item do menu no modo suave quando h√° mudan√ßa de categoria
                        centralizarItemMenu(secaoAtiva.menuItem, 'smooth');
                        
                        // Atualizar a URL sem recarregar a p√°gina (para manter hist√≥rico de navega√ß√£o)
                        const targetId = secaoAtiva.id;
                        if (targetId) {
                            history.replaceState(null, null, `#${targetId}`);
                        }
                        
                        console.log(`Se√ß√£o ativa alterada para: ${secaoAtiva.menuItem.textContent}`);
                    } else {
                        // Mesmo quando n√£o muda a categoria, continuamos centralizando
                        // o item durante o scroll para garantir um comportamento tipo iFood
                        centralizarItemMenu(secaoAtiva.menuItem, 'smooth');
                    }
                }
            }
            
            // Configurar a detec√ß√£o de scroll otimizada para garantir centraliza√ß√£o suave durante o scroll
            let lastScrollTime = 0;
            const scrollThrottle = 50; // milisegundos entre atualiza√ß√µes (reduzido para maior suavidade)
            
            window.addEventListener('scroll', function(e) {
                const now = Date.now();
                
                // Usar throttling para limitar o n√∫mero de atualiza√ß√µes
                if (now - lastScrollTime >= scrollThrottle) {
                    // Usar requestAnimationFrame para sincronizar com o ciclo de renderiza√ß√£o
                    window.requestAnimationFrame(function() {
                        handleScroll();
                    });
                    
                    lastScrollTime = now;
                }
            }, { passive: true });
            
            // Verificar se h√° um hash na URL ao carregar a p√°gina para navega√ß√£o direta
            window.addEventListener('load', function() {
                if (window.location.hash) {
                    const targetId = window.location.hash.substring(1);
                    const targetSection = document.getElementById(targetId);
                    if (targetSection) {
                        const targetMenuItem = document.querySelector(`.category-item[data-target="${targetId}"]`);
                        if (targetMenuItem) {
                            // Remover classe ativa de todos os itens
                            categoryItems.forEach(item => item.classList.remove('active'));
                            // Adicionar classe ativa ao item alvo
                            targetMenuItem.classList.add('active');
                            // Centralizar item no menu
                            centralizarItemMenu(targetMenuItem);
                            
                            // Scroll para a se√ß√£o com offset ap√≥s um pequeno atraso
                            setTimeout(() => {
                                const headerOffset = document.getElementById('header').offsetHeight + 
                                                document.getElementById('mobile-category-menu').offsetHeight;
                                const elementPosition = targetSection.getBoundingClientRect().top;
                                const offsetPosition = elementPosition + window.pageYOffset - headerOffset - 20;
                                window.scrollTo({
                                    top: offsetPosition,
                                    behavior: 'smooth'
                                });
                            }, 300);
                        }
                    }
                }
            });
            
            // Inicializar as posi√ß√µes das se√ß√µes e configurar estado inicial
            window.addEventListener('load', function() {
                setTimeout(() => {
                    atualizarPosicoesSecoes();
                    handleScroll();
                }, 500);
            });
            
            // Adicionar event listeners para os cliques nos itens do menu
            categoryItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    // Impedir comportamento padr√£o para controlar a navega√ß√£o manualmente
                    e.preventDefault();
                    
                    // Remover classe ativa de todos os itens
                    categoryItems.forEach(item => item.classList.remove('active'));
                    
                    // Adicionar classe ativa a este item
                    this.classList.add('active');
                    
                    // Centralizar o item imediatamente
                    centralizarItemMenu(this);
                    
                    // Navega√ß√£o para a se√ß√£o correspondente
                    const targetId = this.getAttribute('data-target');
                    if (targetId) {
                        const targetSection = document.getElementById(targetId);
                        if (targetSection) {
                            // Calcular posi√ß√£o com offset para o header
                            const headerOffset = document.getElementById('header').offsetHeight + 
                                                document.getElementById('mobile-category-menu').offsetHeight;
                            const elementPosition = targetSection.getBoundingClientRect().top;
                            const offsetPosition = elementPosition + window.pageYOffset - headerOffset - 20;
                            
                            // Scroll suave para a posi√ß√£o
                            window.scrollTo({
                                top: offsetPosition,
                                behavior: 'smooth'
                            });
                            
                            // Atualizar URL sem recarregar a p√°gina (para manter estado da √¢ncora)
                            history.pushState(null, null, `#${targetId}`);
                        }
                    }
                    
                    // Pequeno atraso para centralizar novamente ap√≥s o scroll para a se√ß√£o
                    setTimeout(() => {
                        centralizarItemMenu(this);
                    }, 600);
                });
            });
            
            // Inicializa√ß√£o imediata
            atualizarPosicoesSecoes();
            handleScroll();
        }
        
        // Fun√ß√£o para verificar a forma de pagamento e mostrar/ocultar o campo de troco
        function verificarFormaPagamento() {
            const formaPagamento = document.getElementById('forma-pagamento');
            const containerTroco = document.getElementById('container-troco');
            
            if (formaPagamento && containerTroco) {
                // Verificar se a forma de pagamento √© dinheiro
                if (formaPagamento.value.toLowerCase() === 'dinheiro') {
                    containerTroco.classList.remove('hidden');
                } else {
                    containerTroco.classList.add('hidden');
                }
            }
        }
        
        // Fun√ß√£o para mostrar/ocultar o campo de valor do troco
        function mostrarCampoTroco(mostrar) {
            const campoValorTroco = document.getElementById('campo-valor-troco');
            if (campoValorTroco) {
                if (mostrar) {
                    campoValorTroco.classList.remove('hidden');
                } else {
                    campoValorTroco.classList.add('hidden');
                }
            }
        }
        
        // Fun√ß√£o para formatar o campo de valor do troco como moeda brasileira (R$ 1.000,00)
        function formatarMoeda(campo) {
            // Remover tudo que n√£o for n√∫mero
            let valor = campo.value.replace(/\D/g, '');
            
            // Tratar caso especial de valor vazio ou zero
            if (!valor || valor === '0') {
                campo.value = '';
                return;
            }
            
            // Converter para n√∫mero e dividir por 100 para considerar os centavos
            valor = (parseInt(valor, 10) / 100).toFixed(2);
            
            // Substituir ponto por v√≠rgula e adicionar separador de milhar
            valor = valor.replace('.', ',');
            if (valor.length > 6) {
                // Adicionar separador de milhar
                valor = valor.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            }
            
            // Adicionar prefixo R$
            campo.value = `R$ ${valor}`;
            
            // Posicionar o cursor no final do campo
            setTimeout(() => {
                campo.selectionStart = campo.value.length;
                campo.selectionEnd = campo.value.length;
            }, 0);
        }
        
        // Executar a configura√ß√£o ap√≥s o carregamento do card√°pio
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se o card√°pio j√° foi carregado
            if (document.querySelector('#cardapio .categoria-secao')) {
                setupScrollCentralization();
            } else {
                // Se n√£o, esperar at√© que o card√°pio seja renderizado
                const observer = new MutationObserver(function(mutations, observer) {
                    if (document.querySelector('#cardapio .categoria-secao')) {
                        setupScrollCentralization();
                        observer.disconnect();
                    }
                });
                
                observer.observe(document.body, {
                    childList: true,
                    subtree: true
                });
            }
        });
    </script>
    <script>
        // Carregar carrinho ao iniciar a p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Carregando carrinho do localStorage');
            atualizarContadorCarrinho();
        });
        
        // Fun√ß√£o para atualizar o contador do carrinho
        function atualizarContadorCarrinho() {
            // Sempre buscar do localStorage para garantir dados atualizados
            const carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
            const totalItens = carrinho.reduce((total, item) => total + item.quantidade, 0);
            
            console.log('Atualizando contador do carrinho:', totalItens, 'itens');
            
            // Container do carrinho flutuante
            const carrinhoFlutuante = document.getElementById('carrinho-flutuante');
            // Bot√£o do carrinho dentro do container
            const botaoCarrinho = document.getElementById('botao-carrinho');
            
            // Atualizar contador no bot√£o
            const contador = document.getElementById('carrinho-contador');
            if (contador) {
                contador.textContent = totalItens;
                
                // Adicionar classe de destaque se houver itens
                if (totalItens > 0) {
                    contador.classList.add('animate-pulse');
                    contador.classList.remove('hidden');
                    setTimeout(() => contador.classList.remove('animate-pulse'), 500);
                } else {
                    contador.classList.add('hidden');
                }
            }
            
            // Atualizar o contador no t√≠tulo do carrinho
            const totalItensCarrinho = document.getElementById('total-itens-carrinho');
            if (totalItensCarrinho) {
                totalItensCarrinho.textContent = totalItens;
                console.log('Total de itens no t√≠tulo do carrinho atualizado para:', totalItens);
            }
            
            // Mostrar/esconder carrinho flutuante e garantir que o bot√£o seja clic√°vel
            if (carrinhoFlutuante && botaoCarrinho) {
                if (totalItens > 0) {
                    // Exibir o container
                    carrinhoFlutuante.style.display = 'block';
                    carrinhoFlutuante.style.opacity = '1';
                    carrinhoFlutuante.classList.remove('hidden');
                    
                    // Garantir que o bot√£o esteja clic√°vel
                    botaoCarrinho.style.display = 'flex';
                    botaoCarrinho.style.pointerEvents = 'auto';
                    
                    // Garantir que o onclick est√° definido
                    if (!botaoCarrinho.hasAttribute('onclick') || !botaoCarrinho.getAttribute('onclick')) {
                        botaoCarrinho.setAttribute('onclick', 'abrirModal();');
                        console.log('Adicionado evento onclick ao bot√£o do carrinho');
                    }
                } else {
                    carrinhoFlutuante.style.opacity = '0.5';
                    carrinhoFlutuante.classList.add('hidden');
                }
            } else {
                console.error('Elementos do carrinho n√£o encontrados:', { carrinhoFlutuante, botaoCarrinho });
            }
            
            // Atualizar estado dos bot√µes de limpar carrinho
            const btnLimparCarrinho = document.getElementById('limpar-carrinho');
            const botaoLimpar = document.getElementById('botao-limpar');
            
            if (totalItens === 0) {
                // Esconder/desabilitar bot√µes quando o carrinho estiver vazio
                if (btnLimparCarrinho) {
                    btnLimparCarrinho.classList.add('hidden');
                }
                
                if (botaoLimpar) {
                    botaoLimpar.disabled = true;
                    botaoLimpar.classList.add('opacity-50', 'cursor-not-allowed');
                }
            } else {
                // Mostrar/habilitar bot√µes quando houver itens no carrinho
                if (btnLimparCarrinho) {
                    btnLimparCarrinho.classList.remove('hidden');
                }
                
                if (botaoLimpar) {
                    botaoLimpar.disabled = false;
                    botaoLimpar.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }
        }
        
        // Fun√ß√µes para controlar o modal de checkout
        function abrirModal() {
            console.log('Abrindo modal de checkout');
            const modal = document.getElementById('modal-checkout');
            if (modal) {
                // Bloquear o scroll da p√°gina antes de exibir o modal
                document.body.style.overflow = 'hidden';
                
                modal.classList.remove('hidden');
                modal.style.display = 'block';
                modal.setAttribute('aria-hidden', 'false');
                // Atualizar conte√∫do do carrinho no modal
                renderizarItensCarrinho();
                
                // Atualizar o contador total de itens no t√≠tulo do carrinho
                const totalItensCarrinho = document.getElementById('total-itens-carrinho');
                if (totalItensCarrinho) {
                    // Obter carrinho do localStorage
                    let carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
                    // Calcular o total de itens somando todas as quantidades
                    const totalItens = carrinho.reduce((acc, item) => acc + item.quantidade, 0);
                    totalItensCarrinho.textContent = totalItens;
                    console.log('Total de itens atualizado para:', totalItens, 'ao abrir o modal');
                }
            }
        }
        
        function fecharModal() {
            console.log('Fechando modal de checkout');
            const modal = document.getElementById('modal-checkout');
            if (modal) {
                modal.classList.add('hidden');
                modal.style.display = 'none';
                modal.setAttribute('aria-hidden', 'true');
                
                // Restaurar o scroll da p√°gina
                document.body.style.overflow = '';
                document.body.classList.remove('overflow-hidden');
                console.log('Scroll da p√°gina restaurado');
            }
        }
        
        // Vari√°vel para evitar chamadas recursivas
        let isRenderizandoCarrinho = false;
        
        // Fun√ß√£o para renderizar itens do carrinho no modal
        function renderizarItensCarrinho() {
            try {
                // Evitar chamadas recursivas
                if (isRenderizandoCarrinho) {
                    console.log('Renderiza√ß√£o j√° em andamento, ignorando chamada');
                    return;
                }
                
                isRenderizandoCarrinho = true;
                console.log('Renderizando itens do carrinho no modal');
            const containerItens = document.getElementById('carrinho-itens');
            
            if (!containerItens) {
                console.error('Container de itens do carrinho n√£o encontrado');
                isRenderizandoCarrinho = false;
                return;
            }
            
            // Obter carrinho do localStorage (sempre buscar do localStorage para garantir dados atualizados)
            let carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
            
            // Atualizar vari√°vel global do carrinho para garantir sincroniza√ß√£o
            window.carrinho = carrinho;
            
            // Limpar todo o conte√∫do do container
            containerItens.innerHTML = '';
            
            // Verificar se o carrinho est√° vazio
            if (carrinho.length === 0) {
                // Exibir mensagem de carrinho vazio
                const carrinhoVazioHtml = `
                    <div class="text-center text-gray-500 py-8" id="carrinho-vazio">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-3 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                        <p class="text-lg">Seu carrinho est√° vazio</p>
                        <p class="mt-2">Adicione itens do card√°pio para continuar</p>
                    </div>
                `;
                containerItens.innerHTML = carrinhoVazioHtml;
                
                // Desabilitar bot√£o de continuar
                const botaoContinuar = document.getElementById('botao-continuar');
                if (botaoContinuar) {
                    botaoContinuar.disabled = true;
                    botaoContinuar.classList.add('opacity-50', 'cursor-not-allowed');
                }
                
                // Esconder bot√£o limpar carrinho no step 1
                const btnLimparCarrinho = document.getElementById('limpar-carrinho');
                if (btnLimparCarrinho) {
                    btnLimparCarrinho.classList.add('hidden');
                    btnLimparCarrinho.setAttribute('aria-hidden', 'true');
                }
                
                // Atualizar bot√£o limpar no rodap√©
                const botaoLimpar = document.getElementById('botao-limpar');
                if (botaoLimpar) {
                    botaoLimpar.disabled = true;
                    botaoLimpar.classList.add('opacity-50', 'cursor-not-allowed');
                    botaoLimpar.setAttribute('aria-disabled', 'true');
                }
            } else {
                // Habilitar bot√£o de continuar
                const botaoContinuar = document.getElementById('botao-continuar');
                if (botaoContinuar) {
                    botaoContinuar.disabled = false;
                    botaoContinuar.classList.remove('opacity-50', 'cursor-not-allowed');
                }
                
                // Mostrar bot√£o limpar carrinho no step 1
                const btnLimparCarrinho = document.getElementById('limpar-carrinho');
                if (btnLimparCarrinho) {
                    btnLimparCarrinho.classList.remove('hidden');
                    btnLimparCarrinho.setAttribute('aria-hidden', 'false');
                }
                
                // Habilitar bot√£o limpar no rodap√©
                const botaoLimpar = document.getElementById('botao-limpar');
                if (botaoLimpar) {
                    botaoLimpar.disabled = false;
                    botaoLimpar.classList.remove('opacity-50', 'cursor-not-allowed');
                    botaoLimpar.setAttribute('aria-disabled', 'false');
                }
                
                // Renderizar cada item do carrinho
                carrinho.forEach((item, index) => {
                    // Usar a imagem armazenada no objeto do carrinho ou tentar encontrar no DOM
                    let imagemSrc = item.imagem || '';
                    
                    // Se n√£o tiver imagem armazenada, tenta buscar no DOM como fallback
                    if (!imagemSrc) {
                        try {
                            // Usar o ID original do produto para buscar a imagem no DOM
                            const idBusca = item.originalId || item.id;
                            const cardItem = document.querySelector(`[data-item-id="${idBusca}"]`);
                            if (cardItem) {
                                const card = cardItem.closest('.card');
                                if (card) {
                                    const img = card.querySelector('img');
                                    if (img) {
                                        // Tentar obter a URL completa da imagem
                                        if (img.currentSrc) {
                                            imagemSrc = img.currentSrc;
                                        } else if (img.src) {
                                            imagemSrc = img.src;
                                        } else {
                                            imagemSrc = img.getAttribute('src') || '';
                                        }
                                        
                                        console.log('Imagem encontrada no DOM para o item:', idBusca, imagemSrc);
                                    }
                                }
                            }
                        } catch (e) {
                            console.error('Erro ao buscar imagem do item:', e);
                        }
                    }
                    
                    const itemHtml = `
                        <div class="item-carrinho bg-white rounded-lg shadow-sm p-3 border border-gray-200 mb-3">
                            <div class="flex items-center gap-3">
                                <!-- Elemento visual removido conforme solicitado -->
                                <div class="flex-1">
                                    <div class="flex justify-between items-center mb-1">
                                        <h4 class="font-medium text-gray-900">${item.titulo}</h4>
                                        <button 
                                            type="button" 
                                            class="remover-item text-gray-400 hover:text-red-500 focus:outline-none"
                                            data-item-id="${item.id}"
                                            aria-label="Remover ${item.titulo} do carrinho"
                                            onclick="removerItemDoCarrinho('${item.id}')"
                                        >
                                            <i class="fas fa-trash-alt" style="font-size: 18px; color: #f87171;"></i>
                                        </button>
                                    </div>
                                     <!-- Controles de quantidade com bot√µes de incremento/decremento -->
                                    <div class="flex items-center mb-2">
                                        <div class="flex items-center" role="group" aria-label="Controle de quantidade para ${item.titulo}">
                                            <button 
                                                type="button"
                                                class="quantidade-decremento flex items-center justify-center w-7 h-7 rounded-md bg-primary-dynamic text-white hover:bg-opacity-90 transition-all duration-200 focus:outline-none"
                                                data-item-id="${item.id}"
                                                aria-label="Diminuir quantidade"
                                                onclick="alterarQuantidadeItem('${item.id}', -1); event.stopPropagation();"
                                            >
                                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14" />
                                                </svg>
                                            </button>
                                            <input 
                                                type="number" 
                                                min="1" 
                                                max="99" 
                                                value="${item.quantidade}" 
                                                class="quantidade-input mx-2 w-10 h-8 text-center border-0 bg-transparent focus:outline-none focus:ring-0 font-medium text-gray-700" 
                                                data-item-id="${item.id}" 
                                                aria-label="Quantidade de ${item.titulo}"
                                                onchange="atualizarQuantidadeInput('${item.id}', this.value); event.stopPropagation();"
                                            >
                                            <button 
                                                type="button"
                                                class="quantidade-incremento flex items-center justify-center w-7 h-7 rounded-md bg-primary-dynamic text-white hover:bg-opacity-90 transition-all duration-200 focus:outline-none"
                                                data-item-id="${item.id}"
                                                aria-label="Aumentar quantidade"
                                                onclick="alterarQuantidadeItem('${item.id}', 1); event.stopPropagation();"
                                            >
                                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                    ${dadosGlobais.config['Step-1-itens-obs'] === 'Sim' ? `
                                    <div class="mt-1">
                                        <label for="obs-${item.id}" class="block text-xs text-gray-600 mb-1">Observa√ß√£o:</label>
                                        <textarea 
                                            id="obs-${item.id}" 
                                            class="w-full text-sm border border-gray-300 rounded-md p-2 focus:ring-primary-dynamic focus:border-primary-dynamic" 
                                            placeholder="Ex: Sem cebola, bem passado, etc."
                                            rows="1"
                                            onchange="salvarObservacaoItem('${item.id}', this.value)"
                                        >${item.observacao || ''}</textarea>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Adicionar ao container
                    containerItens.insertAdjacentHTML('beforeend', itemHtml);
                });
            }
            
            // Liberar a vari√°vel de controle ao final da execu√ß√£o
            isRenderizandoCarrinho = false;
            } catch (error) {
                console.error('Erro ao renderizar itens do carrinho:', error);
                
                // Tentar recuperar de forma elegante
                try {
                    // Exibir mensagem de erro gen√©rica
                    const containerItens = document.getElementById('carrinho-itens');
                    if (containerItens) {
                        containerItens.innerHTML = `
                            <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                                <p class="text-red-600 text-center">N√£o foi poss√≠vel carregar os itens do seu carrinho.</p>
                                <p class="text-red-500 text-center text-sm mt-2">Tente novamente mais tarde ou entre em contato conosco.</p>
                            </div>
                        `;
                    }
                } catch (innerError) {
                    console.error('Erro ao criar mensagem de recupera√ß√£o:', innerError);
                }
                
                // Garantir libera√ß√£o da vari√°vel mesmo em caso de erro
                isRenderizandoCarrinho = false;
            }
        }
        
        // Fun√ß√£o para salvar observa√ß√£o de um item
        function salvarObservacaoItem(id, observacao) {
            // Verificar se o campo de observa√ß√£o est√° habilitado na configura√ß√£o
            if (dadosGlobais.config['Step-1-itens-obs'] !== 'Sim') {
                console.log('Campo de observa√ß√£o desabilitado nas configura√ß√µes');
                return;
            }
            
            console.log('Salvando observa√ß√£o para o item:', id, observacao);
            
            // Obter carrinho do localStorage
            let carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
            
            // Encontrar o item no carrinho
            const itemIndex = carrinho.findIndex(item => item.id === id);
            
            if (itemIndex !== -1) {
                // Verificar se o item tem a propriedade observacao
                if ('observacao' in carrinho[itemIndex]) {
                    // Atualizar a observa√ß√£o do item
                    carrinho[itemIndex].observacao = observacao;
                    
                    // Salvar no localStorage
                    localStorage.setItem('carrinho', JSON.stringify(carrinho));
                    console.log('Observa√ß√£o salva com sucesso');
                } else {
                    console.log('Item n√£o possui campo de observa√ß√£o');
                }
            }
        }

        // Fun√ß√£o para remover um item do carrinho
        function removerItemDoCarrinho(id) {
            console.log(`Removendo item ${id} do carrinho`);
            
            try {
                let carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
                
                // Encontrar o item para exibir mensagem e guardar sua quantidade
                const itemRemovido = carrinho.find(item => item.id === id);
                const nomeItem = itemRemovido ? itemRemovido.titulo : 'Item';
                const quantidadeRemovida = itemRemovido ? itemRemovido.quantidade : 0;
                
                // Remover item
                carrinho = carrinho.filter(item => item.id !== id);
                
                // Atualizar vari√°vel global
                window.carrinho = carrinho;
                
                // Salvar no localStorage
                localStorage.setItem('carrinho', JSON.stringify(carrinho));
                
                // Verificar se o carrinho ficou vazio
                if (carrinho.length === 0) {
                    // Se o carrinho ficou vazio, resetar o formul√°rio
                    resetarFormulario();
                    
                    // Voltar para o step 1
                    mostrarStep(1);
                }
                
                // Atualizar interface
                atualizarContadorCarrinho();
                renderizarItensCarrinho();
                
                // Resetar estado visual do bot√£o
                const botao = document.querySelector(`.adicionar-ao-carrinho[data-item-id="${id}"]`);
                if (botao) {
                    botao.textContent = 'Adicionar ao Carrinho';
                    botao.classList.remove('adicionado');
                }
                
                // Atualizar o contador no t√≠tulo do carrinho
                const totalItensCarrinho = document.getElementById('total-itens-carrinho');
                if (totalItensCarrinho) {
                    // Calcular o total de itens somando todas as quantidades
                    const totalItens = carrinho.reduce((acc, item) => acc + item.quantidade, 0);
                    totalItensCarrinho.textContent = totalItens;
                    console.log('Total de itens atualizado para:', totalItens, 'ap√≥s remover', quantidadeRemovida, 'unidades');
                }
                
                // Exibir mensagem de feedback
                const mensagem = document.createElement('div');
                mensagem.className = 'fixed bottom-4 right-4 bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded shadow-lg z-50 animate-fade-in-out';
                mensagem.innerHTML = `<p><strong>${nomeItem}</strong> removido do carrinho</p>`;
                document.body.appendChild(mensagem);
                
                // Remover mensagem ap√≥s 2 segundos
                setTimeout(() => {
                    mensagem.classList.add('animate-fade-out');
                    setTimeout(() => mensagem.remove(), 500);
                }, 2000);
                
            } catch (error) {
                console.error('Erro ao remover item do carrinho:', error);
                alert('Ocorreu um erro ao remover o item do carrinho. Por favor, tente novamente.');
            }
        }
        
        // Fun√ß√£o para alterar a quantidade de um item no carrinho
        function alterarQuantidadeItem(id, delta) {
            console.log(`Alterando quantidade do item ${id} em ${delta}`);
            
            try {
                // Obter carrinho do localStorage
                let carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
                
                // Encontrar o item no carrinho
                const itemIndex = carrinho.findIndex(item => item.id === id);
                
                if (itemIndex === -1) {
                    console.error('Item n√£o encontrado no carrinho');
                    return;
                }
                
                // Alterar quantidade
                carrinho[itemIndex].quantidade += delta;
                
                // Garantir que a quantidade esteja entre 1 e 99
                if (carrinho[itemIndex].quantidade < 1) {
                    carrinho[itemIndex].quantidade = 1;
                } else if (carrinho[itemIndex].quantidade > 99) {
                    carrinho[itemIndex].quantidade = 99;
                }
                
                // Atualizar vari√°vel global e localStorage
                window.carrinho = carrinho;
                localStorage.setItem('carrinho', JSON.stringify(carrinho));
                
                // Atualizar interface
                atualizarContadorCarrinho();
                
                // Atualizar diretamente os campos de entrada de quantidade
                const quantidadeInputs = document.querySelectorAll(`.quantidade-input[data-item-id="${id}"]`);
                quantidadeInputs.forEach(input => {
                    input.value = carrinho[itemIndex].quantidade;
                });
                
                // Atualizar o contador no t√≠tulo do carrinho
                const totalItensCarrinho = document.getElementById('total-itens-carrinho');
                if (totalItensCarrinho) {
                    // Calcular o total de itens somando todas as quantidades
                    const totalItens = carrinho.reduce((acc, item) => acc + item.quantidade, 0);
                    totalItensCarrinho.textContent = totalItens;
                    console.log('Total de itens atualizado para:', totalItens);
                }
                
                // Feedback visual tempor√°rio
                const mensagem = document.createElement('div');
                mensagem.className = 'fixed bottom-4 right-4 bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded shadow-lg z-50 animate-fade-in-out';
                mensagem.innerHTML = `<p>Quantidade de <strong>${carrinho[itemIndex].titulo}</strong> atualizada para ${carrinho[itemIndex].quantidade}</p>`;
                document.body.appendChild(mensagem);
                setTimeout(() => {
                    mensagem.classList.add('animate-fade-out');
                    setTimeout(() => mensagem.remove(), 500);
                }, 2000);
                
            } catch (error) {
                console.error('Erro ao alterar quantidade do item:', error);
                alert('Ocorreu um erro ao alterar a quantidade. Por favor, tente novamente.');
            }
        }
        
        // Fun√ß√£o para atualizar a quantidade a partir do campo de entrada
        function atualizarQuantidadeInput(id, novaQuantidade) {
            console.log(`Atualizando quantidade do item ${id} para ${novaQuantidade}`);
            
            try {
                // Converter para n√∫mero e validar
                let quantidade = parseInt(novaQuantidade);
                
                // Validar quantidade
                if (isNaN(quantidade) || quantidade < 1) {
                    quantidade = 1;
                } else if (quantidade > 99) {
                    quantidade = 99;
                }
                
                // Obter carrinho do localStorage
                let carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
                
                // Encontrar o item no carrinho
                const itemIndex = carrinho.findIndex(item => item.id === id);
                
                if (itemIndex === -1) {
                    console.error('Item n√£o encontrado no carrinho');
                    return;
                }
                
                // Atualizar quantidade
                carrinho[itemIndex].quantidade = quantidade;
                
                // Atualizar vari√°vel global
                window.carrinho = carrinho;
                
                // Salvar no localStorage
                localStorage.setItem('carrinho', JSON.stringify(carrinho));
                
                // Atualizar interface
                atualizarContadorCarrinho();
                
                // Atualizar diretamente os campos de entrada de quantidade
                const quantidadeInputs = document.querySelectorAll(`.quantidade-input[data-item-id="${id}"]`);
                quantidadeInputs.forEach(input => {
                    input.value = quantidade;
                });
                
                // Atualizar o contador no t√≠tulo do carrinho
                const totalItensCarrinho = document.getElementById('total-itens-carrinho');
                if (totalItensCarrinho) {
                    // Calcular o total de itens somando todas as quantidades
                    const totalItens = carrinho.reduce((acc, item) => acc + item.quantidade, 0);
                    totalItensCarrinho.textContent = totalItens;
                    console.log('Total de itens atualizado para:', totalItens);
                }
                
                // Atualizar estado dos bot√µes de decremento
                const decrementoButtons = document.querySelectorAll(`.quantidade-decremento[data-item-id="${id}"]`);
                decrementoButtons.forEach(btn => {
                    if (quantidade <= 1) {
                        btn.setAttribute('disabled', '');
                        btn.classList.add('opacity-50', 'cursor-not-allowed');
                    } else {
                        btn.removeAttribute('disabled');
                        btn.classList.remove('opacity-50', 'cursor-not-allowed');
                    }
                });
                
                // Exibir mensagem de feedback
                const mensagem = document.createElement('div');
                mensagem.className = 'fixed bottom-4 right-4 bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded shadow-lg z-50 animate-fade-in-out';
                mensagem.innerHTML = `<p>Quantidade de <strong>${carrinho[itemIndex].titulo}</strong> atualizada para ${quantidade}</p>`;
                document.body.appendChild(mensagem);
                
                // Remover mensagem ap√≥s 2 segundos
                setTimeout(() => {
                    mensagem.classList.add('animate-fade-out');
                    setTimeout(() => mensagem.remove(), 500);
                }, 2000);
                
            } catch (error) {
                console.error('Erro ao atualizar quantidade do item:', error);
                alert('Ocorreu um erro ao atualizar a quantidade. Por favor, tente novamente.');
            }
        }
        
        // Fun√ß√£o para incrementar a quantidade no card do item
        function incrementarQuantidadeCard(button) {
            const itemId = button.getAttribute('data-item-id');
            const inputElement = button.parentNode.querySelector(`.quantidade-input[data-item-id="${itemId}"]`);
            
            if (!inputElement) {
                console.error('Elemento de input n√£o encontrado');
                return;
            }
            
            let quantidade = parseInt(inputElement.value || 1);
            if (isNaN(quantidade)) quantidade = 1;
            
            // Incrementar quantidade
            quantidade = Math.min(quantidade + 1, 99);
            inputElement.value = quantidade;
        }
        
        // Fun√ß√£o para decrementar a quantidade no card do item
        function decrementarQuantidadeCard(button) {
            const itemId = button.getAttribute('data-item-id');
            const inputElement = button.parentNode.querySelector(`.quantidade-input[data-item-id="${itemId}"]`);
            if (!inputElement) {
                console.error('Elemento de input n√£o encontrado');
                return;
            }
            
            let quantidade = parseInt(inputElement.value || 1);
            if (isNaN(quantidade)) quantidade = 1;
            
            // Limitar a quantidade m√≠nima a 1
            quantidade = Math.max(quantidade - 1, 1);
            inputElement.value = quantidade;
            
            // Bot√£o de decremento sempre habilitado
            // Removemos a desabilita√ß√£o quando quantidade = 1
        }
        
        // Fun√ß√£o para limpar todo o carrinho
        function limparCarrinho() {
            console.log('Limpando todo o carrinho');
            
            // Confirmar com o usu√°rio
            if (confirm('Tem certeza que deseja remover todos os itens do carrinho?')) {
                try {
                    // Limpar o carrinho usando o objeto Carrinho se dispon√≠vel
                    if (typeof Carrinho === 'object' && Carrinho.limpar) {
                        Carrinho.limpar();
                        console.log('Carrinho limpo usando objeto Carrinho');
                    } else {
                        // Fallback: limpar localStorage diretamente
                        localStorage.removeItem('carrinho');
                        console.log('Carrinho limpo usando localStorage diretamente');
                    }
                    
                    // Garantir que o carrinho global seja limpo
                    window.carrinho = [];
                    
                    // Resetar formul√°rio e op√ß√µes
                    resetarFormulario();
                    
                    // Atualizar contador e interface
                    atualizarContadorCarrinho();
                    
                    // Atualizar o contador no t√≠tulo do carrinho
                    const totalItensCarrinho = document.getElementById('total-itens-carrinho');
                    if (totalItensCarrinho) {
                        totalItensCarrinho.textContent = '0';
                        console.log('Total de itens atualizado para: 0 ap√≥s limpar o carrinho');
                    }
                    
                    // Renderizar o carrinho vazio (isso vai criar a mensagem de carrinho vazio)
                    renderizarItensCarrinho();
                    
                    // Manter o bot√£o do carrinho vis√≠vel, mas atualizar sua apar√™ncia
                    const botaoCarrinho = document.getElementById('botao-carrinho');
                    if (botaoCarrinho) {
                        const contadorCarrinho = botaoCarrinho.querySelector('#carrinho-contador');
                        if (contadorCarrinho) {
                            contadorCarrinho.textContent = '0';
                        }
                        botaoCarrinho.style.opacity = '1'; // Sempre opacidade total
                        botaoCarrinho.style.display = 'flex';
                        botaoCarrinho.classList.remove('hidden');
                    }
                    
                    // Exibir mensagem de feedback
                    const mensagem = document.createElement('div');
                    mensagem.className = 'fixed top-4 right-4 bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded shadow-lg z-50 animate-fade-in-out';
                    mensagem.innerHTML = `<p class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg><strong>Carrinho limpo com sucesso!</strong></p>`;
                    document.body.appendChild(mensagem);
                    
                    // Remover mensagem ap√≥s 2 segundos
                    setTimeout(() => {
                        mensagem.classList.add('animate-fade-out');
                        setTimeout(() => mensagem.remove(), 500);
                    }, 2000);
                    
                    // Voltar para o step 1
                    mostrarStep(1);
                    
                    // Garantir que o scroll da p√°gina continue funcionando
                    document.body.style.overflow = '';
                    document.body.classList.remove('overflow-hidden');
                    
                    console.log('Carrinho limpo com sucesso');
                } catch (error) {
                    console.error('Erro ao limpar o carrinho:', error);
                    alert('Ocorreu um erro ao limpar o carrinho. Por favor, tente novamente.');
                }
            }
        }
        
        // Vari√°vel para controlar o step atual
        let stepAtual = 1;
        
        // Vari√°vel para armazenar a forma de pagamento selecionada
        let formaPagamentoSelecionada = '';
        
        // Fun√ß√£o para mostrar um step espec√≠fico
        function mostrarStep(numero) {
            try {
                // Validar se o n√∫mero do step √© v√°lido (1, 2 ou 3)
                if (!numero || isNaN(numero) || numero < 1 || numero > 3) {
                    console.error(`N√∫mero de step inv√°lido: ${numero}, usando step 1 como fallback`);
                    numero = 1; // Valor padr√£o seguro
                }
                
                console.log(`Mostrando step ${numero}`);
                stepAtual = numero; // Atualizar vari√°vel global
                
                // Esconder todos os steps
                document.querySelectorAll('.step').forEach(step => {
                    step.classList.add('hidden');
                });
                
                // Mostrar o step solicitado
                const stepAtualElement = document.getElementById(`step-${numero}`);
                if (stepAtualElement) {
                    stepAtualElement.classList.remove('hidden');
                } else {
                    console.error(`Elemento step-${numero} n√£o encontrado`);
                }
                
                // Atualizar indicadores de progresso
                atualizarIndicadoresProgresso(numero);
                
                // Atualizar bot√µes de navega√ß√£o
                const botaoVoltar = document.getElementById('botao-voltar');
                const botaoContinuar = document.getElementById('botao-continuar');
                const botaoEnviar = document.getElementById('botao-enviar');
                
                if (botaoVoltar && botaoContinuar && botaoEnviar) {
                    // Step 1: Mostrar apenas bot√£o Continuar
                    if (numero === 1) {
                        botaoVoltar.classList.add('hidden');
                        botaoContinuar.classList.remove('hidden');
                        botaoEnviar.classList.add('hidden');
                        
                        try {
                            // Verificar se h√° itens no carrinho para habilitar/desabilitar o bot√£o continuar
                            const carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
                            if (carrinho.length > 0) {
                                botaoContinuar.disabled = false;
                                botaoContinuar.classList.remove('opacity-50', 'cursor-not-allowed');
                            } else {
                                botaoContinuar.disabled = true;
                                botaoContinuar.classList.add('opacity-50', 'cursor-not-allowed');
                            }
                        } catch (e) {
                            console.error('Erro ao verificar carrinho no mostrarStep:', e);
                        }
                    }
                    // Step 2: Mostrar bot√£o Voltar e Continuar (desabilitado at√© selecionar op√ß√£o)
                    else if (numero === 2) {
                        botaoVoltar.classList.remove('hidden');
                        botaoContinuar.classList.remove('hidden');
                        botaoEnviar.classList.add('hidden');
                        
                        // Desabilitar bot√£o continuar at√© que uma op√ß√£o seja selecionada
                        botaoContinuar.disabled = !opcaoEntregaSelecionada;
                        if (!opcaoEntregaSelecionada) {
                            botaoContinuar.classList.add('opacity-50', 'cursor-not-allowed');
                        } else {
                            botaoContinuar.classList.remove('opacity-50', 'cursor-not-allowed');
                        }
                    }
                    // Step 3: Mostrar bot√£o Voltar e Enviar
                    else if (numero === 3) {
                        botaoVoltar.classList.remove('hidden');
                        botaoContinuar.classList.add('hidden');
                        botaoEnviar.classList.remove('hidden');
                        
                        // Mostrar campos espec√≠ficos baseados na op√ß√£o selecionada
                        mostrarCamposEspecificos();
                    }
                }
            } catch (e) {
                console.error('Erro ao mostrar step:', e);
                // Garantir uma recupera√ß√£o segura em caso de erro
                stepAtual = 1;
                document.querySelectorAll('.step').forEach(step => step.classList.add('hidden'));
                const step1 = document.getElementById('step-1');
                if (step1) step1.classList.remove('hidden');
            }
        }
        
        // Fun√ß√£o para atualizar os indicadores de progresso
        function atualizarIndicadoresProgresso(stepAtual) {
            // Resetar todos os indicadores
            for (let i = 1; i <= 3; i++) {
                const indicator = document.getElementById(`step-indicator-${i}`);
                if (indicator) {
                    // Se for o step atual ou anterior, marcar como conclu√≠do
                    if (i <= stepAtual) {
                        indicator.classList.remove('bg-gray-200', 'text-gray-500');
                        indicator.classList.add('bg-primary-dynamic', 'text-white');
                    } else {
                        indicator.classList.add('bg-gray-200', 'text-gray-500');
                        indicator.classList.remove('bg-primary-dynamic', 'text-white');
                    }
                }
            }
            
            // Atualizar as linhas de progresso
            for (let i = 1; i <= 2; i++) {
                const progressLine = document.getElementById(`progress-line-${i}`);
                if (progressLine) {
                    if (stepAtual > i) {
                        // Se j√° passou deste step, preencher 100%
                        progressLine.style.width = '100%';
                    } else if (stepAtual === i) {
                        // Se est√° neste step, preencher 50%
                        progressLine.style.width = '50%';
                    } else {
                        // Se ainda n√£o chegou neste step, preencher 0%
                        progressLine.style.width = '0%';
                    }
                }
            }
        }
        
        // Fun√ß√£o para avan√ßar para o pr√≥ximo step
        function avancarStep() {
            console.log('Avan√ßando para o pr√≥ximo step');
            
            // Verificar se h√° itens no carrinho
            const carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
            if (carrinho.length === 0) {
                alert('Adicione itens ao carrinho para continuar.');
                return;
            }
            
            // Valida√ß√µes espec√≠ficas para o step 2
            if (stepAtual === 2 && !opcaoEntregaSelecionada) {
                alert('Selecione uma op√ß√£o de entrega para continuar.');
                return;
            }
            
            // Avan√ßar para o pr√≥ximo step sequencialmente
            stepAtual++;
            mostrarStep(stepAtual);
            
            // Se avan√ßou para o step 3, configurar os campos espec√≠ficos
            if (stepAtual === 3) {
                // Popular o formul√°rio de forma de pagamento
                const formaPagamentoSelect = document.getElementById('forma-pagamento');
                if (formaPagamentoSelect) {
                    popularFormasPagamento(formaPagamentoSelect);
                }
                
                // Mostrar campos espec√≠ficos baseados na op√ß√£o selecionada
                mostrarCamposEspecificos();
            }
        }
        
        // Fun√ß√£o para voltar ao step anterior
        function voltarStep() {
            try {
                console.log('Voltando para o step anterior');
                
                // Verificar se estamos no primeiro step
                if (stepAtual <= 1) {
                    stepAtual = 1; // Garantir que n√£o seja menor que 1
                } else {
                    stepAtual--;
                }
                
                // Mostrar o step correto
                mostrarStep(stepAtual);
                
                // Verificar se h√° itens no carrinho para habilitar o bot√£o continuar
                if (stepAtual === 1) {
                    try {
                        const carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
                        const botaoContinuar = document.getElementById('botao-continuar');
                        
                        if (botaoContinuar) {
                            if (carrinho.length > 0) {
                                // Habilitar bot√£o se houver itens no carrinho
                                botaoContinuar.disabled = false;
                                botaoContinuar.classList.remove('opacity-50', 'cursor-not-allowed');
                            } else {
                                // Desabilitar bot√£o se o carrinho estiver vazio
                                botaoContinuar.disabled = true;
                                botaoContinuar.classList.add('opacity-50', 'cursor-not-allowed');
                            }
                        }
                    } catch (e) {
                        console.error('Erro ao verificar carrinho:', e);
                    }
                }
            } catch (e) {
                console.error('Erro ao voltar para o step anterior:', e);
            }
        }
        
        // Fun√ß√£o para resetar o formul√°rio
        function resetarFormulario() {
            console.log('Resetando formul√°rio');
            
            // Limpar campos do formul√°rio
            const formCliente = document.getElementById('form-cliente');
            if (formCliente) {
                formCliente.reset();
            }
            
            // Limpar observa√ß√µes dos itens
            const textareas = document.querySelectorAll('textarea[id^="obs-"]');
            textareas.forEach(textarea => {
                textarea.value = '';
            });
            
            // Resetar op√ß√£o de entrega selecionada
            opcaoEntregaSelecionada = '';
            
            // Resetar a forma de pagamento selecionada
            formaPagamentoSelecionada = '';
            
            // Resetar visual dos radio buttons
            document.querySelectorAll('.radio-circle').forEach(radio => {
                radio.classList.remove('selected');
            });
            
            // Desabilitar bot√£o continuar no step 2
            const botaoContinuar = document.getElementById('botao-continuar');
            if (botaoContinuar) {
                botaoContinuar.disabled = true;
                botaoContinuar.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }
        
        // Vari√°vel para armazenar a op√ß√£o de entrega selecionada
        let opcaoEntregaSelecionada = '';
        
        // Fun√ß√£o para selecionar op√ß√£o de entrega
        // Fun√ß√£o para carregar op√ß√µes de entrega da planilha
        function carregarOpcoesEntrega(config) {
            const opcoesEntregaContainer = document.getElementById('opcoes-entrega');
            if (!opcoesEntregaContainer) return;
            
            // Limpar op√ß√µes existentes
            opcoesEntregaContainer.innerHTML = '';
            
            // √çcones para cada tipo de op√ß√£o
            const icones = {
                'local': 'fa-utensils',
                'retirada': 'fa-shopping-bag',
                'delivery': 'fa-motorcycle',
                'padrao': 'fa-box'
            };
            
            // Tipos de op√ß√µes e seus IDs
            const opcoesConfig = [
                { campo: 'Step-2-opc-1', id: 'local' },
                { campo: 'Step-2-opc-2', id: 'retirada' },
                { campo: 'Step-2-opc-3', id: 'delivery' },
                { campo: 'Step-2-opc-4', id: 'padrao' }
            ];
            
            // Processar cada op√ß√£o
            opcoesConfig.forEach(opcao => {
                const valorConfig = config[opcao.campo];
                if (!valorConfig) return;
                
                // Dividir o valor em partes (Sim/N√£o, Label Principal, Label Secund√°rio)
                const partes = valorConfig.split('/');
                if (partes.length < 2) return;
                
                const disponivel = partes[0].trim().toLowerCase() === 'sim';
                if (!disponivel) return; // Pular se n√£o estiver dispon√≠vel
                
                const labelPrincipal = partes[1].trim();
                const labelSecundario = partes.length > 2 ? partes[2].trim() : '';
                
                // Criar elemento da op√ß√£o
                const divOpcao = document.createElement('div');
                divOpcao.className = 'opcao-entrega border border-gray-300 rounded-lg p-4 cursor-pointer hover:bg-gray-50 transition-colors';
                divOpcao.onclick = function() { selecionarOpcaoEntrega(opcao.id); };
                
                divOpcao.innerHTML = `
                    <div class="flex items-center">
                        <div class="flex-shrink-0 mr-3">
                            <i class="fas ${icones[opcao.id]} h-6 w-6 text-primary-dynamic"></i>
                        </div>
                        <div>
                            <h5 class="font-medium">${labelPrincipal}</h5>
                            <p class="text-sm text-gray-600 text-color-dynamic">${labelSecundario}</p>
                        </div>
                        <div class="ml-auto">
                            <div class="radio-circle" id="radio-${opcao.id}"></div>
                        </div>
                    </div>
                `;
                
                opcoesEntregaContainer.appendChild(divOpcao);
            });
            
            // Se n√£o houver op√ß√µes, mostrar mensagem
            if (opcoesEntregaContainer.children.length === 0) {
                opcoesEntregaContainer.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <p class="text-lg">Nenhuma op√ß√£o de entrega dispon√≠vel</p>
                        <p class="mt-2">Entre em contato com o estabelecimento</p>
                    </div>
                `;
            }
        }
        
        // Vari√°vel para armazenar se a op√ß√£o 4 foi selecionada
        let opcaoEntregaPadrao = false;
        
        function selecionarOpcaoEntrega(opcao) {
            console.log('Selecionando op√ß√£o de entrega:', opcao);
            opcaoEntregaSelecionada = opcao;
            
            // Verificar se √© a op√ß√£o 4 (padr√£o)
            opcaoEntregaPadrao = (opcao === 'padrao');
            
            // Resetar todos os radio buttons
            document.querySelectorAll('.radio-circle').forEach(radio => {
                radio.classList.remove('selected');
            });
            
            // Marcar o radio button selecionado
            document.getElementById(`radio-${opcao}`).classList.add('selected');
            
            // Habilitar bot√£o continuar
            document.getElementById('botao-continuar').disabled = false;
            document.getElementById('botao-continuar').classList.remove('opacity-50', 'cursor-not-allowed');
            
            // Mostrar ou esconder a mensagem de taxa de entrega
            const mensagemTaxaEntrega = document.getElementById('mensagem-taxa-entrega');
            if (opcao === 'delivery') {
                mensagemTaxaEntrega.classList.remove('hidden');
            } else {
                mensagemTaxaEntrega.classList.add('hidden');
            }
        }
        
        // Fun√ß√£o para popular o campo de formas de pagamento
        function popularFormasPagamento(selectElement) {
            // Usar o elemento passado como par√¢metro ou buscar o elemento padr√£o
            const selectFormaPagamento = selectElement || document.getElementById('forma-pagamento');
            if (!selectFormaPagamento) return;
            
            // Salvar o valor atual antes de limpar (se houver)
            const valorAtual = selectFormaPagamento.value || formaPagamentoSelecionada;
            
            // Limpar op√ß√µes existentes, mantendo apenas a op√ß√£o padr√£o
            while (selectFormaPagamento.options.length > 1) {
                selectFormaPagamento.remove(1);
            }
            
            // Obter as formas de pagamento da configura√ß√£o
            const formasPagamentoConfig = dadosGlobais.config['Step-3-formas-de-pag'];
            if (formasPagamentoConfig) {
                // Dividir a string por v√≠rgulas e remover espa√ßos em branco
                const formasPagamento = formasPagamentoConfig.split(',').map(forma => forma.trim());
                
                // Adicionar cada forma de pagamento como uma op√ß√£o
                formasPagamento.forEach(forma => {
                    const option = document.createElement('option');
                    option.value = forma.toLowerCase().replace(/\s+/g, '-'); // Converter para slug
                    option.textContent = forma;
                    selectFormaPagamento.appendChild(option);
                });
                
                console.log('Formas de pagamento carregadas:', formasPagamento);
            } else {
                console.warn('Configura√ß√£o de formas de pagamento n√£o encontrada');
                
                // Adicionar op√ß√µes padr√£o caso n√£o haja configura√ß√£o
                const formasPadrao = ['Dinheiro', 'Pix', 'Cart√£o de Cr√©dito', 'Cart√£o de D√©bito'];
                formasPadrao.forEach(forma => {
                    const option = document.createElement('option');
                    option.value = forma.toLowerCase().replace(/\s+/g, '-');
                    option.textContent = forma;
                    selectFormaPagamento.appendChild(option);
                });
            }
            
            // Adicionar evento change para salvar a sele√ß√£o atual
            if (!selectFormaPagamento.hasAttribute('data-event-attached')) {
                selectFormaPagamento.addEventListener('change', function() {
                    formaPagamentoSelecionada = this.value;
                    console.log('Forma de pagamento selecionada salva:', formaPagamentoSelecionada);
                });
                selectFormaPagamento.setAttribute('data-event-attached', 'true');
            }
            
            // Restaurar o valor selecionado anteriormente, se existir
            if (valorAtual && valorAtual !== '') {
                // Verificar se o valor existe nas op√ß√µes
                let valorExiste = false;
                for (let i = 0; i < selectFormaPagamento.options.length; i++) {
                    if (selectFormaPagamento.options[i].value === valorAtual) {
                        valorExiste = true;
                        break;
                    }
                }
                
                if (valorExiste) {
                    selectFormaPagamento.value = valorAtual;
                    console.log('Valor da forma de pagamento restaurado:', valorAtual);
                } else {
                    console.warn('Valor anterior n√£o encontrado nas op√ß√µes atuais:', valorAtual);
                }
            }
        }
        
        // Fun√ß√£o para validar que o campo mesa-comanda s√≥ aceite n√∫meros
        function configurarCampoMesaComanda() {
            const inputMesaComanda = document.getElementById('mesa-comanda');
            if (inputMesaComanda) {
                // Remove qualquer listener anterior para evitar duplicidades
                const novoInput = inputMesaComanda.cloneNode(true);
                inputMesaComanda.parentNode.replaceChild(novoInput, inputMesaComanda);
                
                // Adiciona evento para filtrar entrada de texto e permitir apenas n√∫meros
                novoInput.addEventListener('input', function(e) {
                    // Remove qualquer caractere que n√£o seja n√∫mero
                    this.value = this.value.replace(/[^0-9]/g, '');
                });
                
                // Impedir cole de texto n√£o num√©rico
                novoInput.addEventListener('paste', function(e) {
                    // Captura o texto colado
                    let paste = (e.clipboardData || window.clipboardData).getData('text');
                    // Verifica se cont√©m apenas n√∫meros
                    if (!/^\d+$/.test(paste)) {
                        e.preventDefault();
                        console.log('Tentativa de colar texto n√£o num√©rico bloqueada');
                    }
                });
                
                console.log('Campo mesa-comanda configurado para aceitar apenas n√∫meros');
            }
        }
        
        // Fun√ß√£o para mostrar campos espec√≠ficos no step 3
        function mostrarCamposEspecificos() {
            console.log('Mostrando campos espec√≠ficos para:', opcaoEntregaSelecionada);
            
            try {
                // Esconder todos os campos espec√≠ficos
                document.querySelectorAll('.campos-opcao').forEach(campo => {
                    campo.classList.add('hidden');
                });
                
                // Verificar se existe opcaoEntregaSelecionada v√°lida
                if (!opcaoEntregaSelecionada) {
                    console.warn('Nenhuma op√ß√£o de entrega selecionada!');
                    return;
                }
                
                // Mostrar campos espec√≠ficos para a op√ß√£o selecionada
                if (opcaoEntregaSelecionada === 'local') {
                    const camposLocal = document.getElementById('campos-local');
                    if (camposLocal) {
                        camposLocal.classList.remove('hidden');
                    }
                    
                    // Verificar se o campo Mesa/Comanda deve ser exibido
                    const containerMesaComanda = document.getElementById('container-mesa-comanda');
                    if (containerMesaComanda) {
                        // Verificar se dados globais est√£o dispon√≠veis
                        let mesaComandaAtivado = true; // valor padr√£o se configura√ß√£o n√£o estiver dispon√≠vel
                        
                        if (window.dadosGlobais && dadosGlobais.config && dadosGlobais.config['Step-3-mesa-comanda']) {
                            mesaComandaAtivado = dadosGlobais.config['Step-3-mesa-comanda'] === 'Sim';
                        }
                        
                        containerMesaComanda.style.display = mesaComandaAtivado ? 'block' : 'none';
                        
                        // Se o campo estiver desativado, remover o atributo required
                        const inputMesaComanda = document.getElementById('mesa-comanda');
                        if (inputMesaComanda) {
                            if (mesaComandaAtivado) {
                                inputMesaComanda.setAttribute('required', '');
                                // Configurar campo para aceitar apenas n√∫meros
                                try {
                                    configurarCampoMesaComanda();
                                } catch (err) {
                                    console.error('Erro ao configurar campo mesa-comanda:', err);
                                }
                            } else {
                                inputMesaComanda.removeAttribute('required');
                            }
                        }
                    }
                } else if (opcaoEntregaSelecionada === 'delivery') {
                    const camposDelivery = document.getElementById('campos-delivery');
                    if (camposDelivery) {
                        camposDelivery.classList.remove('hidden');
                    }
                }
                // Para 'retirada' n√£o h√° campos espec√≠ficos, apenas os comuns
                
                // Verificar se o campo de formas de pagamento deve ser exibido
                const containerFormaPagamento = document.getElementById('container-forma-pagamento');
                if (containerFormaPagamento) {
                    // Verificar se dados globais est√£o dispon√≠veis
                    let mostrarFormaPagamento = true; // valor padr√£o se configura√ß√£o n√£o estiver dispon√≠vel
                    
                    // Primeiro verificar se √© a op√ß√£o "Consumo no Local"
                    if (opcaoEntregaSelecionada === 'local') {
                        // Se for "Consumo no Local", NUNCA mostrar o campo de forma de pagamento
                        mostrarFormaPagamento = false;
                        console.log('Campo de forma de pagamento ocultado porque a op√ß√£o selecionada √© "Consumo no Local"');
                        
                        // Ocultar tamb√©m os campos relacionados ao troco
                        const containerTroco = document.getElementById('container-troco');
                        const campoValorTroco = document.getElementById('campo-valor-troco');
                        
                        if (containerTroco) {
                            containerTroco.classList.add('hidden');
                        }
                        
                        if (campoValorTroco) {
                            campoValorTroco.classList.add('hidden');
                        }
                        
                        console.log('Campos de troco ocultados porque a op√ß√£o selecionada √© "Consumo no Local"');
                    } else {
                        // Para as outras op√ß√µes (delivery/retirada), verificar a configura√ß√£o da planilha
                        if (window.dadosGlobais && dadosGlobais.config && dadosGlobais.config['Step-3-show-formas-de-pag']) {
                            mostrarFormaPagamento = dadosGlobais.config['Step-3-show-formas-de-pag'] === 'Sim';
                        }
                        
                        // Caso as outras op√ß√µes mostrem forma de pagamento, precisamos atualizar o status do campo de troco
                        // mas apenas se a forma de pagamento for exibida
                        if (mostrarFormaPagamento) {
                            try {
                                // Atualiza o campo de troco baseado na forma de pagamento atual
                                verificarFormaPagamento();
                            } catch (err) {
                                console.error('Erro ao verificar forma de pagamento:', err);
                            }
                        }
                    }                  
                    containerFormaPagamento.style.display = mostrarFormaPagamento ? 'block' : 'none';
                    
                    // Se o campo estiver vis√≠vel, popular as op√ß√µes
                    const formaPagamentoSelect = document.getElementById('forma-pagamento');
                    if (formaPagamentoSelect) {
                        // Remover ou adicionar o atributo required conforme visibilidade
                        if (mostrarFormaPagamento) {
                            formaPagamentoSelect.setAttribute('required', '');
                            try {
                                popularFormasPagamento(formaPagamentoSelect);
                                
                                // Configurar evento para verificar forma de pagamento
                                formaPagamentoSelect.addEventListener('change', verificarFormaPagamento);
                                
                                // Inicializar campos de troco
                                verificarFormaPagamento();
                                
                                // Configurar eventos para os radio buttons de troco
                                const radioSim = document.querySelector('input[name="precisa-troco"][value="sim"]');
                                const radioNao = document.querySelector('input[name="precisa-troco"][value="nao"]');
                                if (radioSim && radioNao) {
                                    radioSim.addEventListener('change', function() { mostrarCampoTroco(true); });
                                    radioNao.addEventListener('change', function() { mostrarCampoTroco(false); });
                                    
                                    // Inicializar o campo de valor do troco baseado na sele√ß√£o atual
                                    if (radioSim.checked) {
                                        mostrarCampoTroco(true);
                                    } else {
                                        mostrarCampoTroco(false);
                                    }
                                }
                            } catch (e) {
                                console.error('Erro ao popular formas de pagamento:', e);
                            }
                        } else {
                            formaPagamentoSelect.removeAttribute('required');
                        }
                    }
                }
            } catch (e) {
                console.error('Erro ao mostrar campos espec√≠ficos:', e);
            }
        }
        
        // Fun√ß√£o para finalizar o pedido
        function finalizarPedido() {
            console.log('Finalizando pedido');
            
            // Obter dados do formul√°rio
            const nomeCliente = document.getElementById('nome-cliente').value.trim();
            const observacaoGeral = document.getElementById('observacao-geral').value.trim();
            
            // Obter dados espec√≠ficos conforme op√ß√£o selecionada
            let mesaComanda = '';
            let enderecoEntrega = '';
            
            if (opcaoEntregaSelecionada === 'local') {
                mesaComanda = document.getElementById('mesa-comanda').value.trim();
            } else if (opcaoEntregaSelecionada === 'delivery') {
                enderecoEntrega = document.getElementById('endereco-entrega').value.trim();
                
                // Validar endere√ßo para delivery
                if (!enderecoEntrega) {
                    alert('Por favor, informe o endere√ßo de entrega para continuar.');
                    document.getElementById('endereco-entrega').focus();
                    return;
                }
            }
            
            // Validar nome do cliente (obrigat√≥rio)
            if (!nomeCliente) {
                alert('Por favor, informe seu nome para continuar.');
                document.getElementById('nome-cliente').focus();
                return;
            }
            
            // Obter itens do carrinho
            const carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
            if (carrinho.length === 0) {
                alert('Seu carrinho est√° vazio. Adicione itens para fazer um pedido.');
                mostrarStep(1);
                return;
            }
            
            // Montar mensagem do pedido com emojis e melhor formata√ß√£o
            let mensagem = `üîî *NOVO PEDIDO* üîî\n\n`;
            
            // Data e hora do pedido
            const agora = new Date();
            const dataFormatada = agora.toLocaleDateString('pt-BR');
            const horaFormatada = agora.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'});
            mensagem += `üìÖ *Data*: ${dataFormatada}\n‚è∞ *Hora*: ${horaFormatada}\n\n`;
            
            // Dados do cliente
            mensagem += `üë§ *DADOS DO CLIENTE*\n`;
            mensagem += `‚û°Ô∏è *Nome*: ${nomeCliente}\n`;
            
            // Verificar se o campo de formas de pagamento deve ser exibido
            let mostrarFormaPagamento = dadosGlobais.config['Step-3-show-formas-de-pag'] === 'Sim';
                
            // Verificar se Step-2-opc-1 √© "Sim" e se a op√ß√£o selecionada √© "local" (Consumo no Local)
            if (opcaoEntregaSelecionada === 'local' && dadosGlobais.config['Step-2-opc-1'] === 'Sim') {
                mostrarFormaPagamento = false;
            }
            
            if (mostrarFormaPagamento) {
                const formaPagamento = document.getElementById('forma-pagamento');
                if (formaPagamento && formaPagamento.value && formaPagamento.value !== '') {
                    const formaPagamentoTexto = formaPagamento.options[formaPagamento.selectedIndex].text;
                    mensagem += `üí≥ *Pagamento*: ${formaPagamentoTexto}\n`;
                    
                    // Verificar se √© pagamento em dinheiro e se precisa de troco
                    if (formaPagamento.value.toLowerCase() === 'dinheiro') {
                        const precisaTroco = document.querySelector('input[name="precisa-troco"]:checked');
                        if (precisaTroco && precisaTroco.value === 'sim') {
                            const valorTroco = document.getElementById('valor-troco');
                            if (valorTroco && valorTroco.value.trim()) {
                                mensagem += `üí∞ *Troco para*: R$ ${valorTroco.value.trim()}\n`;
                            } else {
                                mensagem += `üí∞ *Precisa de troco*: Sim\n`;
                            }
                        } else if (precisaTroco) {
                            mensagem += `üí∞ *Precisa de troco*: N√£o\n`;
                        }
                    }
                }
            }
            
            // M√©todo de envio e dados espec√≠ficos
            if (opcaoEntregaSelecionada === 'local') {
                mensagem += `\nüçΩÔ∏è *Consumo no Local*\n`;
                // Verificar se o campo mesa-comanda existe e est√° preenchido
                const inputMesaComanda = document.getElementById('mesa-comanda');
                if (inputMesaComanda && inputMesaComanda.value.trim()) {
                    mensagem += `üìå *Mesa/Comanda*: ${inputMesaComanda.value.trim()}\n`;
                } else if (mesaComanda) {
                    // Usar o valor j√° capturado no in√≠cio da fun√ß√£o
                    mensagem += `üìå *Mesa/Comanda*: ${mesaComanda}\n`;
                }
            } else if (opcaoEntregaSelecionada === 'delivery') {
                mensagem += `\nüöó *Entrega - Delivery*\n`;
                if (enderecoEntrega) {
                    mensagem += `üè† *Endere√ßo*: ${enderecoEntrega}\n`;
                }
                // Removida a mensagem de taxa de entrega conforme solicitado
            } else if (opcaoEntregaSelecionada === 'retirada') {
                mensagem += `\nüõçÔ∏è *Cliente vai Retirar no Local*\n`;
            }
            
            // Observa√ß√µes gerais
            if (observacaoGeral) {
                mensagem += `\nüí¨ *OBSERVA√á√ïES*\n${observacaoGeral}\n`;
            }
            
            // Lista de itens
            mensagem += `\nüõí *ITENS DO PEDIDO*\n`;
            
            // Adicionar itens do carrinho
            carrinho.forEach((item, index) => {
                mensagem += `\n${index + 1}. ${item.titulo} (${item.quantidade}x)`;
                if (item.observacao) mensagem += `\n   ‚û°Ô∏è _${item.observacao}_`;
                mensagem += `\n`;
            });
            
            mensagem += `\n‚úÖ *Pedido Finalizado* - Aguardando confirma√ß√£o do estabelecimento\n`;
            mensagem += `\nüëç Obrigado pela prefer√™ncia!`;
            
            // Codificar mensagem para URL
            const mensagemCodificada = encodeURIComponent(mensagem);
            
            // Abrir WhatsApp com a mensagem
            // Obter o n√∫mero de WhatsApp da planilha de configura√ß√µes
            const numeroWhatsApp = dadosGlobais.config['WhatsApp'];
            if (!numeroWhatsApp) {
                alert('N√∫mero de WhatsApp n√£o configurado na planilha.');
                return;
            }
            
            // Remover caracteres n√£o num√©ricos do n√∫mero
            const numeroLimpo = numeroWhatsApp.replace(/\D/g, '');
            
            // Enviar pedido sem confirma√ß√£o
            // Limpar carrinho ap√≥s envio
            localStorage.removeItem('carrinho');
            atualizarContadorCarrinho();
            resetarFormulario();
            
            // Fechar modal
            fecharModal();
            
            // Detectar o dispositivo e enviar o pedido de forma adequada
            enviarPedidoWhatsApp(numeroLimpo, mensagemCodificada);
        }
        
        // Fun√ß√£o auxiliar para obter texto do tipo de entrega
        function getTextoTipoEntrega(tipo) {
            switch(tipo) {
                case 'delivery': return 'Delivery';
                case 'retirada': return 'Retirada no Local';
                case 'consumo': return 'Consumo no Local';
                default: return 'N√£o especificado';
            }
        }
        
        /**
         * Fun√ß√£o para enviar pedido via WhatsApp de acordo com o dispositivo
         * Trata diferentes plataformas e dispositivos para garantir compatibilidade
         * @param {string} numero - N√∫mero de telefone limpo (apenas d√≠gitos)
         * @param {string} mensagem - Mensagem codificada para URL
         */
        function enviarPedidoWhatsApp(numero, mensagem) {
            // Garantir que o n√∫mero e a mensagem sejam v√°lidos
            if (!numero || numero.length < 8) {
                console.error('N√∫mero de telefone inv√°lido:', numero);
                alert('N√∫mero de telefone inv√°lido. Por favor, verifique as configura√ß√µes.');
                return false;
            }
            
            if (!mensagem) {
                console.error('Mensagem vazia');
                alert('N√£o foi poss√≠vel construir a mensagem do pedido.');
                return false;
            }
            
            // Detectar dispositivo e navegador
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isMac = /Mac/i.test(navigator.userAgent);
            const isWindows = /Windows/i.test(navigator.userAgent);
            const isDesktop = !isMobile;
            
            console.log('Enviando pedido, dispositivo detectado:', { isMobile, isIOS, isMac, isWindows, userAgent: navigator.userAgent });
            console.log('N√∫mero de destino:', numero);
            
            try {
                // Verificar o formato do n√∫mero e adicionar prefixo se necess√°rio
                if (numero.length === 11 || numero.length === 10) {
                    // Adicionar c√≥digo do pa√≠s Brasil
                    numero = '55' + numero;
                }
                
                // M√©todo simplificado que funciona em todos os dispositivos
                const webUrl = `https://api.whatsapp.com/send?phone=${numero}&text=${mensagem}`;
                
                // Registro de log para depura√ß√£o
                console.log('URL de envio:', webUrl);
                
                // Abrir em nova janela com fallback para mesma janela
                try {
                    const newWindow = window.open(webUrl, '_blank');
                    if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
                        // Se falhar ao abrir em nova janela, tentar na mesma janela
                        console.log('Fallback: Abrindo na mesma janela');
                        window.location.href = webUrl;
                    }
                    return true;
                } catch (innerError) {
                    console.error('Erro ao abrir janela:', innerError);
                    window.location.href = webUrl;
                    return true;
                }
            } catch (error) {
                console.error('Erro ao enviar mensagem para WhatsApp:', error);
                
                // Tentar m√©todo alternativo wa.me
                try {
                    const waUrl = `https://wa.me/${numero}?text=${mensagem}`;
                    console.log('Tentando m√©todo alternativo:', waUrl);
                    alert('Usando m√©todo alternativo para abrir o WhatsApp.');
                    window.location.href = waUrl;
                    return true;
                } catch (fallbackError) {
                    console.error('Falha no m√©todo alternativo:', fallbackError);
                    alert('N√£o foi poss√≠vel abrir o WhatsApp. Por favor, tente novamente mais tarde.');
                    return false;
                }
            }
        }
        
        /**
         * Fun√ß√£o simplificada para adicionar itens ao carrinho
         * Esta fun√ß√£o n√£o depende do objeto Carrinho complexo
         * @param {string} id - ID do item
         * @param {string} titulo - T√≠tulo do item
         * @param {HTMLElement} botao - O bot√£o que foi clicado
         */
        function adicionarAoCarrinhoSimples(id, titulo, botao, precoAdicional = 0) {
            console.log('Adicionando ao carrinho simplificado:', { id, titulo, precoAdicional });
            
            // Obter quantidade do input associado
            const input = document.querySelector(`.quantidade-input[data-item-id="${id}"]`);
            const quantidade = input ? parseInt(input.value) || 1 : 1;
            
            // Carrinho no localStorage
            let carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
            
            // Tentar obter a URL da imagem do item
            let imagemURL = '';
            try {
                const card = botao.closest('.card');
                if (card) {
                    const img = card.querySelector('img');
                    if (img) {
                        // Capturar a URL completa da imagem
                        if (img.currentSrc) {
                            // currentSrc retorna a URL completa da imagem carregada
                            imagemURL = img.currentSrc;
                        } else if (img.src) {
                            // Fallback para src se currentSrc n√£o estiver dispon√≠vel
                            imagemURL = img.src;
                        } else {
                            // √öltimo recurso: tentar obter o atributo src
                            imagemURL = img.getAttribute('src') || '';
                        }
                        
                        // Verificar se a URL √© v√°lida
                        if (imagemURL) {
                            console.log('Imagem capturada para o carrinho:', imagemURL);
                        }
                    }
                }
            } catch (e) {
                console.error('Erro ao obter imagem do item:', e);
            }
            
            // Gerar um ID √∫nico para cada item adicionado ao carrinho
            // Isso permite que o mesmo produto seja adicionado v√°rias vezes com personaliza√ß√µes independentes
            const uniqueId = `${id}_${Date.now()}_${Math.floor(Math.random() * 1000)}`;
            
            // Verificar se o campo de observa√ß√£o deve ser inclu√≠do
            const incluirObservacao = dadosGlobais.config['Step-1-itens-obs'] === 'Sim';
            
            // Verificar se o item j√° existe no carrinho pelo ID original e adicionar apenas a quantidade
            // Comentando essa parte para que cada clique represente apenas 1 adi√ß√£o independente
            // Isso permite que o usu√°rio adicione o mesmo produto v√°rias vezes conforme necess√°rio
            
            // Obter o pre√ßo base do produto na card
            let precoBase = 0;
            try {
                const card = botao.closest('.menu-item');
                if (card) {
                    const precoElement = card.querySelector('.price-highlight span');
                    if (precoElement) {
                        // Extrair valor num√©rico do pre√ßo exibido (removendo "R$ " e substituindo v√≠rgula por ponto)
                        const precoTexto = precoElement.textContent.replace('R$ ', '').replace(',', '.');
                        precoBase = parseFloat(precoTexto);
                    }
                }
            } catch (e) {
                console.error('Erro ao obter pre√ßo base do card:', e);
            }
            
            // Adicionar item com a quantidade selecionada pelo usu√°rio
            carrinho.push({ 
                id: uniqueId,      // ID √∫nico para este item espec√≠fico no carrinho
                originalId: id,    // ID original do produto para refer√™ncia
                titulo, 
                quantidade: quantidade,      // Usar a quantidade que o usu√°rio selecionou
                imagem: imagemURL,
                precoBase: precoBase,      // Pre√ßo base do produto
                precoAdicional: precoAdicional || 0, // Pre√ßo adicional das varia√ß√µes
                precoTotal: precoBase + (precoAdicional || 0),    // Pre√ßo total com as varia√ß√µes
                ...(incluirObservacao ? { observacao: '' } : {})
            });
            
            console.log(`Item adicionado com quantidade ${quantidade}:`, titulo);
            
            // Salvar no localStorage
            localStorage.setItem('carrinho', JSON.stringify(carrinho));
            
            // Atualizar interface
            atualizarContadorCarrinho();
            
            // Atualizar o contador no t√≠tulo do carrinho
            const totalItensCarrinho = document.getElementById('total-itens-carrinho');
            if (totalItensCarrinho) {
                // Calcular o total de itens somando todas as quantidades
                const totalItens = carrinho.reduce((acc, item) => acc + item.quantidade, 0);
                totalItensCarrinho.textContent = totalItens;
                console.log('Total de itens atualizado para:', totalItens, 'ap√≥s adicionar item');
            }
            
            // Feedback visual
            botao.textContent = 'Adicionado ‚úì';
            botao.classList.add('bg-green-600');
            
            setTimeout(() => {
                botao.textContent = 'Adicionar';
                botao.classList.remove('bg-green-600');
            }, 1500);
        }
    </script>
    <script>
        // Navega√ß√£o de scroll vertical para menu desktop
        // Autor: Dante Testa - https://dantetesta.com.br
        // Esta fun√ß√£o sincroniza o menu de filtros desktop com o scroll vertical das se√ß√µes do card√°pio.
        // Fun√ß√£o removida pois agora o menu desktop √© o mesmo que o mobile
function setupDesktopScrollNavigation() {
    // Removida pois agora usamos o mesmo menu para desktop e mobile
    console.log('Menu desktop agora usa o mesmo comportamento do mobile');
}

        // Aguarda o card√°pio ser renderizado antes de inicializar
        document.addEventListener('DOMContentLoaded', () => {
            if (document.querySelector('.categoria-secao')) {
                setupDesktopScrollNavigation();
            } else {
                const observer = new MutationObserver((mutations, obs) => {
                    if (document.querySelector('.categoria-secao')) {
                        setupDesktopScrollNavigation();
                        obs.disconnect();
                    }
                });
                observer.observe(document.body, { childList: true, subtree: true });
            }
        });
    </script>
    
    <!-- Sistema de Carrinho e Checkout -->
    <!-- Autor: Dante Testa (https://dantetesta.com.br) -->
    <!-- Implementa√ß√£o de carrinho de compras responsivo com abordagem Mobile First e fluxo de checkout em steps -->
    <script>
        /**
         * Sistema de Carrinho de Compras
         * 
         * Implementa um sistema completo de carrinho de compras com:
         * - Controles de quantidade em cada card de produto
         * - Persist√™ncia de dados via localStorage
         * - Bot√£o flutuante com contador de itens
         * - Modal de checkout com navega√ß√£o em etapas (steps)
         * - Montagem de mensagem para WhatsApp
         * 
         * A implementa√ß√£o utiliza uma abordagem Mobile First com design responsivo
         * e tecnologias web modernas (ES6+, Tailwind CSS)
         * 
         * @author Dante Testa (https://dantetesta.com.br)
         */
        const Carrinho = {
            // Itens no carrinho
            itens: [],
            
            /**
             * Inicializa o sistema de carrinho
             * - Carrega dados salvos do localStorage
             * - Configura eventos de interface
             * - Atualiza contadores visuais
             */
            inicializar: function() {
                console.log('Inicializando sistema de carrinho...');
                this.carregarDoLocalStorage();
                this.atualizarContadorCarrinho();
                this.atualizarBotaoFlutuante();
                this.configurarEventos();
                this.configurarMensagemDestacada();
            },
            
            /**
             * Carrega o carrinho do localStorage
             */
            carregarDoLocalStorage: function() {
                const carrinhoSalvo = localStorage.getItem('carrinho');
                if (carrinhoSalvo) {
                    try {
                        this.itens = JSON.parse(carrinhoSalvo);
                    } catch (e) {
                        console.error('Erro ao carregar carrinho do localStorage:', e);
                        this.itens = [];
                        localStorage.removeItem('carrinho');
                    }
                }
            },
            
            // Salva o carrinho no localStorage
            salvarNoLocalStorage: function() {
                localStorage.setItem('carrinho', JSON.stringify(this.itens));
            },
            
            // Limpa o carrinho
            limpar: function() {
                this.itens = [];
                this.salvarNoLocalStorage();
                this.atualizarContadorCarrinho();
                renderizarItensCarrinho();
                
                // Atualizar o contador no t√≠tulo do carrinho
                const totalItensCarrinho = document.getElementById('total-itens-carrinho');
                if (totalItensCarrinho) {
                    totalItensCarrinho.textContent = '0';
                    console.log('Total de itens atualizado para: 0 ap√≥s limpar o carrinho');
                }
            },
            
            /**
             * Adiciona um item ao carrinho de compras
             * @param {string} id - ID √∫nico do item
             * @param {string} titulo - Nome/t√≠tulo do produto
             * @param {number} quantidade - Quantidade desejada do produto
             * @param {string} observacao - Observa√ß√£o opcional sobre o item (padr√£o vazio)
             * @description Adiciona um novo item ao carrinho de compras ou atualiza a quantidade de um item existente.
             *              Salva o carrinho no localStorage e atualiza a exibi√ß√£o do carrinho.
             */
            adicionar: function(id, titulo, quantidade, observacao = '') {
                console.log('[Carrinho] adicionar chamado', {id, titulo, quantidade, observacao});
                // Validar quantidade
                quantidade = parseInt(quantidade) || 1;
                if (quantidade < 1) quantidade = 1;
                
                // Verificar se o item j√° est√° no carrinho
                const itemExistente = this.itens.find(item => item.id === id);
                
                if (itemExistente) {
                    // Se existir, atualiza a quantidade
                    itemExistente.quantidade = quantidade;
                } else {
                    // Se n√£o existir, adiciona como novo item
                    this.itens.push({
                        id: id,
                        titulo: titulo,
                        quantidade: quantidade,
                        observacao: ''
                    });
                }
                
                this.salvarNoLocalStorage();
                this.atualizarContadorCarrinho();
                this.atualizarBotaoFlutuante();
                renderizarItensCarrinho();
                
                // Atualizar o contador total de itens no t√≠tulo do carrinho
                const totalItensCarrinho = document.getElementById('total-itens-carrinho');
                if (totalItensCarrinho) {
                    // Calcular o total de itens somando todas as quantidades
                    const totalItens = this.itens.reduce((acc, item) => acc + item.quantidade, 0);
                    totalItensCarrinho.textContent = totalItens;
                    console.log('Total de itens atualizado para:', totalItens, 'ap√≥s adicionar/atualizar item');
                }
                
                // Atualiza estado visual do bot√£o
                this.atualizarEstadoBotaoAdicionar(id);
                
                return true;
            },
            
            // Remove um item do carrinho
            remover: function(id) {
                // Encontrar o item antes de remover para obter sua quantidade
                const itemRemovido = this.itens.find(item => item.id === id);
                const quantidadeRemovida = itemRemovido ? itemRemovido.quantidade : 0;
                
                // Remover o item
                this.itens = this.itens.filter(item => item.id !== id);
                this.salvarNoLocalStorage();
                this.atualizarContadorCarrinho();
                renderizarItensCarrinho();
                this.atualizarBotaoFlutuante();
                
                // Atualizar o contador no t√≠tulo do carrinho
                const totalItensCarrinho = document.getElementById('total-itens-carrinho');
                if (totalItensCarrinho) {
                    // Calcular o total de itens somando todas as quantidades
                    const totalItens = this.itens.reduce((acc, item) => acc + item.quantidade, 0);
                    totalItensCarrinho.textContent = totalItens;
                    console.log('Total de itens atualizado para:', totalItens, 'ap√≥s remover', quantidadeRemovida, 'unidades');
                }
                
                // Resetar estado visual do bot√£o
                const botao = document.querySelector(`.adicionar-ao-carrinho[data-item-id="${id}"]`);
                if (botao) {
                    botao.textContent = 'Adicionar ao Carrinho';
                    botao.classList.remove('bg-green-600', 'hover:bg-green-700');
                    botao.classList.add('bg-primary-dynamic', 'hover:bg-primary-dynamic/90');
                }
                
                // Resetar campo de quantidade
                const input = document.querySelector(`.quantidade-input[data-item-id="${id}"]`);
                if (input) {
                    input.value = 1;
                }
            },
            
            // Atualiza a observa√ß√£o de um item
            atualizarObservacao: function(id, observacao) {
                const item = this.itens.find(item => item.id === id);
                if (item) {
                    item.observacao = observacao;
                    this.salvarNoLocalStorage();
                }
            },
            
            // Atualiza contador do carrinho
            atualizarContadorCarrinho: function() {
                const totalItens = this.itens.reduce((acc, item) => acc + item.quantidade, 0);
                const contador = document.getElementById('contador-carrinho');
                if (contador) {
                    contador.textContent = totalItens;
                }
                
                // Atualizar tamb√©m o contador no t√≠tulo do carrinho
                const totalItensCarrinho = document.getElementById('total-itens-carrinho');
                if (totalItensCarrinho) {
                    // Usar totalItens para mostrar a quantidade total de itens, n√£o apenas o n√∫mero de itens diferentes
                    totalItensCarrinho.textContent = totalItens;
                }
                
                console.log('Atualizando contador do carrinho:', totalItens);
            },
            
            /**
             * Atualiza a visibilidade do bot√£o flutuante do carrinho
             * - Mostra o bot√£o quando h√° itens no carrinho
             * - Esconde o bot√£o quando o carrinho est√° vazio
             */
            atualizarBotaoFlutuante: function() {
                // ID correto do bot√£o √© 'botao-carrinho', n√£o 'carrinho-flutuante'
                const botaoFlutuante = document.getElementById('botao-carrinho');
                console.log('[Carrinho] atualizarBotaoFlutuante chamado, itens:', this.itens, 'length:', this.itens.length, 'DOM:', botaoFlutuante);
                
                if (!botaoFlutuante) {
                    console.error('Bot√£o do carrinho n√£o encontrado no DOM!');
                    return;
                }
                
                // For√ßar exibir para depura√ß√£o
                if (this.itens && this.itens.length > 0) {
                    // Exibir bot√£o
                    botaoFlutuante.classList.remove('hidden');
                    botaoFlutuante.style.display = 'flex'; // Usando 'flex' conforme definido no HTML
                    botaoFlutuante.style.opacity = '1';
                    botaoFlutuante.style.pointerEvents = 'auto';
                    
                    // Garantir que o onclick est√° definido
                    if (!botaoFlutuante.hasAttribute('onclick') || !botaoFlutuante.getAttribute('onclick')) {
                        botaoFlutuante.setAttribute('onclick', 'abrirModal();');
                        console.log('Adicionado evento onclick ao bot√£o do carrinho');
                    }
                    
                    // Atualizar contador do carrinho
                    const contadorCarrinho = botaoFlutuante.querySelector('#carrinho-contador');
                    if (contadorCarrinho) {
                        const totalItens = this.itens.reduce((acc, item) => acc + item.quantidade, 0);
                        contadorCarrinho.textContent = totalItens;
                        contadorCarrinho.classList.remove('hidden');
                    }
                } else {
                    // Manter bot√£o vis√≠vel mesmo com carrinho vazio
                    botaoFlutuante.classList.remove('hidden');
                    botaoFlutuante.style.display = 'flex';
                    botaoFlutuante.style.opacity = '1'; // Opacidade total - sempre bem vis√≠vel conforme solicitado
                    botaoFlutuante.style.pointerEvents = 'auto';
                    
                    // Garantir que o onclick est√° definido
                    if (!botaoFlutuante.hasAttribute('onclick') || !botaoFlutuante.getAttribute('onclick')) {
                        botaoFlutuante.setAttribute('onclick', 'abrirModal();');
                    }
                    
                    // Atualizar contador do carrinho para zero
                    const contadorCarrinho = botaoFlutuante.querySelector('#carrinho-contador');
                    if (contadorCarrinho) {
                        contadorCarrinho.textContent = '0';
                        contadorCarrinho.classList.remove('hidden');
                    }
                }
            },
            
            /**
             * Renderiza os itens do carrinho no modal de checkout
             * - Atualiza a lista de itens no step 1
             * - Mostra mensagem de carrinho vazio se n√£o houver itens
             */
            renderizarItensCarrinho: function() {
                console.log('Renderizando itens do carrinho no modal');
                const containerItens = document.getElementById('carrinho-itens');
                const carrinhoVazio = document.getElementById('carrinho-vazio');
                
                if (!containerItens) {
                    console.error('Container de itens do carrinho n√£o encontrado');
                    return;
                }
                
                // Limpar itens existentes (exceto a mensagem de carrinho vazio)
                const itensAtuais = containerItens.querySelectorAll('.item-carrinho');
                itensAtuais.forEach(item => item.remove());
                
                // Mostrar/esconder mensagem de carrinho vazio e o resumo do carrinho
                const resumoCarrinho = document.getElementById('resumo-carrinho');
                const valorTotalCarrinho = document.getElementById('valor-total-carrinho');
                
                if (this.itens.length === 0) {
                    if (carrinhoVazio) carrinhoVazio.classList.remove('hidden');
                    if (resumoCarrinho) resumoCarrinho.classList.add('hidden');
                } else {
                    if (carrinhoVazio) carrinhoVazio.classList.add('hidden');
                    if (resumoCarrinho) resumoCarrinho.classList.remove('hidden');
                    
                    // Calcular o valor total do carrinho
                    let valorTotal = 0;
                    this.itens.forEach(item => {
                        const precoBase = item.precoBase || 0;
                        const precoAdicional = item.precoAdicional || 0;
                        const precoTotalItem = precoBase + precoAdicional;
                        valorTotal += precoTotalItem * item.quantidade;
                    });
                    
                    // Atualizar o valor total exibido
                    if (valorTotalCarrinho) {
                        valorTotalCarrinho.textContent = `R$ ${valorTotal.toFixed(2).replace('.', ',')}`;
                    }
                    
                    // Renderizar cada item do carrinho
                    this.itens.forEach((item, index) => {
                        // Calcular o pre√ßo total do item (pre√ßo base + pre√ßo adicional)
                        const precoBase = item.precoBase || 0;
                        const precoAdicional = item.precoAdicional || 0;
                        const precoTotalItem = precoBase + precoAdicional;
                        const precoFormatado = `R$ ${precoTotalItem.toFixed(2).replace('.', ',')}`;
                        
                        const itemHtml = `
                            <div class="item-carrinho bg-white rounded-lg shadow-sm p-3 border border-gray-200 flex flex-col">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <h4 class="font-medium text-gray-900">${item.titulo}</h4>
                                        <div class="flex items-center mt-1">
                                            <span class="text-sm font-medium text-primary-dynamic">${precoFormatado}</span>
                                            <span class="text-sm text-gray-500 ml-2">Qtd: ${item.quantidade}</span>
                                        </div>
                                        ${item.precoAdicional > 0 ? `<span class="text-xs text-gray-500">(inclui adicional de varia√ß√£o: +R$ ${item.precoAdicional.toFixed(2).replace('.', ',')})</span>` : ''}
                                        ${item.observacao ? `<p class="text-xs text-gray-500 mt-1">${item.observacao}</p>` : ''}
                                    </div>
                                    <button 
                                        type="button" 
                                        class="remover-item ml-2 text-gray-400 hover:text-red-500 focus:outline-none"
                                        data-item-id="${item.id}"
                                        aria-label="Remover ${item.titulo} do carrinho"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        `;
                        
                        // Inserir antes da mensagem de carrinho vazio
                        if (carrinhoVazio) {
                            carrinhoVazio.insertAdjacentHTML('beforebegin', itemHtml);
                        } else {
                            containerItens.insertAdjacentHTML('beforeend', itemHtml);
                        }
                    });
                    
                    // Reconfigurar eventos para os bot√µes de remover
                    this.configurarEventos();
                }
            },
            
            // Configura eventos
            /**
             * Configura todos os eventos de interatividade do sistema de carrinho
             * - Controles de quantidade nos cards de produtos
             * - Bot√µes de adicionar ao carrinho
             * - Navega√ß√£o entre as etapas do checkout
             * - Valida√ß√£o e envio de pedido
             */
            configurarEventos: function() {
                // Configurar eventos para os inputs de quantidade (altera√ß√£o manual)
                const self = this;
                document.addEventListener('change', function(event) {
                    if (event.target.matches('.quantidade-input')) {
                        const input = event.target;
                        const id = input.dataset.itemId;
                        const novaQuantidade = parseInt(input.value) || 1;
                        
                        // Se estiver no modal de checkout, atualizar o carrinho
                        if (input.closest('#carrinho-itens')) {
                            atualizarQuantidadeInput(id, novaQuantidade);
                        }
                    }
                });
                
                // Configurar eventos para os controles de quantidade
                document.addEventListener('click', function(event) {
                    // Incremento de quantidade
                    if (event.target.closest('.quantidade-incremento')) {
                        const btn = event.target.closest('.quantidade-incremento');
                        if (!btn || !btn.dataset || !btn.dataset.itemId) {
                            console.error('Bot√£o de incremento inv√°lido ou sem ID');
                            return;
                        }
                        const id = btn.dataset.itemId;
                        const input = document.querySelector(`.quantidade-input[data-item-id="${id}"]`);
                        if (!input) {
                            console.error(`Input de quantidade n√£o encontrado para o item ${id}`);
                            return;
                        }
                        let quantidade = parseInt(input.value) || 1;
                        quantidade++;
                        if (quantidade > 99) quantidade = 99; // Limita a quantidade m√°xima a 99
                        input.value = quantidade;
                        
                        // Atualizar o item no carrinho se estiver no modal de checkout
                        const carrinhoElement = btn.closest('#carrinho-itens');
                        if (carrinhoElement) {
                            try {
                                // Obter o carrinho do localStorage
                                let carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
                                
                                // Encontrar o item no carrinho
                                const itemIndex = carrinho.findIndex(item => item && item.id === id);
                                if (itemIndex !== -1) {
                                    // Atualizar a quantidade
                                    carrinho[itemIndex].quantidade = quantidade;
                                    
                                    // Salvar no localStorage
                                    localStorage.setItem('carrinho', JSON.stringify(carrinho));
                                    
                                    // Atualizar interface usando fun√ß√£o global
                                    if (typeof atualizarContadorCarrinho === 'function') {
                                        atualizarContadorCarrinho();
                                    }
                                    
                                    // Atualizar o contador no t√≠tulo do carrinho
                                    const totalItensCarrinho = document.getElementById('total-itens-carrinho');
                                    if (totalItensCarrinho) {
                                        const totalItens = carrinho.reduce((acc, item) => acc + (item ? item.quantidade : 0), 0);
                                        totalItensCarrinho.textContent = totalItens;
                                    }
                                    
                                    // Habilitar o bot√£o de decremento se quantidade > 1
                                    const btnDecremento = document.querySelector(`.quantidade-decremento[data-item-id="${id}"]`);
                                    if (btnDecremento) {
                                        btnDecremento.disabled = false;
                                        btnDecremento.classList.remove('opacity-50');
                                    }
                                }
                            } catch (error) {
                                console.error('Erro ao atualizar quantidade no carrinho:', error);
                            }
                        }
                    }
                    
                    // Decremento de quantidade
                    if (event.target.closest('.quantidade-decremento')) {
                        const btn = event.target.closest('.quantidade-decremento');
                        if (!btn || !btn.dataset || !btn.dataset.itemId) {
                            console.error('Bot√£o de decremento inv√°lido ou sem ID');
                            return;
                        }
                        const id = btn.dataset.itemId;
                        const input = document.querySelector(`.quantidade-input[data-item-id="${id}"]`);
                        if (!input) {
                            console.error(`Input de quantidade n√£o encontrado para o item ${id}`);
                            return;
                        }
                        let quantidade = parseInt(input.value) || 1;
                        quantidade = Math.max(1, quantidade - 1); // N√£o permite valor menor que 1
                        input.value = quantidade;
                        
                        // Atualizar o item no carrinho se estiver no modal de checkout
                        const carrinhoElement = btn.closest('#carrinho-itens');
                        if (carrinhoElement) {
                            try {
                                // Obter o carrinho do localStorage
                                let carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
                                
                                // Encontrar o item no carrinho
                                const itemIndex = carrinho.findIndex(item => item && item.id === id);
                                if (itemIndex !== -1) {
                                    // Atualizar a quantidade
                                    carrinho[itemIndex].quantidade = quantidade;
                                    
                                    // Salvar no localStorage
                                    localStorage.setItem('carrinho', JSON.stringify(carrinho));
                                    
                                    // Atualizar interface usando fun√ß√£o global
                                    if (typeof atualizarContadorCarrinho === 'function') {
                                        atualizarContadorCarrinho();
                                    }
                                    
                                    // Atualizar o contador no t√≠tulo do carrinho
                                    const totalItensCarrinho = document.getElementById('total-itens-carrinho');
                                    if (totalItensCarrinho) {
                                        const totalItens = carrinho.reduce((acc, item) => acc + (item ? item.quantidade : 0), 0);
                                        totalItensCarrinho.textContent = totalItens;
                                    }
                                    
                                    // Desabilitar o bot√£o de decremento se quantidade <= 1
                                    if (quantidade <= 1) {
                                        btn.disabled = true;
                                        btn.classList.add('opacity-50');
                                    }
                                }
                            } catch (error) {
                                console.error('Erro ao atualizar quantidade no carrinho:', error);
                            }
                        }
                    }
                    
                    // Adicionar ao carrinho - REMOVIDO (comentado)
                    // O c√≥digo que estava aqui foi removido porque estava causando duplica√ß√£o de itens
                    // A adi√ß√£o ao carrinho agora √© feita exclusivamente pela fun√ß√£o adicionarAoCarrinhoSimples
                    // que √© chamada diretamente pelo atributo onclick nos bot√µes
                    
                    // Remover item do carrinho
                    if (event.target.closest('.remover-item-carrinho')) {
                        const btn = event.target.closest('.remover-item-carrinho');
                        if (!btn || !btn.dataset || !btn.dataset.itemId) {
                            console.error('Bot√£o de remo√ß√£o inv√°lido ou sem ID');
                            return;
                        }
                        
                        const id = btn.dataset.itemId;
                        
                        try {
                            // Obter carrinho atual
                            let carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
                            
                            // Encontrar o √≠ndice do item a ser removido
                            const itemIndex = carrinho.findIndex(item => item && item.id === id);
                            
                            if (itemIndex !== -1) {
                                // Remover o item do array
                                carrinho.splice(itemIndex, 1);
                                
                                // Salvar carrinho atualizado
                                localStorage.setItem('carrinho', JSON.stringify(carrinho));
                                
                                // Atualizar interface do carrinho
                                if (typeof renderizarItensCarrinho === 'function') {
                                    renderizarItensCarrinho();
                                }
                                
                                // Atualizar contador do carrinho
                                if (typeof atualizarContadorCarrinho === 'function') {
                                    atualizarContadorCarrinho();
                                }
                                
                                // Remover o elemento do DOM se existir
                                const itemElement = document.querySelector(`#item-carrinho-${id}`);
                                if (itemElement) {
                                    itemElement.remove();
                                }
                                
                                console.log('Item removido do carrinho:', id);
                            }
                        } catch (error) {
                            console.error('Erro ao remover item do carrinho:', error);
                        }
                    }
                    
                    // Limpar carrinho
                    if (event.target.closest('#botao-limpar')) {
                        try {
                            // Limpar o carrinho no localStorage
                            localStorage.setItem('carrinho', JSON.stringify([]));
                            
                            // Limpar a exibi√ß√£o do carrinho
                            const carrinhoItens = document.getElementById('carrinho-itens');
                            if (carrinhoItens) {
                                carrinhoItens.innerHTML = '<p class="p-4 text-gray-500 text-center italic">Seu carrinho est√° vazio</p>';
                            }
                            
                            // Atualizar contador do carrinho
                            if (typeof atualizarContadorCarrinho === 'function') {
                                atualizarContadorCarrinho();
                            }
                            
                            // Atualizar bot√£o flutuante
                            if (typeof atualizarBotaoFlutuante === 'function') {
                                atualizarBotaoFlutuante();
                            }
                            
                            // Resetar para step 1 se estiver no modal de checkout
                            const step1 = document.getElementById('checkout-step-1');
                            const step2 = document.getElementById('checkout-step-2');
                            const step3 = document.getElementById('checkout-step-3');
                            
                            if (step1 && step2 && step3) {
                                step1.classList.remove('hidden');
                                step2.classList.add('hidden');
                                step3.classList.add('hidden');
                            }
                            
                            console.log('Carrinho limpo com sucesso');
                        } catch (error) {
                            console.error('Erro ao limpar carrinho:', error);
                        }
                    }
                    
                    // Abrir modal
                    if (event.target.closest('#botao-carrinho')) {
                        try {
                            // Renderizar itens do carrinho com tratamento de erro
                            if (typeof renderizarItensCarrinho === 'function') {
                                renderizarItensCarrinho();
                            } else {
                                console.warn('Fun√ß√£o renderizarItensCarrinho n√£o encontrada');
                            }
                            
                            // Mostrar o modal com verifica√ß√£o de elementos
                            const modalOverlay = document.getElementById('modal-overlay');
                            if (modalOverlay) {
                                modalOverlay.classList.remove('hidden');
                            }
                            
                            if (document.body) {
                                document.body.classList.add('overflow-hidden');
                            }
                        } catch (error) {
                            console.error('Erro ao abrir modal do carrinho:', error);
                        }
                    }
                    
                    // Fechar modal
                    if (event.target.closest('#fechar-modal') || 
                        (event.target.id === 'modal-overlay' && !event.target.closest('#modal-checkout'))) {
                        document.getElementById('modal-overlay').classList.add('hidden');
                        // Chamar a fun√ß√£o fecharModal para garantir que o scroll seja restaurado corretamente
                        fecharModal();
                    }
                    
                    // Removido manipulador duplicado do bot√£o continuar
                    // O bot√£o j√° tem um onclick="avan√ßarStep()" que cuida da navega√ß√£o
                    
                    // Removido manipulador duplicado do bot√£o voltar
                    // O bot√£o j√° tem um onclick="voltarStep()" que cuida da navega√ß√£o
                    // A duplicidade estava causando conflitos e erros ao voltar para steps anteriores
                    
                    // Enviar pedido
                    if (event.target.closest('#botao-enviar')) {
                        try {
                            // Verificar se o objeto Carrinho existe e chamar o m√©todo correto
                            if (typeof Carrinho === 'object' && typeof Carrinho.validarEEnviarPedido === 'function') {
                                Carrinho.validarEEnviarPedido();
                            } else {
                                console.error('Objeto Carrinho ou m√©todo validarEEnviarPedido n√£o encontrado');
                                alert('N√£o foi poss√≠vel enviar o pedido. Tente novamente.');
                            }
                        } catch (error) {
                            console.error('Erro ao enviar pedido:', error);
                        }
                    }
                });
                
                // Valida√ß√£o de inputs num√©ricos (somente n√∫meros e quantidade m√≠nima 1)
                document.addEventListener('input', (event) => {
                    if (event.target.classList.contains('quantidade-input')) {
                        // Remover caracteres n√£o num√©ricos
                        event.target.value = event.target.value.replace(/[^0-9]/g, '');
                        
                        // Garantir valor m√≠nimo 1
                        const valor = parseInt(event.target.value) || 0;
                        if (valor < 1) event.target.value = 1;
                    }
                    
                    // Atualizar observa√ß√£o de item quando o textarea √© alterado
                    if (event.target.classList.contains('observacao-item')) {
                        const id = event.target.dataset.itemId;
                        this.atualizarObservacao(id, event.target.value);
                    }
                });
            },

            // Atualiza estado visual do bot√£o Adicionar ao Carrinho
            atualizarEstadoBotaoAdicionar: function(id) {
                const botao = document.querySelector(`.adicionar-ao-carrinho[data-item-id="${id}"]`);
                if (botao) {
                    botao.textContent = 'Adicionado';
                    botao.classList.remove('bg-primary-dynamic', 'hover:bg-primary-dynamic/90');
                    botao.classList.add('bg-green-600', 'hover:bg-green-700');
                }
            },
            
            // Configura a mensagem destacada com o label de retirada
            configurarMensagemDestacada: function() {
                const labelRetirada = dadosGlobais.config['Label de Retirada'];
                if (labelRetirada) {
                    const mensagemDestacada = document.getElementById('mensagem-destacada');
                    mensagemDestacada.innerHTML = `<strong>Informa√ß√£o Importante:</strong> ${labelRetirada}`;
                    mensagemDestacada.classList.remove('hidden');
                }
            },
            
            // Atualiza a exibi√ß√£o dos itens no carrinho
            atualizarExibicaoCarrinho: function() {
                const carrinhoItens = document.getElementById('carrinho-itens');
                const carrinhoVazio = document.getElementById('carrinho-vazio');
                const totalItensCarrinho = document.getElementById('total-itens-carrinho');
                
                // Atualizar o contador de itens no t√≠tulo
                if (totalItensCarrinho) {
                    // Calcular o total de itens somando as quantidades
                    const totalItens = this.itens.reduce((acc, item) => acc + item.quantidade, 0);
                    totalItensCarrinho.textContent = totalItens;
                    console.log('Total de itens no carrinho:', totalItens);
                }
                
                // Remover todos os itens, exceto a mensagem de carrinho vazio
                Array.from(carrinhoItens.children).forEach(child => {
                    if (child.id !== 'carrinho-vazio') {
                        child.remove();
                    }
                });
                
                if (this.itens.length === 0) {
                    // Mostrar mensagem de carrinho vazio
                    carrinhoVazio.classList.remove('hidden');
                    // Desabilitar bot√£o continuar
                    document.getElementById('botao-continuar').classList.add('opacity-50', 'cursor-not-allowed');
                } else {
                    // Esconder mensagem de carrinho vazio
                    carrinhoVazio.classList.add('hidden');
                    // Habilitar bot√£o continuar
                    document.getElementById('botao-continuar').classList.remove('opacity-50', 'cursor-not-allowed');
                    
                    // Adicionar itens ao carrinho
                    this.itens.forEach(item => {
                        const itemElement = document.createElement('div');
                        itemElement.className = 'bg-white border rounded-lg p-4 shadow-sm';
                        itemElement.innerHTML = `
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-medium text-gray-800">${item.titulo}</h4>
                                          placeholder="Alguma observa√ß√£o sobre este item?" 
                                          rows="2"
                                          data-item-id="${item.id}">${item.observacao || ''}</textarea>
                            </div>
                        `;
                        carrinhoItens.insertBefore(itemElement, carrinhoVazio);
                    });
                }
            },
            
            // Configura√ß√£o do step 2: M√©todos de envio
            configurarStep2: function() {
                const metodoContainer = document.getElementById('metodos-envio');
                metodoContainer.innerHTML = '';
                
                // Op√ß√µes de m√©todo de envio configuradas na planilha
                const opc1 = dadosGlobais.config['Step-2-opc-1'] || 'Consumo no Local';
                const opc2 = dadosGlobais.config['Step-2-opc-2'] || 'Pedido para Retirada no Local';
                const opc3 = dadosGlobais.config['Step-2-opc-3'] || 'Pedido para Entrega (Delivery)';
                
                // Criar op√ß√µes de m√©todos de envio
                const metodos = [
                    {id: 'consumo-local', nome: opc1, valor: 'consumo'},
                    {id: 'retirada', nome: opc2, valor: 'retirada'},
                    {id: 'delivery', nome: opc3, valor: 'delivery'}
                ];
                
                metodos.forEach(metodo => {
                    const metodoElement = document.createElement('div');
                    metodoElement.className = 'flex items-center space-x-3 p-3 border rounded-lg bg-gray-50 cursor-pointer hover:bg-gray-100';
                    metodoElement.innerHTML = `
                        <input type="radio" id="${metodo.id}" name="metodo-envio" value="${metodo.valor}" class="h-5 w-5 text-primary-dynamic focus:ring-primary-dynamic">
                        <label for="${metodo.id}" class="cursor-pointer flex-1">
                            <span class="font-medium text-gray-800">${metodo.nome}</span>
                        </label>
                    `;
                    metodoContainer.appendChild(metodoElement);
                    
                    // Adicionar evento de click ao elemento div para selecionar o radio
                    metodoElement.addEventListener('click', function() {
                        document.getElementById(metodo.id).checked = true;
                    });
                });
            },
            
            // Configura√ß√£o do step 3 com base na op√ß√£o selecionada
            configurarStep3: function() {
                const formCliente = document.getElementById('form-cliente');
                formCliente.innerHTML = '';
                
                // Campo Nome (comum a todos os m√©todos)
                const campoNome = document.createElement('div');
                campoNome.className = 'mb-4';
                campoNome.innerHTML = `
                    <label for="cliente-nome" class="block mb-1 text-sm font-medium text-gray-700">Nome</label>
                    <input type="text" id="cliente-nome" name="nome" class="w-full px-4 py-2 border border-gray-300 rounded-md text-gray-800 focus:outline-none focus:ring-1 focus:ring-primary-dynamic focus:border-primary-dynamic" required>
                `;
                formCliente.appendChild(campoNome);
                
                // Sempre adicionar os campos espec√≠ficos de acordo com a op√ß√£o de entrega selecionada
                // Removida verifica√ß√£o de opcaoEntregaPadrao que estava causando bugs
                switch (opcaoEntregaSelecionada) {
                    case 'local':
                        // Campo Mesa/Comanda (sempre exibir quando a op√ß√£o for 'local')
                        // A configura√ß√£o Step-3-mesa-comanda est√° definida como Sim na planilha
                        console.log('Configurando campo de mesa/comanda para op√ß√£o local');
                        const campoMesa = document.createElement('div');
                        campoMesa.className = 'mb-4';
                        campoMesa.innerHTML = `
                            <label for="cliente-mesa" class="block mb-1 text-sm font-medium text-gray-700">Mesa/Comanda</label>
                            <input type="text" id="cliente-mesa" name="mesa" class="w-full px-4 py-2 border border-gray-300 rounded-md text-gray-800 focus:outline-none focus:ring-1 focus:ring-primary-dynamic focus:border-primary-dynamic" required>
                        `;
                        formCliente.appendChild(campoMesa);
                        break;
                        
                    case 'delivery':
                        // Campo Endere√ßo para delivery
                        const campoEndereco = document.createElement('div');
                        campoEndereco.className = 'mb-4';
                        campoEndereco.innerHTML = `
                            <label for="cliente-endereco" class="block mb-1 text-sm font-medium text-gray-700">Endere√ßo Completo</label>
                            <textarea id="cliente-endereco" name="endereco" class="w-full px-4 py-2 border border-gray-300 rounded-md text-gray-800 focus:outline-none focus:ring-1 focus:ring-primary-dynamic focus:border-primary-dynamic" rows="3" required></textarea>
                        `;
                        formCliente.appendChild(campoEndereco);
                        
                        // Exibir taxa de delivery
                        const taxaDelivery = dadosGlobais.config['Step-2-taxa-delivery'];
                        if (taxaDelivery) {
                            const mensagemTaxa = document.createElement('div');
                            mensagemTaxa.className = 'mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg text-sm font-medium text-yellow-800';
                            mensagemTaxa.innerHTML = `<strong>Taxa de Entrega:</strong> ${taxaDelivery}`;
                            formCliente.appendChild(mensagemTaxa);
                        }
                        break;
                        
                    case 'retirada':
                        // Campo Hor√°rio de Retirada (se configurado)
                        if (dadosGlobais.config['Step-3-horario-retirada'] === 'Sim') {
                            const campoHorario = document.createElement('div');
                            campoHorario.className = 'mb-4';
                            campoHorario.innerHTML = `
                                <label for="cliente-horario" class="block mb-1 text-sm font-medium text-gray-700">Hor√°rio de Retirada</label>
                                <input type="time" id="cliente-horario" name="horario" class="w-full px-4 py-2 border border-gray-300 rounded-md text-gray-800 focus:outline-none focus:ring-1 focus:ring-primary-dynamic focus:border-primary-dynamic">
                            `;
                            formCliente.appendChild(campoHorario);
                        }
                        break;
                }
                
                // Campo Forma de Pagamento (para todas as op√ß√µes exceto a 4/padr√£o)
                const campoFormaPagamento = document.createElement('div');
                campoFormaPagamento.className = 'mb-4';
                campoFormaPagamento.innerHTML = `
                    <label for="cliente-pagamento" class="block mb-1 text-sm font-medium text-gray-700">Forma de Pagamento</label>
                    <select id="cliente-pagamento" name="pagamento" class="w-full px-4 py-2 border border-gray-300 rounded-md text-gray-800 focus:outline-none focus:ring-1 focus:ring-primary-dynamic focus:border-primary-dynamic" required>
                        <option value="" disabled selected>Selecione a forma de pagamento</option>
                        <!-- Op√ß√µes ser√£o preenchidas dinamicamente -->
                    </select>
                `;
                formCliente.appendChild(campoFormaPagamento);
                
                // Preencher op√ß√µes de pagamento
                const selectPagamento = document.getElementById('cliente-pagamento');
                popularFormasPagamento(selectPagamento);
                
                // Campo de Observa√ß√µes Gerais (comum a todos os m√©todos)
                const campoObs = document.createElement('div');
                campoObs.className = 'mb-4';
                campoObs.innerHTML = `
                    <label for="cliente-obs" class="block mb-1 text-sm font-medium text-gray-700">Observa√ß√µes Gerais</label>
                    <textarea id="cliente-obs" name="observacoes" class="w-full px-4 py-2 border border-gray-300 rounded-md text-gray-800 focus:outline-none focus:ring-1 focus:ring-primary-dynamic focus:border-primary-dynamic" rows="3"></textarea>
                `;
                formCliente.appendChild(campoObs);
            },
            
            // Navega√ß√£o entre os steps
            mostrarStep: function(step) {
                // Ocultar todos os steps
                document.querySelectorAll('.step').forEach(el => {
                    el.classList.add('hidden');
                });
                
                // Mostrar o step solicitado
                document.getElementById(`step-${step}`).classList.remove('hidden');
                
                // Configurar bot√µes de acordo com o step atual
                const botaoVoltar = document.getElementById('botao-voltar');
                const botaoContinuar = document.getElementById('botao-continuar');
                const botaoEnviar = document.getElementById('botao-enviar');
                
                if (step === 1) {
                    botaoVoltar.classList.add('hidden');
                    botaoContinuar.classList.remove('hidden');
                    botaoEnviar.classList.add('hidden');
                } else if (step === 2) {
                    this.configurarStep2();
                    botaoVoltar.classList.remove('hidden');
                    botaoContinuar.classList.remove('hidden');
                    botaoEnviar.classList.add('hidden');
                } else if (step === 3) {
                    botaoVoltar.classList.remove('hidden');
                    botaoContinuar.classList.add('hidden');
                    botaoEnviar.classList.remove('hidden');
                }
            },
            
            // Valida√ß√£o e envio do pedido via WhatsApp
            /**
             * Valida os campos do formul√°rio e envia o pedido via WhatsApp
             * - Verifica campos obrigat√≥rios de acordo com o m√©todo de envio selecionado
             * - Monta mensagem formatada com os itens, quantidades e observa√ß√µes
             * - Abre WhatsApp Web com a mensagem pr√©-preenchida
             * - Limpa o carrinho ap√≥s o envio bem-sucedido
             */
            validarEEnviarPedido: function() {
                // Validar campos obrigat√≥rios
                const nome = document.getElementById('cliente-nome');
                if (!nome.value.trim()) {
                    alert('Por favor, informe seu nome.');
                    nome.focus();
                    return;
                }
                
                // Verificar m√©todo de envio selecionado
                let metodoEnvio = '';
                const exibirStep2 = dadosGlobais.config['Step-2-checkout'] === 'Sim';
                if (exibirStep2) {
                    const metodoSelecionado = document.querySelector('input[name="metodo-envio"]:checked');
                    if (metodoSelecionado) {
                        metodoEnvio = metodoSelecionado.value;
                        
                        // Valida√ß√µes espec√≠ficas por m√©todo
                        // Padronizando o uso de 'local' em vez de 'consumo' para consist√™ncia
                        if (metodoEnvio === 'local') {
                            const mesaComandaAtivado = dadosGlobais.config['Step-3-mesa-comanda'] === 'Sim';
                            if (mesaComandaAtivado) {
                                const mesa = document.getElementById('cliente-mesa');
                                if (!mesa || !mesa.value.trim()) {
                                    alert('Por favor, informe o n√∫mero da mesa/comanda.');
                                    mesa.focus();
                                    return;
                                }
                            }
                        } else if (metodoEnvio === 'delivery') {
                            const endereco = document.getElementById('cliente-endereco');
                            if (!endereco || !endereco.value.trim()) {
                                alert('Por favor, informe seu endere√ßo completo.');
                                endereco.focus();
                                return;
                            }
                        }
                    }
                }
                
                // Monta a mensagem para o WhatsApp com emojis e melhor formata√ß√£o
                let mensagem = `üîî *NOVO PEDIDO* üîî\n\n`;
                
                // Data e hora do pedido
                const agora = new Date();
                const dataFormatada = agora.toLocaleDateString('pt-BR');
                const horaFormatada = agora.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'});
                mensagem += `üìÖ *Data*: ${dataFormatada}\n‚è∞ *Hora*: ${horaFormatada}\n\n`;
                
                // Dados do cliente
                mensagem += `üë§ *DADOS DO CLIENTE*\n`;
                mensagem += `‚û°Ô∏è *Nome*: ${nome.value.trim()}\n`;
                
                // Forma de pagamento
                const formaPagamento = document.getElementById('cliente-pagamento');
                if (formaPagamento && formaPagamento.value && formaPagamento.value !== '') {
                    const formaPagamentoTexto = formaPagamento.options[formaPagamento.selectedIndex].text;
                    mensagem += `üí≥ *Pagamento*: ${formaPagamentoTexto}\n`;
                }
                
                // M√©todo de envio e dados espec√≠ficos
                if (exibirStep2) {
                    const metodoLabel = document.querySelector(`input[value="${metodoEnvio}"]`)?.parentElement?.querySelector('label')?.innerText;
                    
                    if (metodoEnvio === 'local') {
                        mensagem += `üçΩÔ∏è *Consumo no Local*\n`;
                        // Verificar se o campo cliente-mesa existe e est√° preenchido
                        const mesa = document.getElementById('cliente-mesa');
                        if (mesa && mesa.value.trim()) {
                            mensagem += `üìå *Mesa/Comanda*: ${mesa.value.trim()}\n`;
                        } else if (document.getElementById('mesa-comanda')) {
                            const mesaComanda = document.getElementById('mesa-comanda').value.trim();
                            if (mesaComanda) {
                                mensagem += `üìå *Mesa/Comanda*: ${mesaComanda}\n`;
                            }
                        }
                    } else if (metodoEnvio === 'delivery') {
                        mensagem += `üöó *Entrega - Delivery*\n`;
                        const endereco = document.getElementById('cliente-endereco');
                        if (endereco && endereco.value.trim()) {
                            mensagem += `üè† *Endere√ßo*: ${endereco.value.trim()}\n`;
                        }
                        // Removida a mensagem de taxa de entrega conforme solicitado
                    } else if (metodoEnvio === 'retirada') {
                        mensagem += `üõçÔ∏è *Cliente vai Retirar no Local*\n`;
                    }
                }
                
                // Observa√ß√µes gerais
                const obsGerais = document.getElementById('cliente-obs');
                if (obsGerais && obsGerais.value.trim()) {
                    mensagem += `\nüí¨ *OBSERVA√á√ïES*\n${obsGerais.value.trim()}\n`;
                }
                
                // Lista de itens
                mensagem += `\nüõí *ITENS DO PEDIDO*\n`;
                let valorTotal = 0;
                
                this.itens.forEach((item, index) => {
                    // Calcular pre√ßo individual e total do item
                    const precoBase = item.precoBase || 0;
                    const precoAdicional = item.precoAdicional || 0;
                    const precoTotalItem = precoBase + precoAdicional;
                    const precoTotalComQuantidade = precoTotalItem * item.quantidade;
                    
                    // Adicionar ao valor total do pedido
                    valorTotal += precoTotalComQuantidade;
                    
                    // Formatar pre√ßos para exibi√ß√£o
                    const precoFormatado = `R$ ${precoTotalItem.toFixed(2).replace('.', ',')}`;
                    const precoTotalFormatado = `R$ ${precoTotalComQuantidade.toFixed(2).replace('.', ',')}`;
                    
                    // Adicionar informa√ß√µes do item √† mensagem
                    mensagem += `\n${index + 1}. ${item.titulo} (${item.quantidade}x) - ${precoFormatado}/un`;
                    if (item.quantidade > 1) mensagem += ` - Total: ${precoTotalFormatado}`;
                    if (item.precoAdicional > 0) mensagem += `\n   ‚ÑπÔ∏è Com adi√ß√£o de R$ ${item.precoAdicional.toFixed(2).replace('.', ',')}`;
                    if (item.observacao) mensagem += `\n   ‚û°Ô∏è _${item.observacao}_`;
                    mensagem += `\n`;
                });
                
                // Adicionar valor total do pedido √† mensagem
                const valorTotalFormatado = `R$ ${valorTotal.toFixed(2).replace('.', ',')}`;
                mensagem += `\nüí∞ *VALOR TOTAL:* ${valorTotalFormatado}\n`;
                
                mensagem += `\n‚úÖ *Pedido Finalizado* - Aguardando confirma√ß√£o do estabelecimento\n`;
                mensagem += `\nüëç Obrigado pela prefer√™ncia!`;
                
                
                // Codificar mensagem para URL
                const mensagemCodificada = encodeURIComponent(mensagem);
                
                // N√∫mero de WhatsApp do estabelecimento da planilha
                const whatsappNumero = dadosGlobais.config['WhatsApp'];
                if (!whatsappNumero) {
                    alert('N√∫mero de WhatsApp n√£o configurado na planilha.');
                    return;
                }
                
                // Remover caracteres n√£o num√©ricos do n√∫mero
                const numeroLimpo = whatsappNumero.replace(/\D/g, '');
                
                // Detectar o dispositivo e enviar o pedido de forma adequada
                enviarPedidoWhatsApp(numeroLimpo, mensagemCodificada);
                
                // Criar fun√ß√£o para limpar tudo ap√≥s um pequeno delay (para garantir que o WhatsApp foi aberto)
                const limparTudoEResetar = () => {
                    // Limpar o carrinho (isto remove os itens da mem√≥ria)
                    this.limpar();
                    
                    // Remover completamente do localStorage (para garantir reset completo)
                    localStorage.removeItem('carrinho');
                    
                    // Resetar todos os inputs do formul√°rio
                    document.querySelectorAll('input[type="text"], input[type="tel"], textarea').forEach(input => {
                        input.value = '';
                    });
                    
                    document.querySelectorAll('select').forEach(select => {
                        if (select.options.length > 0) {
                            select.selectedIndex = 0;
                        }
                    });
                    
                    // Resetar op√ß√µes de entrega
                    document.querySelectorAll('input[name="metodo-envio"]').forEach(radio => {
                        radio.checked = false;
                    });
                    
                    // Fechar o modal e restaurar a rolagem
                    fecharModal();
                    
                    // Garantir que a rolagem est√° habilitada
                    document.body.classList.remove('overflow-hidden');
                    document.documentElement.classList.remove('overflow-hidden');
                    
                    // Voltar para o step 1 para futuros pedidos
                    Carrinho.mostrarStep(1);
                    
                    // Atualizar o contador do carrinho e bot√£o flutuante
                    atualizarContadorCarrinho();
                    
                    // Remover quaisquer classes ou estados que possam causar travamento
                    document.querySelectorAll('.modal-fixed').forEach(modal => {
                        modal.style.position = '';
                    });
                    
                    console.log('Sistema resetado ap√≥s envio do pedido');
                };
                
                // Executar a limpeza ap√≥s um pequeno delay para garantir que o WhatsApp foi aberto
                setTimeout(limparTudoEResetar, 500);
            }
            
        };
        
        // Carrega o sistema de carrinho ap√≥s o card√°pio ser renderizado
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializa√ß√£o imediata para garantir que o objeto esteja dispon√≠vel
            Carrinho.inicializar();
            
            // Observa quando o card√°pio √© renderizado para configurar todos os eventos novamente
            const observer = new MutationObserver(function(mutations, observer) {
                if (document.querySelector('#cardapio .categoria-secao')) {
                    console.log('Card√°pio renderizado, configurando eventos do carrinho...');
                    // Reconfigurar eventos para os novos elementos adicionados ao DOM
                    Carrinho.configurarEventos();
                    observer.disconnect();
                }
            });
            
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        });
        
        // Garantir que o objeto Carrinho esteja acess√≠vel globalmente
        window.Carrinho = Carrinho;
    </script>
</body>
</html>
